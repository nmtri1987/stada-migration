RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.LeaveRequest=function(n){this.Protocol=window.location.protocol;this.Settings={ServiceUrls:{EmployeeList:this.Protocol+"//{0}/_vti_bin/Services/Employee/EmployeeService.svc/GetByDepartmentLocation/{1}/{2}/{3}",GetLeaveInfo:this.Protocol+"//{0}/_vti_bin/services/leavemanagement/leavemanagementservice.svc/GetAllLeaveInfo/{1}/{2}/{3}",GetApproversByRequester:this.Protocol+"//{0}/_vti_bin/services/leavemanagement/leavemanagementservice.svc/GetApproversByRequester/{1}/{2}/{3}/{4}",GetApproversByRequesterAndTime:this.Protocol+"//{0}/_vti_bin/services/leavemanagement/leavemanagementservice.svc/GetApproversByRequesterAndTime/{1}/{2}/{3}/{4}/{5}/{6}",GetLeaveManagementById:this.Protocol+"//{0}/_vti_bin/services/leavemanagement/leavemanagementservice.svc/GetLeaveManagementById/{1}",GetEmployeeById:this.Protocol+"//{0}/_vti_bin/services/Employee/EmployeeService.svc/GetEmployeeByEmployeeID/{1}",InsertLeaveRequest:this.Protocol+"//{0}/_vti_bin/services/leavemanagement/leavemanagementservice.svc/InsertLeaveManagement",ApproveLeaveRequest:"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/ApproveLeave",RejectLeaveRequest:"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/RejectLeave",GetApprovalPermission:"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/HasApprovalPermission/{1}",GetDelegatedTaskInfo:"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/GetDelegatedTaskInfo/{1}",GetTaskHistoryInfo:"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/GetTaskHistory/{1}/{2}"},Data:{},DelegatedTaskInfo:{},Id:n.Id,LocationId:0,FullName:"",EmployeeID:"0",EmployeeForID:"0",UserId:0,DepartmentId:0,EmployeeLevel:0,EmployeeList:[],ID:"",ApproverID:0,DateControlValue:{FromHour:"",FromMinute:"",ToHour:"",ToMinute:""},IsFormValid:!1,TotalHours:0,TotalDays:0,IsFormFieldsNotEmpty:!1,IsFormLeaveRequestFollowPolicy:!0,TLE:{},DH:{},BOD:{},UnexpectedLeave:!1,ErrorConstants:{FromDateRelateToDate:1,FromDateIsHoliday:2,ToDateIsHoliday:3,Policy1:4,Policy2:5,Policy3:6,Overlap:7,FromDateInvalid:8,SequenceLeave:9,InvalidData:100,Unexpected:101},ADMIN_LEVEL:3,TEAMLEAD_LEVEL:3.2,CurrentApprover:{}};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.LeaveRequest.prototype={Initialize:function(){var n=this;n.Settings.Id=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemId");SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.DisableControls();n.PopulateData();n.RegisterEvents()})},InitControls:function(){var n=this;$(n.Settings.Controls.ReasonControlSelector).val("");$("#tbLeaveRequestContainer .ms-formvalidation.ms-csrformvalidation").hide();$(n.Settings.Controls.TotalHoursControlSelector_Error).hide();$(n.Settings.Controls.RequestForControlSelector).select2();$(n.Settings.Controls.TransferWorkToControlSelector).select2()},PopulateCurrentUserInfo:function(){_rbvhContext&&_rbvhContext.EmployeeInfo&&(this.Settings.EmployeeID=_rbvhContext.EmployeeInfo.EmployeeID,this.Settings.FullName=_rbvhContext.EmployeeInfo.FullName,this.Settings.LocationId=_rbvhContext.EmployeeInfo.FactoryLocation.LookupId,this.Settings.UserId=_rbvhContext.EmployeeInfo.ID,this.Settings.DepartmentId=_rbvhContext.EmployeeInfo.Department.LookupId,this.Settings.EmployeeForID=_rbvhContext.EmployeeInfo.ID,this.Settings.ID=_rbvhContext.EmployeeInfo.ID,this.Settings.EmployeeLevel=parseFloat(_rbvhContext.EmployeeInfo.EmployeeLevel.LookupValue))},PopulateData:function(){var n=this,t;n.Settings.Id?($(n.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").show(),t=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetLeaveManagementById,location.host,n.Settings.Id),$.ajax({type:"GET",url:t,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var u,f,h,s;if(t){n.Settings.Data=t;t&&t.Id>0&&n.GetApprovalPermission(t.Id).then(function(i){i&&i===!0?n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):n.ShowControlForApprover(!0):n.GetDelegatedTaskInfo(t.Id).then(function(t){t&&t.Requester.LookupId>0?n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):(n.Settings.DelegatedTaskInfo=t,n.ShowControlForApprover(!0)):n.ShowControlForApprover(!1)})});$(n.Settings.Controls.RequesterControlSelector).html(t.Requester.LookupValue);$(n.Settings.Controls.RequestForControlSelector).empty();$(n.Settings.Controls.RequestForControlSelector).append($("<option>").attr("value",t.RequestFor.LookupId).text(t.RequestFor.LookupValue));$(n.Settings.Controls.RequestForControlSelector).prop("disabled",!0);var e=RBVH.Stada.WebPages.Utilities.String.toMomentDateTime(t.FromDate,_spPageContextInfo.currentLanguage),c=e.getDate(),l=e.getMonth()+1,a=e.getYear()+1900,i=e.getHours();i=i<10?"0"+i:i;i=i+":";u=e.getMinutes();u=u<10?"0"+u:u;$(n.Settings.Controls.FromDateControlSelector).val(c+"/"+l+"/"+a);$(n.Settings.Controls.FromHourControlSelector).val(i);$(n.Settings.Controls.FromMinuteControlSelector).val(u);t.ApprovalStatus&&t.ApprovalStatus.length>0&&($(n.Settings.Controls.ApprovalStatusValSelector).html(RBVH.Stada.WebPages.Utilities.GUI.generateItemStatus(t.ApprovalStatus)),$(n.Settings.Controls.ApprovalStatusHeaderSelector).show(),$(n.Settings.Controls.ApprovalStatusValSelector).show());var o=RBVH.Stada.WebPages.Utilities.String.toMomentDateTime(t.ToDate,_spPageContextInfo.currentLanguage),v=o.getDate(),y=o.getMonth()+1,p=o.getYear()+1900,r=o.getHours();if(r=r<10?"0"+r:r,r=r+":",f=o.getMinutes(),f=f<10?"0"+f:f,$(n.Settings.Controls.ToDateControlSelector).val(v+"/"+y+"/"+p),$(n.Settings.Controls.ToHourControlSelector).val(r),$(n.Settings.Controls.ToMinuteControlSelector).val(f),$(n.Settings.Controls.TotalHoursControlSelector).val(t.TotalHoursDisp),$(n.Settings.Controls.TransferWorkToControlSelector).empty(),$(n.Settings.Controls.TransferWorkToControlSelector).append($("<option>").attr("value",t.TransferworkTo.LookupId).text(t.TransferworkTo.LookupValue)),$(n.Settings.Controls.TransferWorkToControlSelector).prop("disabled",!0),$(n.Settings.Controls.ApproverToControlSelector).html(t.Approver.FullName),$(n.Settings.Controls.ReasonControlSelector).val(t.Reason),t.Comment&&t.Comment.length>0&&($(n.Settings.Controls.OldCommentControlSelector).html(Functions.parseComment(t.Comment)),$(n.Settings.Controls.OldCommentControlSelector).closest("tr").show()),t.AdditionalUser&&t.AdditionalUser.length>0){for(h=[],s=0;s<t.AdditionalUser.length;s++)h.push(t.AdditionalUser[s].FullName);$("#ctl00_PlaceHolderMain_UploadLeavePplPic").val(h.join(";"))}}})):($(n.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").hide(),this.PopulateCurrentUserInfo(),this.PopulateDefaultValue(),this.PopulateComboboxes(),this.LoadApprovers(),$(this.Settings.Controls.RequesterControlSelector).html(this.Settings.FullName))},GetApprovalPermission:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetApprovalPermission,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},GetDelegatedTaskInfo:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetDelegatedTaskInfo,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},ShowControlForApprover:function(n){var t=this;n===!0?($(t.Settings.Controls.ApproveControlSelector).show(),$(t.Settings.Controls.RejectControlSelector).show(),t.Settings.Data&&t.Settings.Data.Comment&&t.Settings.Data.Comment.length>0?$(t.Settings.Controls.OldCommentControlSelector).closest("tr").show():$(t.Settings.Controls.OldCommentControlSelector).closest("tr").hide(),$(t.Settings.Controls.CommentControlSelector).closest("tr").show(),$(t.Settings.Controls.CommentControlSelector).prop("disabled",!1),$(t.Settings.Controls.LeaveHistorySelector).closest("tr").show()):($(t.Settings.Controls.ApproveControlSelector).hide(),$(t.Settings.Controls.RejectControlSelector).hide(),$(t.Settings.Controls.CommentControlSelector).closest("tr").hide(),$(t.Settings.Controls.CommentControlSelector).prop("disabled",!0),$(t.Settings.Controls.LeaveHistorySelector).closest("tr").hide())},PopulateDefaultValue:function(){var t=this,n,i;$(t.Settings.Controls.OldCommentControlSelector).closest("tr").css("display","none");$(t.Settings.Controls.CommentControlSelector).closest("tr").css("display","none");n=new Date;n.setDate(n.getDate()+1);i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),7,15,0);$(t.Settings.Controls.FromDateControlSelector).val(Functions.parseVietnameseDateTimeToDDMMYYYY2(i));$(t.Settings.Controls.ToDateControlSelector).val("");$(t.Settings.Controls.TotalHoursControlSelector).val("")},PopulateComboboxes:function(){this.Settings.EmployeeLevel==this.Settings.ADMIN_LEVEL||this.Settings.EmployeeLevel==this.Settings.TEAMLEAD_LEVEL?this.PopulateEmployeeList([this.Settings.Controls.RequestForControlSelector,this.Settings.Controls.TransferWorkToControlSelector]):($(this.Settings.Controls.RequestForControlSelector).empty(),$(this.Settings.Controls.RequestForControlSelector).append($("<option>").attr("value",this.Settings.UserId).text(this.Settings.FullName)),$(this.Settings.Controls.RequestForControlSelector).prop("disabled",!0),this.PopulateEmployeeList([this.Settings.Controls.TransferWorkToControlSelector]))},ParseDateFromControl:function(n,t,i,r){r||(r=0);var u=Functions.parseVietNameseDate(n),f=parseInt(t.substring(":",t.length-1)),e=parseInt(i);return u?new Date(u.getFullYear(),u.getMonth(),u.getDate(),f,e,r):!1},ShowInvalidRuleMessage:function(){var n=this;$.confirm({title:n.Settings.Modal.Title,content:n.Settings.Modal.WrongPolicies,buttons:{somethingElse:{text:n.Settings.Modal.SeePolicesButton,btnClass:"btn-blue",action:function(){window.open("/Policies","_blank")}},close:{text:n.Settings.Modal.CloseButton,action:function(){}}}})},OnCancelClick:function(){Functions.redirectToSource()},RegisterEvents:function(){var n=this;$(n.Settings.Controls.FromDateControlSelector).get(0).onvaluesetfrompicker=function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()};$(n.Settings.Controls.FromHourControlSelector).change(function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()});$(n.Settings.Controls.FromMinuteControlSelector).change(function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()});$(n.Settings.Controls.ToDateControlSelector).get(0).onvaluesetfrompicker=function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()};$(n.Settings.Controls.ToHourControlSelector).change(function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()});$(n.Settings.Controls.ToMinuteControlSelector).change(function(){n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()});$(n.Settings.Controls.SaveControlSelector).on("click",function(t){n.OnSaveData();t.preventDefault()});$(n.Settings.Controls.ApproveControlSelector).on("click",function(t){n.OnApproveData();t.preventDefault()});$(n.Settings.Controls.RejectControlSelector).on("click",function(t){n.OnRejectData();t.preventDefault()});$(n.Settings.Controls.CancelControlSelector).on("click",function(t){t.preventDefault();n.OnCancelClick()});if($(n.Settings.Controls.RequestForControlSelector).change(function(){var t,i,r;n.Settings.EmployeeForID=$(n.Settings.Controls.RequestForControlSelector+" option:selected").val();n.Settings.UserId!==parseInt(n.Settings.EmployeeForID)?(t=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),$(n.Settings.Controls.FromDateControlSelector).val(Functions.parseVietnameseDateTimeToDDMMYYYY2(i)),$("td.ms-dtinput > input[id$='dtFromDate']").prop("disabled",!0),r=$("td.ms-dtinput > input[id$='dtFromDate']").parent().parent(),$(r).find("td.ms-dtinput > a").hide()):(t=new Date,t.setDate(t.getDate()+1),i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),$(n.Settings.Controls.FromDateControlSelector).val(Functions.parseVietnameseDateTimeToDDMMYYYY2(i)),$("td.ms-dtinput > input[id$='dtFromDate']").removeAttr("disabled"),r=$("td.ms-dtinput > input[id$='dtFromDate']").parent().parent(),$(r).find("td.ms-dtinput > a").show());n.ProcessLeaveRequestInfo(!0,!1);n.LoadApprovers()}),$(n.Settings.Controls.LeaveHistorySelector).length>0)$(n.Settings.Controls.LeaveHistorySelector).on("click",function(t){t.preventDefault();var i="/_layouts/15/RBVH.Stada.Intranet.WebPages/LeaveManagement/LeaveHistory.aspx?EmployeeId="+$(n.Settings.Controls.RequestForControlSelector+" option:selected").val();n.OpenDialogBox(i)});$(n.Settings.Controls.ApprovalHistoryButtonSelector).on("click",function(t){t.preventDefault();var i=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid"),r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetTaskHistoryInfo,location.host,i,0);$.ajax({type:"GET",url:r,cache:!1,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var i=[n.Settings.ResourceText.ApprovalStatusTitle,n.Settings.ResourceText.PostedByTitle,n.Settings.ResourceText.DateTitle,n.Settings.ResourceText.CommentTitle],r=[n.Settings.ResourceText.ApprovalStatus_Approved,n.Settings.ResourceText.ApprovalStatus_Rejected],u=Functions.generateApprovalHistoryTable(t,i,r,n.Settings.ResourceText.NoDataAvaibleMsg);$(n.Settings.Controls.ApprovalHistoryContainerSelector).html(u)})})},OnPreGetLeaveRequest:function(){var n=this,u=$(n.Settings.Controls.FromDateControlSelector).val(),t=Functions.parseVietNameseDate(u),e=$(n.Settings.Controls.FromHourControlSelector+" option:selected").val(),s=$(n.Settings.Controls.FromMinuteControlSelector+" option:selected").val(),f=$(n.Settings.Controls.ToDateControlSelector).val(),i=Functions.parseVietNameseDate(f),o=$(n.Settings.Controls.ToHourControlSelector+" option:selected").val(),h=$(n.Settings.Controls.ToMinuteControlSelector+" option:selected").val();if(!u||u==""||t==!1||!f||f==""||i==!1)return!1;var c=parseInt(e.substring(":",e.length-1)),l=parseInt(s),a=parseInt(o.substring(":",o.length-1)),v=parseInt(h),r={};return r.FromDate=new Date(t.getFullYear(),t.getMonth(),t.getDate(),c,l,0),r.ToDate=new Date(i.getFullYear(),i.getMonth(),i.getDate(),a,v,0),r.RequestForId=parseInt($(n.Settings.Controls.RequestForControlSelector+" option:selected").val()),r},RebindHourMinuteControl:function(){var n=this,t=n.Settings.DateControlValue.FromHour,i=n.Settings.DateControlValue.FromMinute,r=n.Settings.DateControlValue.ToHour,u=n.Settings.DateControlValue.ToMinute;t&&t.length==2&&i&&i.length==2&&($(n.Settings.Controls.FromHourControlSelector).val(t+":").change(),$(n.Settings.Controls.FromMinuteControlSelector).val(i).change());r&&r.length==2&&u&&u.length==2&&($(n.Settings.Controls.ToHourControlSelector).val(r+":").change(),$(n.Settings.Controls.ToMinuteControlSelector).val(u).change())},SetHourMinuteValue:function(n,t){var i=this,r,f,e,u,o,s;n&&(r=RBVH.Stada.WebPages.Utilities.String.parseISOLocal(n),r&&(f=RBVH.Stada.WebPages.Utilities.String.padDate(r.getHours()),e=RBVH.Stada.WebPages.Utilities.String.padDate(r.getMinutes()),i.Settings.DateControlValue.FromHour=f,i.Settings.DateControlValue.FromMinute=e));t&&(u=RBVH.Stada.WebPages.Utilities.String.parseISOLocal(t),u&&(o=RBVH.Stada.WebPages.Utilities.String.padDate(u.getHours()),s=RBVH.Stada.WebPages.Utilities.String.padDate(u.getMinutes()),i.Settings.DateControlValue.ToHour=o,i.Settings.DateControlValue.ToMinute=s))},ProcessLeaveRequestInfo:function(n,t){var r=this,i=r.OnPreGetLeaveRequest(),u;if(i&&i!=!1&&i.RequestForId!=0&&i.RequestForId)u=RBVH.Stada.WebPages.Utilities.String.format(r.Settings.ServiceUrls.GetLeaveInfo,location.host,i.RequestForId,RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(i.FromDate),RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(i.ToDate)),$.ajax({type:"GET",url:u,contentType:"application/json; charset=utf-8",dataType:"json",async:t,cache:!1,success:function(t){t&&r.ProcessData(t,n)},error:function(){}});else return},LoadApprovers:function(){var n=this,t,r,f,i,e,u;n.Settings.CurrentApprover={};n.Settings.TLE={};n.Settings.DH={};n.Settings.BOD={};$(n.Settings.Controls.ApproverToControlSelector).html("");t=n.Settings.DepartmentId;r="";$(n.Settings.Controls.FromDateControlSelector).val()&&(f=n.ParseDateFromControl($(n.Settings.Controls.FromDateControlSelector).val(),$(n.Settings.Controls.FromHourControlSelector+" option:selected").val(),$(n.Settings.Controls.FromMinuteControlSelector+" option:selected").val(),0),r=RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(f));i="";$(n.Settings.Controls.ToDateControlSelector).val()&&(e=n.ParseDateFromControl($(n.Settings.Controls.ToDateControlSelector).val(),$(n.Settings.Controls.ToHourControlSelector+" option:selected").val(),$(n.Settings.Controls.ToMinuteControlSelector+" option:selected").val(),0),i=RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(e));u="";u=i.length>0?RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetApproversByRequesterAndTime,location.host,t,n.Settings.ID,n.Settings.EmployeeForID,r,i,n.Settings.TotalHours):RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetApproversByRequester,location.host,t,n.Settings.ID,n.Settings.EmployeeForID,n.Settings.TotalHours);t&&t>0&&$.ajax({type:"GET",url:u,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){t&&n.PopulateApprovers(t)},error:function(){}})},PopulateApprovers:function(n){var t=this;t.Settings.TLE=n.Approver1&&n.Approver1[0]!=null?{UserName:n.Approver1[0].LoginName,ID:n.Approver1[0].ID}:null;t.Settings.DH=n.Approver2&&n.Approver2!=null?{UserName:n.Approver2.LoginName,ID:n.Approver2.ID}:null;t.Settings.BOD=n.Approver3&&n.Approver3!=null?{UserName:n.Approver3.LoginName,ID:n.Approver3.ID}:null;t.Settings.TLE!=null?(t.Settings.CurrentApprover=n.Approver1[0],$(t.Settings.Controls.ApproverToControlSelector).html(n.Approver1[0].FullLoginName)):t.Settings.DH!=null?(t.Settings.CurrentApprover=n.Approver2,$(t.Settings.Controls.ApproverToControlSelector).html(n.Approver2.FullLoginName)):t.Settings.BOD!=null&&(t.Settings.CurrentApprover=n.Approver3,$(t.Settings.Controls.ApproverToControlSelector).html(n.Approver3.FullLoginName))},ProcessData:function(n,t){var i=this,r;if($(i.Settings.Controls.ToDateControlSelector_Error).hide(),$(i.Settings.Controls.FromDateControlSelector_Error).hide(),$(i.Settings.Controls.TotalHoursControlSelector).val(""),$(i.Settings.Controls.FromDateControlSelector_Error).css("color",""),$(i.Settings.Controls.ToDateControlSelector_Error).css("color",""),i.SetHourMinuteValue(n.FromDate,n.ToDate),i.Settings.IsFormLeaveRequestFollowPolicy=!0,i.Settings.UnexpectedLeave=n.UnexpectedLeave,i.Settings.TotalDays=n.TotalDays,n.ErrorCode!==0||n.ErrorMsg!=null){i.Settings.IsFormValid=!1;r=i.Settings.ErrorConstants;switch(n.ErrorCode){case-1:location.reload();break;case r.FromDateRelateToDate:$(i.Settings.Controls.ToDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.ToDateControlSelector_Error).show();break;case r.FromDateIsHoliday:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).show();break;case r.ToDateIsHoliday:$(i.Settings.Controls.ToDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.ToDateControlSelector_Error).show();break;case r.Policy1:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).css("color","orange");$(i.Settings.Controls.FromDateControlSelector_Error).show();i.Settings.IsFormLeaveRequestFollowPolicy=!1;i.Settings.IsFormValid=!0;i.Settings.TotalDays=n.TotalDays;i.Settings.TotalHours=n.TotalHours;i.PopulateLeaveInfo(n.TotalHoursDisp);t==!0&&i.ShowInvalidRuleMessage();break;case r.Policy2:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).css("color","orange");$(i.Settings.Controls.FromDateControlSelector_Error).show();i.Settings.IsFormValid=!0;i.Settings.IsFormLeaveRequestFollowPolicy=!1;i.Settings.TotalDays=n.TotalDays;i.Settings.TotalHours=n.TotalHours;i.PopulateLeaveInfo(n.TotalHoursDisp);t==!0&&i.ShowInvalidRuleMessage();break;case r.Policy3:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).css("color","orange");$(i.Settings.Controls.FromDateControlSelector_Error).show();i.Settings.IsFormLeaveRequestFollowPolicy=!1;i.Settings.IsFormValid=!0;i.Settings.TotalDays=n.TotalDays;i.Settings.TotalHours=n.TotalHours;i.PopulateLeaveInfo(n.TotalHoursDisp);t==!0&&i.ShowInvalidRuleMessage();break;case r.Overlap:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).show();break;case r.FromDateInvalid:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).show();break;case r.SequenceLeave:$(i.Settings.Controls.FromDateControlSelector_Error).html(n.ErrorMsg);$(i.Settings.Controls.FromDateControlSelector_Error).show()}}else i.Settings.IsFormValid=!0,i.Settings.TotalHours=n.TotalHours,i.Settings.TotalDays=n.TotalDays,i.PopulateLeaveInfo(n.TotalHoursDisp)},PopulateLeaveInfo:function(n){var t=this;$(t.Settings.Controls.TotalHoursControlSelector_Error).hide();$(t.Settings.Controls.TotalHoursControlSelector).val(n)},OnPreSaveData:function(){var n=this,t;n.Settings.IsFormValid=!1;var i=n.ValidateRequiredField(),r=n.ValidateTransferworkTo(),u=n.ValidateRequestForDate();return!i||!r||!u?!1:(n.ProcessLeaveRequestInfo(!1,!1),n.Settings.IsFormValid==!1)?!1:(t=n.ValidateLeaveHours(),!t)?!1:!0},ValidateRequiredField:function(){$("span[class='ms-formvalidation ms-csrformvalidation']").html("");var n=this,t=0;return t+=n.ValidateEmptyField(n.Settings.ID,n.Settings.Controls.RequesterControlSelector_Error,n.Settings.ValidationMessage.CantLeaveTheBlank)==!0?0:1,t+=n.ValidateEmptyField(n.Settings.EmployeeForID,n.Settings.Controls.RequestForControlSelector_Error,n.Settings.ValidationMessage.CantLeaveTheBlank)==!0?0:1,t+=n.ValidateEmptyField($(n.Settings.Controls.FromDateControlSelector).val(),n.Settings.Controls.FromDateControlSelector_Error,n.Settings.ValidationMessage.CantLeaveTheBlank)==!0?0:1,t+=n.ValidateEmptyField($(n.Settings.Controls.ToDateControlSelector).val(),n.Settings.Controls.ToDateControlSelector_Error,n.Settings.ValidationMessage.CantLeaveTheBlank)==!0?0:1,t+=n.ValidateEmptyField($(n.Settings.Controls.TransferWorkToControlSelector+" option:selected").val(),n.Settings.Controls.TransferWorkToControlSelector_Error,n.Settings.ValidationMessage.CantLeaveTheBlank)==!0?0:1,t==0},ValidateLeaveHours:function(){var n=this;return($(n.Settings.Controls.TotalHoursControlSelector_Error).html(""),n.Settings.TotalHours<=0)?($(n.Settings.Controls.TotalHoursControlSelector_Error).html(n.Settings.ValidationMessage.LeaveHoursInvalid),$(n.Settings.Controls.TotalHoursControlSelector_Error).show(),!1):($(n.Settings.Controls.TotalHoursControlSelector_Error).hide(),!0)},ValidateTransferworkTo:function(){var n=this,t,i;return($(n.Settings.Controls.TransferWorkToControlSelector_Error).html(""),t=n.Settings.EmployeeForID,i=$(n.Settings.Controls.TransferWorkToControlSelector+" option:selected").val(),t&&i&&parseInt(t)==parseInt(i))?($(n.Settings.Controls.TransferWorkToControlSelector_Error).html(n.Settings.ValidationMessage.TransferWorkToInvalid),$(n.Settings.Controls.TransferWorkToControlSelector_Error).show(),!1):($(n.Settings.Controls.TransferWorkToControlSelector_Error).hide(),!0)},ValidateRequestForDate:function(){var n,t,i,r;return(this.Settings.EmployeeLevel==this.Settings.ADMIN_LEVEL||this.Settings.EmployeeLevel==this.Settings.TEAMLEAD_LEVEL)&&(n=this.Settings.ID,t=this.Settings.EmployeeForID,n>0&&t>0&&n!=t&&(i=new Date,r=Functions.parseVietnameseDateTimeToDDMMYYYY2(i),$(this.Settings.Controls.FromDateControlSelector).val()!=r))?($(this.Settings.Controls.FromDateControlSelector_Error).html(this.Settings.ValidationMessage.RequestForDateInvalid),$(this.Settings.Controls.FromDateControlSelector_Error).show(),!1):($(this.Settings.Controls.FromDateControlSelector_Error).hide(),!0)},ValidateEmptyField:function(n,t,i){if(n&&n!="")return $(t).hide(),!0;$(t).html(i);$(t).show()},OnSaveData:function(){var n=this,i=n.OnPreSaveData(),t;i==!0&&(t=n.GetPostData(),$(n.Settings.Controls.SaveControlSelector).prop("disabled","disabled"),n.SaveLeaveData(t))},SaveLeaveData:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.InsertLeaveRequest,location.host);n&&$.ajax({type:"POST",url:i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){t.OnEndSaveLeaveData()})},OnApproveData:function(){var n=this,t;n.ShowOrHideErrorMessage($(".comment_Error"),"");t={};t.Id=n.Settings.Id;t.Comment=$(n.Settings.Controls.CommentControlSelector).val();$(n.Settings.Controls.ApproveControlSelector).prop("disabled","disabled");n.DoApproveLeave(t)},DoApproveLeave:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.ApproveLeaveRequest,location.host);n&&$.ajax({type:"POST",url:i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n&&n.Code===11&&(alert(n.Message),window.location.reload())})},OnRejectData:function(){var n=this,t;n.ShowOrHideErrorMessage($(".comment_Error"),"");t={};t.Id=n.Settings.Id;t.Comment=$(n.Settings.Controls.CommentControlSelector).val();t.Comment&&t.Comment.length>0?($(n.Settings.Controls.SaveControlSelector).prop("disabled","disabled"),n.DoRejectLeave(t)):n.ShowOrHideErrorMessage($(".comment_Error"),n.Settings.ResourceText.CantLeaveTheBlank)},DoRejectLeave:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.RejectLeaveRequest,location.host);n&&$.ajax({type:"POST",url:i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n&&n.Code===12&&(alert(n.Message),window.location.reload())})},OnEndSaveLeaveData:function(){Functions.redirectToSource()},ShowOrHideErrorMessage:function(n,t){t&&t.length>0?($(n).html(t),$(n).show()):($(n).hide(),$(n).html(""))},GetPostData:function(){var n=this,t={},i,r;return t.Requester={LookupId:n.Settings.ID},t.RequestFor={LookupId:$(n.Settings.Controls.RequestForControlSelector+" option:selected").val()},t.Department={LookupId:n.Settings.DepartmentId},t.Location={LookupId:n.Settings.LocationId},i=n.ParseDateFromControl($(n.Settings.Controls.FromDateControlSelector).val(),$(n.Settings.Controls.FromHourControlSelector+" option:selected").val(),$(n.Settings.Controls.FromMinuteControlSelector+" option:selected").val(),0),t.FromDate=RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(i),r=n.ParseDateFromControl($(n.Settings.Controls.ToDateControlSelector).val(),$(n.Settings.Controls.ToHourControlSelector+" option:selected").val(),$(n.Settings.Controls.ToMinuteControlSelector+" option:selected").val(),0),t.ToDate=RBVH.Stada.WebPages.Utilities.String.toISOStringTZ(r),t.LeaveHours=parseFloat(n.Settings.TotalHours),t.Reason=$(n.Settings.Controls.ReasonControlSelector).val(),t.Comment=$(n.Settings.Controls.CommentControlSelector).val(),t.TransferworkTo={LookupId:$(n.Settings.Controls.TransferWorkToControlSelector+" option:selected").val()},t.TLE=n.Settings.TLE,t.DH=n.Settings.DH,t.BOD=n.Settings.BOD,t.Left=!1,t.UnexpectedLeave=n.Settings.UnexpectedLeave,n.Settings.UnexpectedLeave==!0&&(n.Settings.IsFormLeaveRequestFollowPolicy=!1),t.IsValidRequest=n.Settings.IsFormLeaveRequestFollowPolicy,t.Approver={ID:n.Settings.ApproverID},t.TotalDays=n.Settings.TotalDays,t},DisableControls:function(){var n=this;$(n.Settings.Controls.FromDateControlSelector).keydown(function(n){return n.preventDefault(),!1});$(n.Settings.Controls.ToDateControlSelector).keydown(function(n){return n.preventDefault(),!1});n.Settings.Id?($(n.Settings.Controls.SaveControlSelector).prop("disabled","disabled"),$(n.Settings.Controls.FromDateControlSelector).prop("disabled","disabled"),$("#ctl00_PlaceHolderMain_dtFrom_dtFromDateDatePickerImage").hide(),$(n.Settings.Controls.FromHourControlSelector).prop("disabled","disabled"),$(n.Settings.Controls.FromMinuteControlSelector).prop("disabled","disabled"),$("#ctl00_PlaceHolderMain_dtTo_dtToDateDatePickerImage").hide(),$(n.Settings.Controls.ToDateControlSelector).prop("disabled","disabled"),$(n.Settings.Controls.ToHourControlSelector).prop("disabled","disabled"),$(n.Settings.Controls.ToMinuteControlSelector).prop("disabled","disabled"),$(n.Settings.Controls.AddtionalDisplayControlSelector).prop("disabled","disabled"),$("input[name='ctl00$PlaceHolderMain$UploadLeavePplPic']").prop("disabled","disabled"),$(n.Settings.Controls.ReasonControlSelector).prop("disabled","disabled"),$('td[name="tdApprovalStatus"]').show()):$('td[name="tdApprovalStatus"]').hide()},GetAdditionalApprover:function(){var u=this,i=[],r=$(u.Settings.Controls.AddtionalControlSelector).attr("value"),n,t;if(r&&(n=JSON.parse(r),n))for(t=0;t<n.length;t++)i.push({UserName:n[t].Login});return i},ValidateAdditionalApprover:function(){var n=this,u=0,i=n.GetAdditionalApprover(),r,t;if(i.length>0&&(r=n.Settings.CurrentApprover,r))for(t=0;t<i.length;t++)i[t].UserName!=""&&i[t].UserName==r.LoginName&&u++;return u>0?($(n.Settings.Controls.AddtionalControlSelector_Error).html(n.Settings.ValidationMessage.AdditionApproversInValid),$(n.Settings.Controls.AddtionalControlSelector_Error).show(),!1):($(n.Settings.Controls.AddtionalControlSelector_Error).html(""),$(n.Settings.Controls.AddtionalControlSelector_Error).hide(),!0)},PopulateEmployeeList:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.EmployeeList,location.host,t.Settings.LocationId,t.Settings.DepartmentId,6);$.ajax({type:"GET",url:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,cache:!1,success:function(i){t.Settings.EmployeeList=i;i&&i.length>0&&($(t.Settings.RequestForControlSelector).empty(),$(t.Settings.TransferWorkToControlSelector).empty(),$.each(i,function(t,i){$.each(n,function(n,t){$(t).append($("<option>").attr("value",i.ID).text(i.FullName))})}),$(t.Settings.Controls.RequestForControlSelector).val(t.Settings.EmployeeForID).change())}})},OpenDialogBox:function(n){var i=this,t={url:n,width:1e3,height:550,showClose:!0,allowMaximize:!1,title:$("#leavehistorytitle").html()};SP.SOD.execute("sp.ui.dialog.js","SP.UI.ModalDialog.showModalDialog",t)}};