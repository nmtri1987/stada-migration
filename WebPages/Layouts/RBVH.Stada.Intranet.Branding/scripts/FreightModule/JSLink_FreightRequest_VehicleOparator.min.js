(function(){function t(n){return ViewUtilities.Paging.InstanceHtml(n)}function i(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){n.Locale=Strings.STS.L_CurrentUICulture_Name;SP.SOD.registerSod(n.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+n.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(n.ListResourceFileName,"Res",r);SP.SOD.registerSod(n.PageResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+n.PageResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(n.PageResourceFileName,"Res",u);f()},"strings.js");var t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Department/DepartmentService.svc/GetDepartments/"+_spPageContextInfo.currentUICultureName+"/"+_rbvhContext.EmployeeInfo.FactoryLocation.LookupId;$.ajax({url:t,method:"GET",async:!0,headers:{Accept:"application/json; odata=verbose"},success:function(t){t&&t.length>0&&$("#"+n.Container+" .department-locale").each(function(){var n=$(this).attr("data-id"),i=$(this);$(t).each(function(t,r){r.Id.toString()===n&&i.text(r.DepartmentName)})})},error:function(){status="failed"}})}function r(){$("#viewDetailTH_freightOperator").text(Res.freightManagement_ViewDetail);$("#requesterTH_freightOperator").text(Res.freightManagement_Requester);$("#requestNoTH_freightOperator").text(Res.freightManagement_RequestNumber);$("#departmentTH_freightOperator").text(Res.overtime_Department);$("#bringerTH_freightOperator").text(Res.freightManagement_Bringer);$("#receiverTH_freightOperator").text(Res.freightManagement_Receiver);$("#createdTH_freightOperator").text(Res.createdDate);$("#commentTH_freightOperator").text(Res.commonComment);$("#approvalStatusTH_freightOperator").text(Res.freightManagement_ApprovalStatus);$("#vehicle_freightOperator").text(Res.freightManagement_Vehicle);$("#"+n.Container+" .viewDetail").text(Res.freightManagement_ViewDetail);$(".label-success").text(Res.approvalStatus_Approved);$(".label-warning").text(Res.approvalStatus_Cancelled);$(".label-danger").text(Res.approvalStatus_Rejected);n.CompanyVehicle=Res.freightManagement_CompanyVehicle;$(".companyvehicle").text(n.CompanyVehicle)}function u(){n.FreightManagement_UpdateFreightSuccess=Res.freightManagement_UpdateVehicleSuccess}function f(){var n=$("td[name^='vehicleTd_']"),t,i;_rbvhContext&&_rbvhContext.EmployeeInfo&&(t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetVehicleOperatorInfo/"+_rbvhContext.EmployeeInfo.ID,i=$.ajax({url:t,method:"GET",async:!1,headers:{Accept:"application/json; odata=verbose"}}),i.done(function(t){var u,r;if(t){if(u=t.HasPermission,n&&n.length>0)for(r=0;r<n.length;r++){var i=n[r],h=$(i).attr("itemId"),c=$(i).attr("selectedVehicleId"),f=e(h,t.FreightVehicles,c);u==!0?($(i).append(f[0]),$(f[1]).insertAfter(i)):$(i).append(vehicleValue)}u==!0&&o()}s()},function(){console.log("Error")}))}function e(n,t,i){var e=_spPageContextInfo.currentLanguage,o="ddVehicle_"+n,c="button_"+n,u='<select style="width: 145px; display: inline;" name="'+o+'" selectedVehicleId="'+i+'" itemId="'+n+'">',s="None",r,f,h;if(s=e==1066?"Không có":"None",u+='<option vehiclevaluevn="" value="0" vehiclevalue="">'+s+"<\/option>",t&&t.length>0)for(r=0;r<t.length;r++)f=t[r].Vehicle,e==1066&&(f=t[r].VehicleVN),u+='<option vehicleLookupId="'+t[r].ID+'" vehiclevaluevn="'+t[r].VehicleVN+'" vehiclevalue="'+t[r].Vehicle+'" value="'+t[r].ID+'">'+f+"<\/option>";return u+="<\/select>",h='<td><button class="btn btn-primary update-Freight" style="display: inline; margin-left: 5px; font-size: smaller" name="'+c+'" ddName="'+o+'" type="button">OK<\/button><\/td>',[u,h]}function o(){var n=$("select[name^='ddVehicle_']"),t,i,r;if(n&&n.length>0)for(t=0;t<n.length;t++)i=n[t],r=$(i).attr("selectedVehicleId"),r&&$(i).val(r.trim()).change()}function s(){$(".update-Freight").on("click",function(){var c=$(this),f=c.attr("ddName"),e=$("select[name='"+f+"']").attr("itemId"),i=$("select[name='"+f+"'] option:selected"),o=i.attr("vehiclevaluevn"),s=i.attr("vehiclevalue"),r=i.attr("value"),h,t,u;e!=undefined&&o!=undefined&&s!=undefined&&(h=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/FreightManagement/FreightManagementService.svc/UpdateFreightVehicle",t={},t.Id=parseInt(e),u=r>0&&r.length>0?parseInt(r):0,t.VehicleLookup={LookupId:parseInt(u),LookupValue:s},t.VehicleVN={LookupId:parseInt(u),LookupValue:o},$.ajax({url:h,method:"POST",async:!1,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.Code==0&&alert(n.FreightManagement_UpdateFreightSuccess)},error:function(){console.log("Update vehicle failed")}}))})}function h(t){var h="<td>"+t.CurrentItem.Requester[0].lookupValue+"<\/td>",c=t.CurrentItem.RequestNo!=null?"<td>"+t.CurrentItem.RequestNo+"<\/td>":"<td><\/td>",l='<td class="department-locale" data-id="'+t.CurrentItem.CommonDepartment[0].lookupId+'">'+t.CurrentItem.CommonDepartment[0].lookupValue+"<\/td>",e="<td><\/td>",o,i,u,f,s;e=t.CurrentItem.Bringer&&t.CurrentItem.Bringer[0].lookupId>0?"<td>"+t.CurrentItem.Bringer[0].lookupValue+"<\/td>":t.CurrentItem.BringerName&&t.CurrentItem.BringerName.length>0?"<td>"+t.CurrentItem.BringerName+"<\/td>":'<td class="companyvehicle">'+n.CompanyVehicle+"<\/td>";var a=t.CurrentItem.Receiver!=null?"<td>"+t.CurrentItem.Receiver+"<\/td>":"<td><\/td>",v="<td>"+t.CurrentItem.Created+"<\/td>",y=t.CurrentItem.CommonComment!=null?"<td>"+Functions.parseComment(t.CurrentItem.CommonComment)+"<\/td>":"<td><\/td>",r=window.location.href.split("#")[0];return r=Functions.removeParam("lang",r),r+="#tab5",r=encodeURIComponent(r),o='<td><a href="/SitePages/FreightRequest.aspx?subSection=FreightManagement&itemId='+t.CurrentItem.ID+"&Source="+r+'"   class="viewDetail" >View Detail<\/a><\/td>',i=t.CurrentItem.ApprovalStatus+"",i=i.toLowerCase(),u="",u=i=="approved"?'<td><span class="label label-success">Approved<\/span><\/td>':i=="cancelled"?'<td><span class="label label-warning">Cancelled<\/span><\/td>':i=="rejected"?'<td><span class="label label-danger">Rejected<\/span><\/td>':i&&i.length>0?'<td><span class="label label-default statusmultilang">'+t.CurrentItem.ApprovalStatus+"<\/span><\/td>":'<td><span class="label label-default">In-Progress<\/span><\/td>',f="0",t.CurrentItem.VehicleLookup&&t.CurrentItem.VehicleLookup[0]&&(f=t.CurrentItem.VehicleLookup[0].lookupId),s='<td name="vehicleTd_'+t.CurrentItem.ID+'" itemId="'+t.CurrentItem.ID+'" selectedVehicleId="'+f+'" ><\/td>',"<tr>"+o+c+h+l+e+a+v+y+u+s+"<\/tr>"}var n={FreightManagement_ViewDetail:"View Detail",FreightManagement_Requester:"Requester",FreightManagement_Department:"Department",FreightManagement_Bringer:"Bringer",FreightManagement_Receiver:"Received by",FreightManagement_Created:"Created",FreightManagement_Comment:"Comment",FreightManagement_ApprovalStatus:"Approval status",FreightManagement_RequestNumber:"Request number",FreightManagement_Vehicle:"Vehicle",ListResourceFileName:"RBVHStadaLists",PageResourceFileName:"RBVHStadaWebpages",CompanyVehicle:"Company's Vehicle",Locale:"",FreightManagement_UpdateFreightSuccess:"Update vehicle successfully!",Container:"freight-vehicle-operator-container"};(function(){var r={};r.Templates={};r.Templates.Item=h;r.OnPreRender=function(){$(".ms-menutoolbar").hide()};r.ListTemplateType=10015;r.BaseViewID=7;r.OnPostRender=i;r.Templates.Header="<div class='col-md-12'><table class='table'><thead><tr><th id='viewDetailTH_freightOperator'>"+n.FreightManagement_ViewDetail+"<\/th><th id='requestNoTH_freightOperator'>"+n.FreightManagement_RequestNumber+"<\/th><th id='requesterTH_freightOperator'>"+n.FreightManagement_Requester+"<\/th><th id='departmentTH_freightOperator'>"+n.FreightManagement_Department+"<\/th><th id='bringerTH_freightOperator'>"+n.FreightManagement_Bringer+"<\/th><th id='receiverTH_freightOperator'>"+n.FreightManagement_Receiver+"<\/th><th id='createdTH_freightOperator'>"+n.FreightManagement_Created+"<\/th><th id='commentTH_freightOperator'>"+n.FreightManagement_Comment+"<\/th><th id='approvalStatusTH_freightOperator'>"+n.FreightManagement_ApprovalStatus+"<\/th><th id='vehicle_freightOperator' style='min-width:80px;'>"+n.FreightManagement_Vehicle+"<\/th><th><\/th><\/tr><\/thead><tbody>";r.Templates.Footer=t;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(r)})()})();