RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.FreightByDepartment=function(n){var t=window.location.pathname;this.Settings={Id:n.Id,BeginDate:21,DepartmentList:window.location.protocol+"//{0}/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentsByLcid/{1}/{2}",VehicleList:window.location.protocol+"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetFreightVehicles",ExportFreight:window.location.protocol+"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/ExportFreights/{1}/{2}/{3}/{4}/{5}",CurrentDepartmentId:0,AllDepartments:"All/Tất cả",VehicleId:"",IsMonthOnly:!1};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.FreightByDepartment.prototype={Initialize:function(){var n=this;$(document).ready(function(){SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.RegisterEvents()})})},InitControls:function(){var n=this,f;$(n.Settings.ToDateControlSelector).length===0&&(n.Settings.IsMonthOnly=!0);f={};$(n.Settings.FromDateControlSelector).datepicker({viewMode:"days",minViewMode:"days",format:"dd/mm/yyyy",autoclose:!0});$(n.Settings.ToDateControlSelector).datepicker({viewMode:"days",minViewMode:"days",format:"dd/mm/yyyy",autoclose:!0});n.PopulateComboboxes();var t=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminFromDate"),i=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminToDate"),r=n.Settings.CurrentDepartmentId>0?n.Settings.CurrentDepartmentId:RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId"),u=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminVehicleId");!!t==!1||!!r==!1||!!i==!1?n.RebindUrl(t,i,r,u,!1):(n.Settings.DepartmentId=r,n.Settings.VehicleId=u,n.Settings.FromDate=t,n.Settings.ToDate=i,$(n.Settings.DepartmentControlSelector).val(r),$(n.Settings.VehicleControlSelector).val(u),$(n.Settings.FromDateControlSelector).val(t),$(n.Settings.ToDateControlSelector).val(i),n.Settings.CurrentDepartmentId>0&&$(n.Settings.DepartmentControlSelector).prop("disabled",!0))},RegisterEvents:function(){var n=this;$(n.Settings.FromDateControlSelector).on("changeDate",function(){n.RebindUrl($(this).val(),n.Settings.ToDate,n.Settings.DepartmentId,n.Settings.VehicleId,!0)});$(n.Settings.ToDateControlSelector).on("changeDate",function(){n.RebindUrl(n.Settings.FromDate,$(this).val(),n.Settings.DepartmentId,n.Settings.VehicleId,!0)});$(n.Settings.DepartmentControlSelector).on("change",function(){n.Settings.DepartmentId=$(this).val();n.RebindUrl(n.Settings.FromDate,n.Settings.ToDate,n.Settings.DepartmentId,n.Settings.VehicleId,!0)});$(n.Settings.VehicleControlSelector).on("change",function(){n.Settings.VehicleId=$(this).val();n.RebindUrl(n.Settings.FromDate,n.Settings.ToDate,n.Settings.DepartmentId,n.Settings.VehicleId,!0)});if($(n.Settings.ExportControlSelector).length>0)$(n.Settings.ExportControlSelector).on("click",function(){var t=$(n.Settings.FromDateControlSelector).val().split("/"),i=$(n.Settings.ToDateControlSelector).val().split("/"),r=t[2]+"-"+t[1]+"-"+t[0],u=i[2]+"-"+i[1]+"-"+i[0],f=n.Settings.DepartmentId,e=n.Settings.VehicleId,o=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ExportFreight,location.host,r,u,f,_rbvhContext.EmployeeInfo.FactoryLocation.LookupId,e);window.location=o})},PopulateComboboxes:function(){var n=this,i=_spPageContextInfo.currentLanguage,r=_rbvhContext.EmployeeInfo!=null?_rbvhContext.EmployeeInfo.FactoryLocation.LookupId:2,t=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.DepartmentList,location.host,i,r);$(n.Settings.DepartmentControlSelector).attr("disabled",!1);$(n.Settings.DepartmentControlSelector).empty();$.ajax({type:"GET",url:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value","0").text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage)));$(t).each(function(){$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))});n.Settings.DepartmentId=$(n.Settings.DepartmentControlSelector).val()}});t=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.VehicleList,location.host);$(n.Settings.VehicleControlSelector).attr("disabled",!1);$(n.Settings.VehicleControlSelector).empty();$.ajax({type:"GET",url:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){$(n.Settings.VehicleControlSelector).append($("<option>").attr("value","0").text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage)));var i=_spPageContextInfo.currentLanguage=="1066"?"VehicleVN":"Vehicle";$(t).each(function(){$(n.Settings.VehicleControlSelector).append($("<option>").attr("value",this.Id).text(this[i]))});n.Settings.VehicleId=$(n.Settings.VehicleControlSelector).val()}})},toISOStringTZ:function(n){var t=(new Date).getTimezoneOffset()*6e4;return new Date(n.getTime()-t).toISOString().slice(0,-1)},RebindUrl:function(n,t,i,r,u){var v=this,l=window.location.hash,f=window.location.href.split("#")[0],e=new Date,c=n,o,s,h,a;c=typeof c!="undefined"?c:v.toISOStringTZ(new Date(e.getFullYear(),e.getMonth(),e.getDay()));o=t;o=typeof o!="undefined"?o:v.toISOStringTZ(new Date(e.getFullYear(),e.getMonth(),e.getDay()));s=i;s=typeof s!="undefined"?s:"0";h=r;h=typeof h!="undefined"?h:"0";a="";a=f.indexOf("?")>=0?"&":"?";f=f.indexOf("AdminFromDate=")>0?f.replace(/(AdminFromDate=)[^\&]+/,"$1"+c):f+a+"AdminFromDate="+c;f=f.indexOf("AdminToDate=")>0?f.replace(/(AdminToDate=)[^\&]+/,"$1"+o):f+"&AdminToDate="+o;f=f.indexOf("AdminDeptId=")>0?f.replace(/(AdminDeptId=)[^\&]+/,"$1"+s):f+"&AdminDeptId="+s;f=f.indexOf("AdminVehicleId=")>0?f.replace(/(AdminVehicleId=)[^\&]+/,"$1"+h):f+"&AdminVehicleId="+h;!u||(f=ViewUtilities.Paging.RemovePagingURL(f));l&&l.length>0&&(f+=l);window.location.href=f}};