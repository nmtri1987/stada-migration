RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.BusinessTripRequest=function(n){this.Protocol=window.location.protocol;this.Settings={Id:0,ServiceUrls:{GetEmployeeInDepartment:"//{0}/_vti_bin/Services/Employee/EmployeeService.svc/GetEmployeeListInCurrentDepartment/{1}/{2}",InsertBusinessTripRequest:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/InsertBusinessTripManagement",GetBusinessTripRequestById:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/GetBusinessTripManagementById/{1}",GetApprovers:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/GetApprovers/{1}/{2}",ApproveBusinessTripRequest:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/ApproveBusinessTrip",DriverCommentBusinessTrip:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/DriverUpdateBusinessTrip",CashierCommentBusinessTrip:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/CashierUpdateBusinessTrip",RejectBusinessTripRequest:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/RejectBusinessTrip",GetApprovalPermission:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/HasApprovalPermission/{1}",GetDelegatedTaskInfo:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/GetDelegatedTaskInfo/{1}",GetTaskHistoryInfo:"//{0}/_vti_bin/Services/BusinessTripManagement/BusinessTripManagementService.svc/GetTaskHistory/{1}/{2}",GetConfigurations:"//{0}/_vti_bin/Services/Configurations/ConfigurationsService.svc/GetConfigurations"},Data:{},Configurations:{},ConfigKey_ValidDepartureDate:"BusinessForm_ValidDepartureDate",DelegatedTaskInfo:{},EmployeeGrid:{},ScheduleGrid:{CustomFields:{DepartTimeField:null,DepartDateField:null}},CurrentEmployeeLookupId:0,Approvers:{DH:{},DirectBOD:{},BOD:{},AdminDept:{}},Requester:{LookupId:0,LookupValue:""},Driver:{LookupId:0,LookupValue:""},Cashier:{LookupId:0,LookupValue:""},IsDriver:!1,IsCashier:!1,CurrentEmployeeDepartmentID:0,CurrentEmployeeLocationID:0,EmployeeJsonArray:[],ScheduleJsonArray:[],ViewMode:"Edit"};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.BusinessTripRequest.prototype={Initialize:function(){var n=this;SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.Settings.CurrentLcid=_spPageContextInfo.currentLanguage;n.SetCurrentEmployeeInfo();n.InitRequiredFields();n.InitControls()})},SetCurrentEmployeeInfo:function(){var n=this;_rbvhContext&&_rbvhContext.EmployeeInfo&&(n.Settings.CurrentEmployeeID=_rbvhContext.EmployeeInfo.EmployeeID,n.Settings.CurrentEmployeeFullName=_rbvhContext.EmployeeInfo.FullName,n.Settings.CurrentEmployeeLocationID=_rbvhContext.EmployeeInfo.FactoryLocation.LookupId,n.Settings.CurrentEmployeeDepartmentID=_rbvhContext&&_rbvhContext.EmployeeInfo&&_rbvhContext.EmployeeInfo.Department?_rbvhContext.EmployeeInfo.Department.LookupId:0,n.Settings.CurrentEmployeeLookupId=_rbvhContext.EmployeeInfo.ID,n.Settings.Requester={LookupId:n.Settings.CurrentEmployeeLookupId},n.Settings.CurrentEmployeeLevel=parseFloat(_rbvhContext.EmployeeInfo.EmployeeLevel.LookupValue))},GetConfigurations:function(){var n=this,t=[n.Settings.ConfigKey_ValidDepartureDate],i=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetConfigurations,location.host);$.ajax({type:"POST",url:i,data:JSON.stringify(t),cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t&&t.length>0&&(n.Settings.Configurations=t)})},InitControls:function(){var n=this,t;n.RegisterEvents();n.Settings.ViewMode="View";t=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid");t>0?(n.Settings.Id=t,n.BindDataToControls(t),n.GetApprovalPermission(t).then(function(i){i&&i===!0?n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):n.Settings.ViewMode="Approve":n.GetDelegatedTaskInfo(t).then(function(t){t&&t.Requester.LookupId>0&&(n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):(n.Settings.DelegatedTaskInfo=t,n.Settings.ViewMode="Approve"))})})):(n.LoadApprovers(n.Settings.CurrentEmployeeDepartmentID,n.Settings.CurrentEmployeeLocationID),n.Settings.ViewMode="Create",n.BindEmployeeList(n.Settings.CurrentEmployeeDepartmentID),$(n.Settings.Controls.InternalTripTypeControlSelector).prop("checked",!0),$(n.Settings.Controls.HotelBookingControlSelector).prop("checked",!0),n.PopulateHotelBooking(!0),$(n.Settings.Controls.CashOrChequeControlSelector).hide(100),$(n.Settings.Controls.OtherTransportDetailControlSelector).hide(100),$(n.Settings.Controls.OtherRequestControlSelector).hide(100));n.ToggleButtons(n.Settings.ViewMode);n.GetConfigurations();n.BindGridColumns();n.PopulateGrid()},RegisterEvents:function(){var n=this;$(n.Settings.Controls.EmployeeListControlSelector).select2({width:"150px"});$(n.Settings.Controls.AddEmployeeControlSelector).on("click",function(){var t=$(n.Settings.Controls.EmployeeListControlSelector+" option:selected"),r,i;t.length>0&&(r=t.attr("emp-code"),i=t.attr("dept-name"),$(n.Settings.Controls.SpanDepartmentSelector).text(i),n.Settings.EmployeeJsonArray.push({EmployeeId:$(n.Settings.Controls.EmployeeListControlSelector).val(),FullName:t.text(),EmployeeCode:r,DepartmentName:i}),$(n.Settings.Controls.EmployeeListGridControlSelector).jsGrid("loadData"),$(n.Settings.Controls.EmployeeListControlSelector).find("option:selected").remove())});$(n.Settings.Controls.HotelBookingControlSelector).change(function(){n.ToggleCheckbox($(this),[$(n.Settings.Controls.PaidByContainerSelector),$(n.Settings.Controls.OtherServiceContainerSelector)])});$(n.Settings.Controls.CashChequeRequestOptionControlSelector).change(function(){n.ToggleCheckbox($(this),[$(n.Settings.Controls.CashOrChequeControlSelector)])});$(n.Settings.Controls.OtherRequestOptionControlSelector).change(function(){n.ToggleCheckbox($(this),[$(n.Settings.Controls.OtherRequestControlSelector)])});$("input[name=TransportationType]:radio").change(function(){$(n.Settings.Controls.OtherTransportOptionControlSelector).prop("checked")===!0?$(n.Settings.Controls.OtherTransportDetailControlSelector).show(100):$(n.Settings.Controls.OtherTransportDetailControlSelector).hide(100)});$(n.Settings.Controls.SaveControlSelector).on("click",function(){var t=n.ValidateRequiredFields("Submit");return t&&n.OnSaveData("Submit"),!1});$(n.Settings.Controls.CancelControlSelector).on("click",function(n){n.preventDefault();Functions.redirectToSource()});$(n.Settings.Controls.RejectControlSelector).on("click",function(){var t=n.ValidateRequiredFields("Reject");return t&&n.OnSaveData("Reject"),!1});$(n.Settings.Controls.ApproveControlSelector).on("click",function(){var t=n.ValidateRequiredFields("Approve");return t&&n.OnSaveData("Approve"),!1});$(n.Settings.Controls.ApprovalHistoryButtonSelector).on("click",function(t){t.preventDefault();var i=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid"),r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetTaskHistoryInfo,location.host,i,0);$.ajax({type:"GET",url:r,cache:!1,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var i=[n.Settings.ResourceText.ApprovalStatusTitle,n.Settings.ResourceText.PostedByTitle,n.Settings.ResourceText.DateTitle,n.Settings.ResourceText.CommentTitle],r=[n.Settings.ResourceText.ApprovalStatus_Approved,n.Settings.ResourceText.ApprovalStatus_Rejected],u=Functions.generateApprovalHistoryTable(t,i,r,n.Settings.ResourceText.NoDataAvaibleMsg);$(n.Settings.Controls.ApprovalHistoryContainerSelector).html(u)})})},ToggleOffEvents:function(){var n=this;$(n.Settings.Controls.BusinessTripContainerSelector+' :input:not("'+n.Settings.Controls.CancelControlSelector+'")').prop("disabled",!0);$(n.Settings.Controls.ApprovalHistoryButtonSelector).prop("disabled",!1);$(n.Settings.Controls.BusinessTripContainerSelector+" span").off("click");$(n.Settings.Controls.AddEmployeeControlSelector).css("color","gray")},ToggleCheckbox:function(n,t){n.prop("checked")===!0?t.forEach(function(n){n.show(100)}):t.forEach(function(n){n.hide(100)})},PopulateHotelBooking:function(n){n?($(this.Settings.Controls.PaidByContainerSelector).show(100),$(this.Settings.Controls.OtherServiceContainerSelector).show(100)):($(this.Settings.Controls.PaidByContainerSelector).hide(100),$(this.Settings.Controls.OtherServiceContainerSelector).hide(100))},BindGridColumns:function(){var n=this,t;n.BindDepartDateField();n.BindDepartTimeField();t=n.Settings.ViewMode==="Approve"||n.Settings.ViewMode==="View";n.Settings.EmployeeGrid.Fields=[{name:"EmployeeId",title:"EmployeeId",readOnly:!0,headercss:"hide"},{name:"FullName",title:n.Settings.EmployeeGrid.ColumnTitles.GridColumn_FullName,width:180,align:"left",type:"text"},{name:"EmployeeCode",title:n.Settings.EmployeeGrid.ColumnTitles.GridColumn_Code,width:110,align:"center",type:"text"},{name:"DepartmentName",title:n.Settings.EmployeeGrid.ColumnTitles.GridColumn_Department,width:200,align:"center",type:"text"},{type:"control",editButton:!1,deleteButton:!t,width:40,modeSwitchButton:!1}];jsGrid.fields.custDepartTimeField=n.Settings.ScheduleGrid.CustomFields.DepartTimeField;jsGrid.fields.custDepartDateField=n.Settings.ScheduleGrid.CustomFields.DepartDateField;n.Settings.ScheduleGrid.Fields=[{name:"DepartTime",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_DepartTime,width:130,align:"center",type:"custDepartTimeField"},{name:"DepartDate",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_DepartDate,width:90,align:"center",type:"custDepartDateField"},{name:"FlightName",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_FlightName,width:90,align:"left",type:"text"},{name:"City",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_City,width:90,align:"left",type:"text"},{name:"Country",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_Country,width:90,align:"left",type:"text"},{name:"ContactCompany",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_ContactCompany,width:130,align:"left",type:"text"},{name:"ContactPhone",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_ContactPhone,width:100,align:"left",type:"text"},{name:"OtherSchedule",title:n.Settings.ScheduleGrid.ColumnTitles.GridColumn_OtherSchedule,width:90,align:"left",type:"text"},{type:"control",editButton:!1,deleteButton:!t,width:40,modeSwitchButton:!1}]},BindDepartDateField:function(){var t=this,n=new Date,i,r,u;try{i=Functions.getConfigValue(t.Settings.Configurations,t.Settings.ConfigKey_ValidDepartureDate);i&&(r=parseInt(i),n.setDate(n.getDate()+r))}catch(f){n=new Date}u=n;t.Settings.ScheduleGrid.CustomFields.DepartDateField=function(n){jsGrid.Field.call(this,n)};t.Settings.ScheduleGrid.CustomFields.DepartDateField.prototype=new jsGrid.Field({sorter:function(n,t){return new Date(n)-new Date(t)},itemTemplate:function(n){return n},insertTemplate:function(){return this._insertPicker=$("<input readonly>").datepicker({defaultDate:u,minDate:n,dateFormat:"dd/mm/yy"})},editTemplate:function(t){var i=Functions.parseVietNameseDate(t);return this._editPicker=$("<input readonly>").datepicker({dateFormat:"dd/mm/yy",minDate:n}).datepicker("setDate",i)},insertValue:function(){var n=this._insertPicker.datepicker("getDate");return n?Functions.parseVietnameseDateTimeToDDMMYYYY2(n):""},editValue:function(){var n=this._editPicker.datepicker("getDate");return n?Functions.parseVietnameseDateTimeToDDMMYYYY2(n):""}})},BindDepartTimeField:function(){var n=this;n.Settings.ScheduleGrid.CustomFields.DepartTimeField=function(n){jsGrid.Field.call(this,n)};n.Settings.ScheduleGrid.CustomFields.DepartTimeField.prototype=new jsGrid.Field({itemTemplate:function(n){var i=n,t=i.split(":");return("0"+t[0]).slice(-2)+":"+("0"+t[1]).slice(-2)},insertTemplate:function(){return this._insertDepartTime=this._createDepartTimeBox()},editTemplate:function(n){var t=n.split(":");return $result=this._editDepartTime=this._createDepartTimeBox(),$result[0].value=("0"+t[0]).slice(-2),$result[2].value=("0"+t[1]).slice(-2),$result},insertValue:function(){var n=$(this._insertDepartTime[0]).val(),t=$(this._insertDepartTime[2]).val();return("0"+n).slice(-2)+":"+("0"+t).slice(-2)},editValue:function(){var n=$(this._editDepartTime[0]).val(),t=$(this._editDepartTime[2]).val();return("0"+n).slice(-2)+":"+("0"+t).slice(-2)},_createDepartTimeBox:function(){for(var i,t,r=$("<select id='cbo-depart-hour' class='form-control' style='width: 54px;' />"),n=0;n<24;n++)t=("0"+n).slice(-2),r.append($("<option>").attr("value",t).text(t));for(i=$("<select id='cbo-depart-minute' class='form-control' style='width: 54px;' />"),n=0;n<60;n++)t=("0"+n).slice(-2),i.append($("<option>").attr("value",t).text(t));return r.add("<span>:<span>").add(i)}})},PopulateGrid:function(){var n=this,t;$(n.Settings.Controls.EmployeeListGridControlSelector).jsGrid({width:"100%",height:"auto",align:"center",inserting:!1,editing:!1,sorting:!1,autoload:!0,noDataContent:"",deleteConfirm:n.Settings.ResourceText.ConfirmDeleteMessage,onDataLoaded:function(){},controller:{loadData:function(){var t=$.Deferred();return t.resolve(n.Settings.EmployeeJsonArray),t.promise()},insertItem:function(){},updateItem:function(){},deleteItem:function(){}},onItemDeleted:function(t){$(n.Settings.Controls.EmployeeListControlSelector).prepend($("<option>").attr("value",t.item.EmployeeId).attr("emp-code",t.item.EmployeeCode).attr("dept-name",t.item.DepartmentName).text(t.item.FullName));$(n.Settings.Controls.EmployeeListControlSelector).prop("selectedIndex",0)},fields:n.Settings.EmployeeGrid.Fields});t=n.Settings.ViewMode==="Approve"||n.Settings.ViewMode==="View";$(n.Settings.Controls.ScheduleGridControlSelector).jsGrid({width:"100%",height:"auto",align:"center",inserting:!t,editing:!t,deleting:!t,sorting:!1,autoload:!0,noDataContent:"",deleteConfirm:n.Settings.ResourceText.ConfirmDeleteMessage,onDataLoaded:function(){},controller:{loadData:function(){var t=$.Deferred();return t.resolve(n.Settings.ScheduleJsonArray),t.promise()},insertItem:function(){},updateItem:function(){},deleteItem:function(){}},onItemInserting:function(t){var i=t.grid._insertRow;t.cancel=!n.ValidateEmployeeItem(t,i)},onItemInserted:function(){},onItemEditing:function(){},onItemUpdated:function(){},onItemUpdating:function(t){var i=t.grid._editingRow.prev();t.cancel=!n.ValidateEmployeeItem(t,i)},onItemDeleted:function(){},onItemEditCancelling:function(){},fields:n.Settings.ScheduleGrid.Fields})},BindEmployeeList:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetEmployeeInDepartment,location.host,n,_rbvhContext.EmployeeInfo.FactoryLocation.LookupId);$.ajax({type:"GET",url:i,cache:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){var u,r,i;if(n)for($(t.Settings.Controls.EmployeeListControlSelector).empty(),u=t.Settings.EmployeeJsonArray.map(function(n){return n.EmployeeId}),r=n.filter(function(n){return u.indexOf(n.ID)<0}),i=0;i<r.length;i++)$(t.Settings.Controls.EmployeeListControlSelector).append($("<option>").attr("value",r[i].ID).attr("emp-code",r[i].EmployeeId).attr("dept-name",r[i].DepartmentName).text(r[i].FullName))})},BindDataToControls:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetBusinessTripRequestById,location.host,n);$.ajax({type:"GET",url:i,contentType:"application/json; charset=utf-8",cache:!1,async:!1,dataType:"json"}).done(function(n){t.Settings.Data=n;t.Settings.CurrentEmployeeLookupId===n.Requester.LookupId&&(t.Settings.ViewMode=n.ModifiedBy.ID===n.CreatedBy.ID&&n.ApprovalStatus&&n.ApprovalStatus.toLowerCase()!=="cancelled"?"Edit":"View");t.Settings.Requester=n.Requester;t.Settings.Approvers.DH=n.DH;t.Settings.Approvers.DirectBOD=n.DirectBOD;t.Settings.Approvers.BOD=n.BOD;t.Settings.Approvers.AdminDept=n.AdminDept;t.Settings.Driver=n.Driver;t.Settings.Cashier=n.Cashier;$(t.Settings.Controls.InternalTripTypeControlSelector).prop("checked",n.Domestic);$(t.Settings.Controls.ExternalTripTypeControlSelector).prop("checked",!n.Domestic);t.Settings.EmployeeJsonArray=n.EmployeeList||[];$(t.Settings.Controls.EmployeeListGridControlSelector).jsGrid("loadData");(t.Settings.ViewMode==="View"||t.Settings.ViewMode==="Approve")&&$(t.Settings.Controls.EmployeeListControlSelector).parent("div").hide();t.BindEmployeeList(t.Settings.CurrentEmployeeDepartmentID);$(t.Settings.Controls.PurposeControlSelector).val(n.BusinessTripPurpose);t.Settings.ScheduleJsonArray=n.ScheduleList||[];$(t.Settings.Controls.ScheduleGridControlSelector).jsGrid("loadData");$(t.Settings.Controls.HotelBookingControlSelector).prop("checked",n.HotelBooking);n.HotelBooking?($(t.Settings.Controls.PaidByContainerSelector).show(),$(t.Settings.Controls.PaidByControlSelector).val(n.PaidBy),$(t.Settings.Controls.OtherServiceContainerSelector).show(),$(t.Settings.Controls.OtherServiceControlSelector).val(n.OtherService)):($(t.Settings.Controls.PaidByContainerSelector).hide(),$(t.Settings.Controls.OtherServiceContainerSelector).hide());$("input[name=TransportationType]:checked").prop("checked",!1);$(t.Settings.Controls.OtherTransportDetailControlSelector).hide();switch(n.TransportationType){case t.Settings.ResourceText.CompanyTransportationTitle:$(t.Settings.Controls.CompanyTransportOptionControlSelector).prop("checked",!0);break;case t.Settings.ResourceText.PrivateTransportationTitle:$(t.Settings.Controls.PrivateTransportOptionControlSelector).prop("checked",!0);break;case t.Settings.ResourceText.OtherTransportationTitle:$(t.Settings.Controls.OtherTransportDetailControlSelector).show();$(t.Settings.Controls.OtherTransportOptionControlSelector).prop("checked",!0);$(t.Settings.Controls.OtherTransportDetailControlSelector).val(n.OtherTransportationDetail)}$(t.Settings.Controls.VisaRequestOptionControlSelector).prop("checked",n.HasVisa);n.CashRequestDetails?($(t.Settings.Controls.CashChequeRequestOptionControlSelector).prop("checked",!0),$(t.Settings.Controls.CashOrChequeControlSelector).show(),$(t.Settings.Controls.CashOrChequeControlSelector).val(n.CashRequestDetails)):$(t.Settings.Controls.CashOrChequeControlSelector).hide();n.OtherRequestDetail?($(t.Settings.Controls.OtherRequestOptionControlSelector).prop("checked",!0),$(t.Settings.Controls.OtherRequestControlSelector).show(),$(t.Settings.Controls.OtherRequestControlSelector).val(n.OtherRequestDetail)):$(t.Settings.Controls.OtherRequestControlSelector).hide();n.TripHighPriority&&n.TripHighPriority===!0?$(t.Settings.Controls.HighPriorityControlSelector).prop("checked",!0):$(t.Settings.Controls.HighPriorityControlSelector).prop("checked",!1);n.Comment&&n.Comment.length>0&&($(t.Settings.Controls.CommentControlSelector).html(Functions.parseComment(n.Comment)),$(t.Settings.Controls.CommentContainerSelector).show());n.ApprovalStatus&&n.ApprovalStatus.length>0&&($(t.Settings.Controls.ApproveStatusValSelector).html(RBVH.Stada.WebPages.Utilities.GUI.generateItemStatus(n.ApprovalStatus)),$(t.Settings.Controls.ApproveStatusContainerSelector).show())})},LoadApprovers:function(n,t){var i=this,r=RBVH.Stada.WebPages.Utilities.String.format(i.Settings.ServiceUrls.GetApprovers,location.host,n,t);$.ajax({type:"GET",url:r,cache:!1,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&(i.Settings.Approvers.DH=n.Approver1,i.Settings.Approvers.DirectBOD=n.Approver2,i.Settings.Approvers.BOD=n.Approver3,i.Settings.Approvers.AdminDept=n.Approver4)})},InitRequiredFields:function(){var n=this;$(n.Settings.Controls.BusinessTripContainerSelector+" span.l-required:visible").each(function(){$(this).html($(this).html()+" *")})},ValidateRequiredFields:function(n){var t=this,i=!0;return $(t.Settings.Controls.BusinessTripContainerSelector+" .t-required:visible").each(function(){$.trim($(this).val())===""?($(this).addClass("require-error"),i=!1):$(this).removeClass("require-error")}),t.Settings.EmployeeJsonArray.length===0?($(t.Settings.Controls.EmployeeListGridControlSelector).addClass("require-error"),i=!1):$(t.Settings.Controls.EmployeeListGridControlSelector).removeClass("require-error"),t.Settings.ScheduleJsonArray.length===0?($(t.Settings.Controls.ScheduleGridControlSelector).addClass("require-error"),i=!1):$(t.Settings.Controls.ScheduleGridControlSelector).removeClass("require-error"),n==="Reject"&&($(t.Settings.Controls.YourCommentControlSelector).val().length===0?($(t.Settings.Controls.YourCommentControlSelector).addClass("require-error"),i=!1):$(t.Settings.Controls.YourCommentControlSelector).removeClass("require-error")),i},ValidateEmployeeItem:function(n,t){var i=!0;return $.trim(n.item.ContactCompany)===""?(t.find("td:nth-child(6) input").addClass("require-error"),i=!1):t.find("td:nth-child(6) input").removeClass("require-error"),$.trim(n.item.DepartDate)===""?(t.find("td:nth-child(2) input").addClass("require-error"),i=!1):t.find("td:nth-child(2) input").removeClass("require-error"),i},CreatePostJsonObject:function(n){var t=this,i={},r={Model:i,Url:""},u;t.Settings.IsDriver?n="Driver":t.Settings.IsCashier&&(n="Cashier");switch(n){case"Submit":i.Id=t.Settings.Id;i.Requester=t.Settings.Requester;i.Domestic=$(t.Settings.Controls.InternalTripTypeControlSelector).prop("checked");i.BusinessTripPurpose=$(t.Settings.Controls.PurposeControlSelector).val();i.HotelBooking=$(t.Settings.Controls.HotelBookingControlSelector).prop("checked");i.HotelBooking?(i.PaidBy=$(t.Settings.Controls.PaidByControlSelector).val(),i.OtherService=$(t.Settings.Controls.OtherServiceControlSelector).val()):i.PaidBy=i.OtherService="";u=$("input[name=TransportationType]:checked",t.Settings.Controls.BusinessTripContainerSelector).val();switch(u){case"company":i.TransportationType=t.Settings.ResourceText.CompanyTransportationTitle;break;case"private":i.TransportationType=t.Settings.ResourceText.PrivateTransportationTitle;break;case"others":i.TransportationType=t.Settings.ResourceText.OtherTransportationTitle;i.OtherTransportationDetail=$(t.Settings.Controls.OtherTransportDetailControlSelector).val()}i.HasVisa=$(t.Settings.Controls.VisaRequestOptionControlSelector).prop("checked");i.CashRequestDetails=$(t.Settings.Controls.CashChequeRequestOptionControlSelector).prop("checked")?$(t.Settings.Controls.CashOrChequeControlSelector).val():"";i.OtherRequestDetail=$(t.Settings.Controls.OtherRequestOptionControlSelector).prop("checked")?$(t.Settings.Controls.OtherRequestControlSelector).val():"";i.Driver=t.Settings.Driver;i.Cashier=t.Settings.Cashier;i.TripHighPriority=$(t.Settings.Controls.HighPriorityControlSelector).prop("checked");i.Comment=$(t.Settings.Controls.YourCommentControlSelector).is(":visible")?$(t.Settings.Controls.YourCommentControlSelector).val():"";i.DH={UserName:t.Settings.Approvers.DH!==null?t.Settings.Approvers.DH.LoginName:""};i.DirectBOD={UserName:t.Settings.Approvers.DirectBOD!==null?t.Settings.Approvers.DirectBOD.LoginName:""};i.BOD={UserName:t.Settings.Approvers.BOD!==null?t.Settings.Approvers.BOD.LoginName:""};i.AdminDept={UserName:t.Settings.Approvers.AdminDept!==null?t.Settings.Approvers.AdminDept.LoginName:""};i.EmployeeList=t.Settings.EmployeeJsonArray;i.ScheduleList=t.Settings.ScheduleJsonArray.map(function(n){var t=n,i=moment(n.DepartDate+" "+n.DepartTime,"DD/MM/YYYY hh:mm",!0);return t.DepartDate=i.toDate().toISOString(),t});r.Model=i;r.Url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.InsertBusinessTripRequest,location.host);break;case"Approve":i={Id:this.Settings.Id,TripHighPriority:$(t.Settings.Controls.HighPriorityControlSelector).prop("checked"),CashRequestDetails:$(t.Settings.Controls.CashOrChequeControlSelector).val(),Comment:$(this.Settings.Controls.YourCommentControlSelector).is(":visible")?$(this.Settings.Controls.YourCommentControlSelector).val():""};r.Model=i;r.Url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.ApproveBusinessTripRequest,location.host);break;case"Driver":i={Id:this.Settings.Id,Driver:{LookupId:t.Settings.Driver.LookupId},Comment:$(this.Settings.Controls.YourCommentControlSelector).is(":visible")?$(this.Settings.Controls.YourCommentControlSelector).val():""};r.Model=i;r.Url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.DriverCommentBusinessTrip,location.host);break;case"Cashier":i={Id:this.Settings.Id,Cashier:{LookupId:t.Settings.Cashier.LookupId},Comment:$(this.Settings.Controls.YourCommentControlSelector).is(":visible")?$(this.Settings.Controls.YourCommentControlSelector).val():""};r.Model=i;r.Url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.CashierCommentBusinessTrip,location.host);break;case"Reject":i={Id:this.Settings.Id,Comment:$(this.Settings.Controls.YourCommentControlSelector).is(":visible")?$(this.Settings.Controls.YourCommentControlSelector).val():""};r.Model=i;r.Url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.RejectBusinessTripRequest,location.host)}return r},ToggleButtons:function(n){var t=this,i=$(t.Settings.Controls.BusinessTripContainerSelector+' button:not("'+t.Settings.Controls.CancelControlSelector+'")');i.prop("disabled",!0);$(t.Settings.Controls.ApprovalHistoryButtonSelector).prop("disabled",!1);switch(n){case"Approve":i.hide();t.ToggleOffEvents();t.EnableApprovalElements();$(t.Settings.Controls.SaveControlSelector).hide();$(t.Settings.Controls.ApproveControlSelector).show();$(t.Settings.Controls.RejectControlSelector).show();$(t.Settings.Controls.ApproveControlSelector).prop("disabled",!1);$(t.Settings.Controls.RejectControlSelector).prop("disabled",!1);$(t.Settings.Controls.YourCommentContainerSelector).show();$(t.Settings.Controls.YourCommentControlSelector).prop("disabled",!1);$(t.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").show();$(t.Settings.Controls.ApprovalHistoryButtonSelector).show();break;case"Edit":case"Create":i.hide();$(t.Settings.Controls.SaveControlSelector).show();$(t.Settings.Controls.SaveControlSelector).prop("disabled",!1);$(t.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").hide();break;case"View":t.ToggleOffEvents();i.hide();$(t.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").show();$(t.Settings.Controls.ApprovalHistoryButtonSelector).show();t.EnableCommentElements()}},OnSaveData:function(n){var t=this,i;t.ToggleButtons("OnSaving");i=t.CreatePostJsonObject(n);i.Model&&t.OnSubmitData(i.Model,i.Url).then(function(n){n&&n.Code===0?Functions.redirectToSource():n&&n.Code!==0&&n.Code!==999?(alert(n.Message),window.location.reload()):t.ToggleButtons(t.Settings.ViewMode)})},OnSubmitData:function(n,t){var i=this;return $.ajax({type:"POST",url:t,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"})},EnableApprovalElements:function(){var n=this;n.Settings.Data&&n.Settings.Data.Domestic===!0&&(n.Settings.CurrentEmployeeLevel===5&&_rbvhContext.EmployeeInfo.ADAccount.ID===n.Settings.Approvers.DH.ID||n.Settings.DelegatedTaskInfo.FromEmployee&&n.Settings.DelegatedTaskInfo.FromEmployee.ID===n.Settings.Approvers.DH.ID)?($(n.Settings.Controls.HighPriorityContainerSelector).show(),$(n.Settings.Controls.HighPriorityControlSelector).prop("disabled",!1)):$(n.Settings.Controls.HighPriorityContainerSelector).hide();_rbvhContext.EmployeeInfo.ADAccount.ID!==n.Settings.Approvers.DH.ID&&_rbvhContext.EmployeeInfo.ADAccount.ID!==n.Settings.Approvers.BOD.ID&&_rbvhContext.EmployeeInfo.ADAccount.ID!==n.Settings.Approvers.DirectBOD.ID&&(!n.Settings.DelegatedTaskInfo.FromEmployee||n.Settings.DelegatedTaskInfo.FromEmployee.ID!==n.Settings.Approvers.DH.ID&&n.Settings.DelegatedTaskInfo.FromEmployee.ID!==n.Settings.Approvers.BOD.ID&&n.Settings.DelegatedTaskInfo.FromEmployee.ID!==n.Settings.Approvers.DirectBOD.ID)||$(n.Settings.Controls.CashChequeRequestOptionControlSelector).prop("checked")&&$(n.Settings.Controls.CashOrChequeControlSelector).prop("disabled",!1)},EnableCommentElements:function(){var n=this;_rbvhContext.EmployeeInfo.ID===n.Settings.Driver.LookupId?($(n.Settings.Controls.SaveControlSelector).show(),$(n.Settings.Controls.SaveControlSelector).prop("disabled",!1),$(n.Settings.Controls.YourCommentContainerSelector).show(),$(n.Settings.Controls.YourCommentControlSelector).prop("disabled",!1),n.Settings.IsDriver=!0):_rbvhContext.EmployeeInfo.ID===n.Settings.Cashier.LookupId?($(n.Settings.Controls.SaveControlSelector).show(),$(n.Settings.Controls.SaveControlSelector).prop("disabled",!1),$(n.Settings.Controls.YourCommentContainerSelector).show(),$(n.Settings.Controls.YourCommentControlSelector).prop("disabled",!1),n.Settings.IsCashier=!0):($(n.Settings.Controls.YourCommentContainerSelector).hide(),$(n.Settings.Controls.YourCommentControlSelector).prop("disabled",!0))},GetApprovalPermission:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetApprovalPermission,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},GetDelegatedTaskInfo:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetDelegatedTaskInfo,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},FormatNumber:function(n,t){var i="000000000"+n;return i.substr(i.length-t)},ParseProperty:function(n,t,i){switch(i){case"radio":$(n).find("[name='"+t+"']")}}};