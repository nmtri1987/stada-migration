RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.TransportationByDepartment=function(n){var t=window.location.pathname;this.Settings={Id:n.Id,BeginDate:21,DepartmentList:window.location.protocol+"//{0}/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentsByLcid/{1}/{2}",CurrentDepartmentId:0};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.TransportationByDepartment.prototype={Initialize:function(){var n=this;$(document).ready(function(){SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.RegisterEvents()})})},InitControls:function(){var n=this,u;$(n.Settings.MonthControlSelector).datepicker({viewMode:"months",minViewMode:"months",format:"mm/yyyy",autoclose:!0});n.PopulateDepartment();var t=n.Settings.CurrentDepartmentId>0?n.Settings.CurrentDepartmentId:RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId"),i=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminStartMonth"),r=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminEndMonth");if(!!i==!1||!!r==!1||!!t==!1)n.RebindUrl(i,r,t);else{if(n.Settings.DepartmentId=t,n.Settings.StartMonth=i,n.Settings.EndMonth=r,$(n.Settings.DepartmentControlSelector).val(t),u=Date.parse(i),u!=NaN){var f=new Date(u),e=f.getMonth()+1,o=f.getFullYear();$(n.Settings.MonthControlSelector).val(e+"/"+o)}n.Settings.CurrentDepartmentId>0&&$(n.Settings.DepartmentControlSelector).prop("disabled",!0)}},RegisterEvents:function(){var n=this;$(n.Settings.MonthControlSelector).on("changeDate",function(t){var i=t.date.getMonth(),r=t.date.getYear()+1900,u,f;$(".datepicker").hide();u=new Date(r,i,1);f=new Date(r,i+1,0,23,59,59);n.RebindUrl(n.toISOStringTZ(u),n.toISOStringTZ(f),n.Settings.DepartmentId,!0)});$(n.Settings.DepartmentControlSelector).on("change",function(){n.Settings.DepartmentId=$(this).val();n.RebindUrl(n.Settings.StartMonth,n.Settings.EndMonth,n.Settings.DepartmentId,!0)})},PopulateDepartment:function(){var n=this,t=_spPageContextInfo.currentLanguage,i=_rbvhContext.EmployeeInfo!=null?_rbvhContext.EmployeeInfo.FactoryLocation.LookupId:2,r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.DepartmentList,location.host,t,i);$(n.Settings.DepartmentControlSelector).attr("disabled",!1);$(n.Settings.DepartmentControlSelector).empty();$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){n.Settings.CurrentDepartmentId==0&&$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",n.Settings.CurrentDepartmentId).text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage)));$(t).each(function(){$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))});n.Settings.DepartmentId=$(n.Settings.DepartmentControlSelector).val()}})},toISOStringTZ:function(n){var t=(new Date).getTimezoneOffset()*6e4;return new Date(n.getTime()-t).toISOString().slice(0,-1)},RebindUrl:function(n,t,i){var c=this,s=window.location.hash,r=window.location.href.split("#")[0],o=new Date,e=n,u,f,h;e=typeof e!="undefined"?e:c.toISOStringTZ(new Date(o.getFullYear(),o.getMonth(),1));u=t;u=typeof u!="undefined"?u:c.toISOStringTZ(new Date(o.getFullYear(),o.getMonth()+1,0,23,59,59));f=i;f=typeof f!="undefined"?f:"0";h="";h=r.indexOf("?")>=0?"&":"?";r=r.indexOf("AdminStartMonth=")>0?r.replace(/(AdminStartMonth=)[^\&]+/,"$1"+e):r+h+"AdminStartMonth="+e;r=r.indexOf("AdminEndMonth=")>0?r.replace(/(AdminEndMonth=)[^\&]+/,"$1"+u):r+"&AdminEndMonth="+u;r=r.indexOf("AdminDeptId=")>0?r.replace(/(AdminDeptId=)[^\&]+/,"$1"+f):r+"&AdminDeptId="+f;s&&s.length>0&&(r+=s);window.location.href=r}};