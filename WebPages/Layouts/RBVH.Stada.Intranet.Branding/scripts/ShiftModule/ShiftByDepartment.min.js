RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.ShiftByDepartment=function(n){var t=window.location.pathname;this.Settings={Id:n.Id,BeginDate:21,PageUrl:window.location.protocol+"//{0}"+t+"?Month={1}&Year={2}",DepartmentList:window.location.protocol+"//{0}/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentForShift/{1}/{2}",CurrentDepartmentId:0};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.ShiftByDepartment.prototype={Initialize:function(){var n=this;SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.RegisterEvents()})},InitControls:function(){var n=this;$(n.Settings.MonthControlSelector).datepicker({viewMode:"months",minViewMode:"months",format:"mm/yyyy",autoclose:!0});var t=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminMonth"),i=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminYear"),r=n.Settings.CurrentDepartmentId>0?n.Settings.CurrentDepartmentId:RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId");!!t==!1||!!i==!1||!!r==!1?n.RebindUrl(t,i,r):(n.PopulateDepartment(),n.Settings.DepartmentId=r,n.Settings.Month=t,n.Settings.Year=i,$(n.Settings.MonthControlSelector).val(t+"/"+i),$(n.Settings.DepartmentControlSelector).val(r));n.Settings.CurrentDepartmentId>0&&$(n.Settings.DepartmentControlSelector).prop("disabled",!0)},RegisterEvents:function(){var n=this;$(n.Settings.MonthControlSelector).on("changeDate",function(t){var i=t.date.getMonth()+1,r=t.date.getYear()+1900;$(".datepicker").hide();n.RebindUrl(i,r,n.Settings.DepartmentId,!0)});$(n.Settings.DepartmentControlSelector).on("change",function(){n.Settings.DepartmentId=$(this).val();n.RebindUrl(n.Settings.Month,n.Settings.Year,n.Settings.DepartmentId,!0)})},PopulateDepartment:function(){var n=this,t=_spPageContextInfo.currentLanguage,i=_rbvhContext.EmployeeInfo!=null?_rbvhContext.EmployeeInfo.FactoryLocation.LookupId:2,r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.DepartmentList,location.host,t,i);$(n.Settings.DepartmentControlSelector).attr("disabled",!1);$(n.Settings.DepartmentControlSelector).empty();$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){n.Settings.CurrentDepartmentId==0&&$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",n.Settings.CurrentDepartmentId).text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage)));$(t).each(function(){$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))});n.Settings.DepartmentId=$(n.Settings.DepartmentControlSelector).val()}})},RebindUrl:function(n,t,i,r){var f=n,e=t,h=window.location.hash,u=window.location.href.split("#")[0],o=i,s,l,c;(!!n==!1||!!t==!1)&&(s=new Date,l=s.getDate(),f=s.getMonth()+1,e=s.getYear()+1900,l>20&&f++,f==13&&(e++,f=1));o=typeof o!="undefined"?i:"0";c="";c=u.indexOf("?")>=0?"&":"?";u=u.indexOf("AdminMonth=")>0?u.replace(/(AdminMonth=)[^\&]+/,"$1"+f):u+c+"AdminMonth="+f;u=u.indexOf("AdminYear=")>0?u.replace(/(AdminYear=)[^\&]+/,"$1"+e):u+"&AdminYear="+e;u=u.indexOf("AdminDeptId=")>0?u.replace(/(AdminDeptId=)[^\&]+/,"$1"+o):u+"&AdminDeptId="+o;!r||(u=ViewUtilities.Paging.RemovePagingURL(u));h&&h.length>0&&(u+=h);window.location.href=u}};