function HideEditRibbon(){try{var n=SP.Ribbon.PageManager.get_instance().get_ribbon();SelectRibbonTab("Ribbon.Read",!0);try{n.removeChild("Ribbon.ListForm.Display")}catch(t){}try{n.removeChild("Ribbon.ListForm.Edit")}catch(t){}}catch(t){}}function OnPageResourcesReady(){$("#save-button").val(Res.saveButton);$("#cancel-button").val(Res.cancelButton);$("#DepartmentName-Title").text(Res.employeeDepartmentName);ChangeShiftRequestForm.RequiredField=Res.requiredField;ChangeShiftRequestForm.DepartmentNameRequiredField=Res.departmentNameRequired;ChangeShiftRequestForm.ChangeShiftItemExist=Res.changeShift_ItemExist;$("span .ms-accentText").prop("title",Res.requiredField);$("#departmentName").prop("title",Res.departmentNameRequired);ChangeShiftRequestForm.DontHaveShift=Res.changeShift_DontHaveShift}function OnListResourcesReady(){ChangeShiftRequestForm.FromDateErrorMessage_1=decodeURI(Res.fromDateGeqTodateErrorMessage_1);ChangeShiftRequestForm.ShiftsEqualErrorMessage=Res.changeShiftList_ShiftsEqualErrorMessage}function GetParameterByName(n){url=window.location.href;n=n.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),t=i.exec(url);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function ChangeShiftRequestFormOnPostRender(n){var s=GetParameterByName("TextOnly"),f,e,r,i,o,t,u;if(s&&(ChangeShiftRequestForm.IsTextOnly=!0),SP.SOD.executeOrDelayUntilScriptLoaded(function(){SP.SOD.registerSod(ChangeShiftRequestForm.PageResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+ChangeShiftRequestForm.PageResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(ChangeShiftRequestForm.PageResourceFileName,"Res",OnPageResourcesReady);SP.SOD.registerSod(ChangeShiftRequestForm.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+ChangeShiftRequestForm.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(ChangeShiftRequestForm.ListResourceFileName,"Res",OnListResourcesReady)},"strings.js"),n.BaseViewID=="DisplayForm")$("#save-button").hide(),ChangeShiftRequestForm.IsTextOnly?$("#close-button").hide():$("#close-button").show(),$("#cancel-button").hide(),ChangeShiftRequestForm.ViewOnly=!0,f=$("#Custom_FromShift a").text(),$("#Custom_FromShift a").remove(),$("#Custom_FromShift").html(f),e=$("#Custom_ToShift a").text(),$("#Custom_ToShift a").remove(),$("#Custom_ToShift").html(e),r=$("#Custom_DepartmentSelect a").attr("href"),i="",r&&(i=Functions.getParamByName("ID",r)),i>0&&(o=_spPageContextInfo.currentLanguage,Functions.loadDepartment(i,"#Custom_DepartmentName","",o));else{$(".commomcomment").hide();$("#Custom_ToShift select option").each(function(){($(this).val()==7||$(this).val()==8||$(this).val()==9||$(this).val()==10)&&$(this).remove()});$("#Custom_FromShift select").html("<option selected><\/option>");$("#Custom_Requester br").remove();$("#Custom_FromShift select").attr("disabled",!0);GetConfigurations();t=Functions.parseVietNameseDate($(CustomFormControl.ChangeShiftFromSelect).val());try{u=Functions.getConfigValue(ChangeShiftRequestForm.Configurations,ChangeShiftRequestForm.ConfigKey_ValidFromDate);ChangeShiftRequestForm.DiffDays=u?parseInt(u):0}catch(h){ChangeShiftRequestForm.DiffDays=0}t.setDate(t.getDate()+ChangeShiftRequestForm.DiffDays);$(CustomFormControl.ChangeShiftFromSelect).val(Functions.parseVietnameseDateTimeToDDMMYYYY2(t));$(CustomFormControl.ChangeShiftToSelect).val(Functions.parseVietnameseDateTimeToDDMMYYYY2(t));LoadEmployeeData();DisableControl();$("#Custom_ToShift select").find("option:contains('QL Kho')").remove();$(CustomFormControl.ChangeShiftFromSelect).get(0).onvaluesetfrompicker=function(){var n=$(CustomFormControl.ChangeShiftFromSelect).val();$("#Custom_To input").val(n);GetShiftTimeFrom(Functions.parseVietNameseDate($(CustomFormControl.ChangeShiftFromSelect).val()),ChangeShiftRequestForm.DepartmentId,ChangeShiftRequestForm.LocationId,ChangeShiftRequestForm.employeeId);$("#Custom_From_Error").html("");ChangeShiftRequestForm.IsHasShift=!1}}$("#DeltaPlaceHolderMain").addClass("border-container")}function DisableControl(){$(CustomFormControl.DepartmentNameInput).prop("disabled",!0);$(CustomFormControl.RequesterSelect).prop("disabled",!0);$(CustomFormControl.ChangeShiftToSelect).prop("disabled",!0);$(CustomFormControl.ChangeShiftToIcon).hide()}function GetConfigurations(){var n=[ChangeShiftRequestForm.ConfigKey_ValidFromDate],t=RBVH.Stada.WebPages.Utilities.String.format(ChangeShiftRequestForm.GetConfigurations,location.host);$.ajax({type:"POST",url:t,data:JSON.stringify(n),cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.length>0&&(ChangeShiftRequestForm.Configurations=n)})}function LoadEmployeeData(){var n=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Employee/EmployeeService.svc/GetCurrentUser",t=$.ajax({type:"GET",url:n,contentType:"application/json; charset=utf-8",dataType:"json"});t.then(function(n){n!=null?(LoadApprovers(n.ID),AppendDataToControl(n)):$(CustomFormControl.RequesterError).html(NotOvertimeForm.CannotLoadCurrentUserMessage)},function(){})}function AppendDataToControl(n){n.Department!=null&&(GetDepartmentName(n.Department.LookupId,n.Department.LookupValue),ChangeShiftRequestForm.DepartmentId=n.Department.LookupId,$(CustomFormControl.DepartmentSelectHidden).val(n.Department.LookupId).change(),ChangeShiftRequestForm.LocationId=n.Location.LookupId,$(CustomFormControl.LocationSelectHidden).val(n.Location.LookupId).change());n.ID!=undefined&&n.ID>0&&($(CustomFormControl.RequesterSelect).val(n.ID).change(),ChangeShiftRequestForm.employeeId=n.ID);var t=Functions.parseVietNameseDate($(CustomFormControl.ChangeShiftFromSelect).val());GetShiftTimeFrom(t,n.Department.LookupId,n.Location.LookupId,n.ID)}function GetShiftTimeFrom(n,t,i,r){var u=n.getDate(),f=n.getMonth()+1,e=n.getFullYear(),o=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/ShiftTime/ShiftTimeService.svc/GetShiftTimeInDate/"+u+"/"+f+"/"+e+"/"+t+"/"+i+"/"+r,s=$.ajax({type:"GET",url:o,contentType:"application/json; charset=utf-8",dataType:"json"});s.then(function(n){$("#save-button").show();n.Id==0?($("#Custom_FromShift select").html("<option selected><\/option>"),ChangeShiftRequestForm.IsHasShift=!1):($("#Custom_FromShift select").html("<option value='"+n.Id+"'>"+n.Name+"<\/option>"),$("span[role='alert']").text(""),ChangeShiftRequestForm.IsHasShift=!0,n.Code=="P"&&$("#save-button").hide())},function(){})}function GetDepartmentName(n,t){var i=_spPageContextInfo.currentLanguage,r=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentByIdLanguageCode/"+n+"/"+i,u=$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json"});u.then(function(n){n!=null?(ChangeShiftRequestForm.ViewOnly&&$(CustomFormControl.DepartmentNameLabel).html(n.DepartmentName),$(CustomFormControl.DepartmentNameInput).val(n.DepartmentName)):(ChangeShiftRequestForm.ViewOnly&&$(CustomFormControl.DepartmentNameLabel).html(t),$(CustomFormControl.DepartmentNameInput).val(t))},function(){ChangeShiftRequestForm.ViewOnly&&$(CustomFormControl.DepartmentNameLabel).html(t);$(CustomFormControl.DepartmentNameInput).val(t)})}function LoadApprovers(n){var t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Employee/EmployeeService.svc/GetEmployeeApprovers/"+n,i=$.ajax({type:"GET",url:t,contentType:"application/json; charset=utf-8",dataType:"json"});i.then(function(t){t!=null&&PopulateApprovers(t,n)},function(){})}function PopulateApprovers(n,t){var i=[],r;i.push(null);CheckIsManager(t);r="";r=ChangeShiftRequestForm.IsManager?n.Approver3?n.Approver3.LoginName:"":n.Approver2?n.Approver2.LoginName:"";i.push({InternalFieldName:"CommonApprover1",FullLoginUserName:r});ExecuteOrDelayUntilScriptLoaded(function(){var n=$(CustomFormControl.ApproverCustom);Functions.populateApprovertoPeoplePicker(i,t,n)},"clientpeoplepicker.js")}function Submit(n){ValidateForm()&&($("#Custom_From_Error").html(""),$("#Custom_ToShift_Error").html(""),IsChangeShiftExist().then(function(t){if(t)$("#Custom_From_Error").html(ChangeShiftRequestForm.ChangeShiftItemExist);else{var i=SPClientForms.ClientFormManager.SubmitClientForm(n);$("#save-button").prop("disabled",i)}}))}function ValidateForm(){return ValidateDates()?ValidateShifts()?ChangeShiftRequestForm.IsHasShift?($("#Custom_From_Error").html(),$("#Custom_ToShift_Error").html(),!0):($("span[role='alert']").text(""),$("#Custom_From_Error").html(ChangeShiftRequestForm.DontHaveShift),!1):($("#Custom_ToShift_Error").html(ChangeShiftRequestForm.ShiftsEqualErrorMessage),!1):($("#Custom_From_Error").html(RBVH.Stada.WebPages.Utilities.String.format(ChangeShiftRequestForm.FromDateErrorMessage_1,ChangeShiftRequestForm.DiffDays)),!1)}function ValidateShifts(){return $("#Custom_FromShift select").val()!=$("#Custom_ToShift select").val()}function ValidateDates(){var t,r,i,n,u;if($("#Custom_To input").val()=="")return!1;t=Functions.parseVietNameseDate($(CustomFormControl.ChangeShiftFromSelect).val());r=Functions.parseVietNameseDate($("#Custom_To input").val());GetConfigurations();try{i=Functions.getConfigValue(ChangeShiftRequestForm.Configurations,ChangeShiftRequestForm.ConfigKey_ValidFromDate);ChangeShiftRequestForm.DiffDays=i?parseInt(i):0}catch(f){ChangeShiftRequestForm.DiffDays=0}return n=new Date,n=new Date(n.getFullYear(),n.getMonth(),n.getDate()),u=n.setDate(n.getDate()+ChangeShiftRequestForm.DiffDays),t.valueOf()==r.valueOf()&&t.valueOf()>=u.valueOf()}function Cancel(){var n=Functions.getParameterByName("Source");(typeof n=="undefined"||n.length==0)&&(n=_spPageContextInfo.listUrl);window.location.href=n}function ChangeShiftRequestView(n){var t=ChangeShiftRequestForms.getHtml(),i;return t=t.replace("{{Requester_Title}}",Functions.getSPFieldTitle(n,"Requester")),t=t.replace("{{DepartmentName_Title}}",ChangeShiftRequestForm.DepartmentName),t=t.replace("{{FromShift_Title}}",Functions.getSPFieldTitle(n,"FromShift")),t=t.replace("{{From_Title}}",Functions.getSPFieldTitle(n,"CommonFrom")),t=t.replace("{{ToShift_Title}}",Functions.getSPFieldTitle(n,"ToShift")),t=t.replace("{{To_Title}}",Functions.getSPFieldTitle(n,"To")),t=t.replace("{{Reason_Title}}",Functions.getSPFieldTitle(n,"Reason")),t=t.replace("{{BOD_Title}}",Functions.getSPFieldTitle(n,"CommonApprover2")),t=t.replace("{{DPH_Title}}",Functions.getSPFieldTitle(n,"CommonApprover1")),t=t.replace("{{DepartmentID_Title}}",Functions.getSPFieldTitle(n,"CommonDepartment")),t=t.replace("{{LocationID_Title}}",Functions.getSPFieldTitle(n,"CommonLocation")),t=t.replace("{{CommonComment_Title}}",Functions.getSPFieldTitle(n,"CommonComment")),t=t.replace("{{Requester}}",Functions.getSPFieldRender(n,"Requester")),i='<span dir="none">  <input type="text" value="" maxlength="255" id="departmentName" title="{{RequiredFieldDepartment}}" style="ime-mode : " class="ms-long ms-spellcheck-true" /><\/span>',n.BaseViewID=="DisplayForm"&&(i=""),t=t.replace("{{DepartmentName}}",i),t=t.replace("{{FromShift}}",Functions.getSPFieldRender(n,"FromShift")),t=t.replace("{{From}}",Functions.getSPFieldRender(n,"CommonFrom")),t=t.replace("{{ToShift}}",Functions.getSPFieldRender(n,"ToShift")),t=t.replace("{{To}}",Functions.getSPFieldRender(n,"To")),t=t.replace("{{Reason}}",Functions.getSPFieldRender(n,"Reason")),t=t.replace("{{DPH}}",Functions.getSPFieldRender(n,"CommonApprover1")),t=t.replace("{{DepartmentID}}",Functions.getSPFieldRender(n,"CommonDepartment")),t=t.replace("{{LocationID}}",Functions.getSPFieldRender(n,"CommonLocation")),t=t.replace("{{CommonComment}}",Functions.getSPFieldRender(n,"CommonComment")),t=t.replace("{{SaveButton}}",ChangeShiftRequestForm.SaveButton),t=t.replace("{{CancelButton}}",ChangeShiftRequestForm.CancelButton),t=t.replace("{{CloseButton}}",ChangeShiftRequestForm.CloseButton),t=t.replace(/{{RequiredFieldText}}/gi,ChangeShiftRequestForm.RequiredField),t=t.replace("{{RequiredFieldDepartment}}",ChangeShiftRequestForm.DepartmentNameRequiredField),t.replace("{{FormId}}",n.FormUniqueId)}function CheckIsManager(n){var i=_spPageContextInfo.webAbsoluteUrl+String(ChangeShiftRequestForm.IsManagerServiceUrl)+n,t=$.Deferred();return $.ajax({url:i,type:"get",async:!1,success:function(n){ChangeShiftRequestForm.IsManager=n;t.resolve(n)},error:function(){return!1}}),t.promise()}function IsChangeShiftExist(){var t=Functions.parseVietNameseDate($(CustomFormControl.ChangeShiftFromSelect).val()),i=$(CustomFormControl.RequesterSelect+" option:selected").val(),r=Functions.parseDateTimeToMMDDYYYY(t),n=$.Deferred(),u=_spPageContextInfo.webAbsoluteUrl+String(ChangeShiftRequestForm.IsChangeShifExistServiceUrl)+i+"/"+r;return $.ajax({type:"GET",cache:!1,url:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){n.resolve(t)},error:function(){return!0}}),n.promise()}var ChangeShiftRequestForm={SaveButton:"Save",CancelButton:"Cancel",CloseButton:"Close",ListResourceFileName:"RBVHStadaLists",PageResourceFileName:"RBVHStadaWebpages",RequiredField:"This is a required field.",DepartmentName:"Department Name",DepartmentNameRequiredField:"Department Name Required Field",DontHaveShift:"You don't have any shift in selected date",DepartmentId:"",EmployeeID:"",ViewOnly:!1,FromDateErrorMessage_1:"From Date must be greater than current date {0} day(s)",ShiftsEqualErrorMessage:"To shift must be different with from shift",IsManagerServiceUrl:"/_vti_bin/Services/Employee/EmployeeService.svc/IsManager/",IsChangeShifExistServiceUrl:"/_vti_bin/Services/ShiftManagement/ShiftManagementService.svc/IsChangeShiftExist/",GetConfigurations:"//{0}/_vti_bin/Services/Configurations/ConfigurationsService.svc/GetConfigurations",ChangeShiftItemExist:"This date has already been requested",IsManager:!0,IsHasShift:!1,IsTextOnly:!1,ConfigKey_ValidFromDate:"ChangeShiftForm_ValidFromDate",Configurations:{},DiffDays:0},CustomFormControl,ChangeShiftRequestForms;(function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){var t=SP.Ribbon.PageManager.get_instance(),n;t.add_ribbonInited(function(){HideEditRibbon()});n=null;try{n=t.get_ribbon()}catch(i){}n?HideEditRibbon():typeof _ribbonStartInit=="function"&&_ribbonStartInit(_ribbon.initialTabId,!1,null);ChangeShiftRequestForm.IsTextOnly&&$("#s4-ribbonrow").hide()},"sp.ribbon.js");var n={};n.Templates={};n.OnPostRender=ChangeShiftRequestFormOnPostRender;n.Templates.View=ChangeShiftRequestView;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(n)})();CustomFormControl={DepartmentNameInput:"#Custom_DepartmentName input",DepartmentNameLabel:"#Custom_DepartmentName #lblDepartmentName",RequesterSelect:"#Custom_Requester select",RequesterError:"#CustomError_Requester",ChangeShiftFromSelect:"#Custom_From input",ChangeShiftToSelect:"#Custom_To input",ChangeShiftToIcon:"#Custom_To a",ApproverCustom:"#DPH",DepartmentSelectHidden:"#Custom_DepartmentSelect select",LocationSelectHidden:"#Custom_LocationSelect select"};ChangeShiftRequestForms={getHtml:function(){return'<table class="ms-formtable" style="margin-top: 8px; min-width:720px;" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody> <tr>     <td nowrap="true" valign="top" class="ms-formlabel" width="15%">         <span class="ms-h3 ms-standardheader">\t\t        <nobr>{{Requester_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody"  width="33%">         <div id="Custom_Requester" >{{Requester}}<span id="CustomError_Requester" class="ms-formvalidation ms-csrformvalidation"><span role="alert"><\/span><\/div>     <\/td>     <td nowrap="true" valign="top" class="ms-formlabel custom-table-cell"  width="15%">         <span class="ms-h3 ms-standardheader">\t\t        <nobr><span id="DepartmentName-Title">{{DepartmentName_Title}}<\/span><span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody"  width="33%">         <div id="Custom_DepartmentName" >{{DepartmentName}}<div>     <\/td> <\/tr> <tr>     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">             <nobr> {{From_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="Custom_From">{{From}}<\/div>         <div id="Custom_From_Error" style="color:#bf0000;"><\/div>     <\/td>     <td nowrap="true" valign="top" class="ms-formlabel custom-table-cell">         <span class="ms-h3 ms-standardheader">             <nobr>{{FromShift_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody ">         <div id="Custom_FromShift">{{FromShift}}<\/div>     <\/td> <\/tr> <tr>     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">             <nobr> {{To_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="Custom_To">{{To}}<\/div>         <div id="Custom_To_Error" style="color:#bf0000;"><\/div>     <\/td>     <td nowrap="true" valign="top" class="ms-formlabel custom-table-cell">         <span class="ms-h3 ms-standardheader">             <nobr>{{ToShift_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"> *<\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="Custom_ToShift">{{ToShift}}<\/div>         <div id="Custom_ToShift_Error" style="color:#bf0000;"><\/div>     <\/td> <\/tr> <tr>     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">             <nobr> {{DPH_Title}}<span class="ms-accentText" title="{{RequiredFieldText}}"><\/span><\/nobr>         <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="DPH">{{DPH}}<\/div>     <\/td> <\/tr> <tr>     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">\t\t        <nobr>{{Reason_Title}}<\/nobr>\t        <\/span>     <\/td>     <td valign="top" class="ms-formbody" colspan="3">         {{Reason}}     <\/td> <\/tr> <tr style="display: none;">     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">\t\t        <nobr>{{DepartmentID_Title}}<\/nobr>\t        <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="Custom_DepartmentSelect">{{DepartmentID}}<\/div>     <\/td> <\/tr> <tr style="display: none;">     <td nowrap="true" valign="top" class="ms-formlabel">         <span class="ms-h3 ms-standardheader">\t\t        <nobr>{{LocationID_Title}}<\/nobr>\t        <\/span>     <\/td>     <td valign="top" class="ms-formbody">         <div id="Custom_LocationSelect">{{LocationID}}<\/div>     <\/td> <\/tr> <tr>     <td nowrap="true" valign="top" class="ms-formlabel commomcomment">         <span class="ms-h3 ms-standardheader">\t\t        <nobr>{{CommonComment_Title}}<\/nobr>\t        <\/span>     <\/td>     <td valign="top" class="ms-formbody commomcomment">         <div>{{CommonComment}}<\/div>     <\/td> <\/tr> <tr>     <td colspan=\'4\'><div style=\'float: right;\'><input type=\'button\' value=\'{{SaveButton}}\' onclick="Submit(\'{{FormId}}\')" id=\'save-button\' style=\'margin-left:0\' class=\'ms-ButtonHeightWidth\' > <input class=\'ms-ButtonHeightWidth\' type=\'button\' value=\'{{CancelButton}}\' id=\'cancel-button\' onclick="Cancel()"> <input class=\'ms-ButtonHeightWidth\' type=\'button\' value=\'{{CloseButton}}\' onclick="Cancel()" style=\'display:none\' id=\'close-button\'> <\/div><\/td> <\/tr><\/tbody><\/table>'}};