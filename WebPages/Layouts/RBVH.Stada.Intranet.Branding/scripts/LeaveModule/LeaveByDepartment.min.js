RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.LeaveByDepartment=function(n){var t=window.location.pathname;this.Settings={Id:n.Id,BeginDate:21,DepartmentList:window.location.protocol+"//{0}/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentsByLcid/{1}/{2}",ExportLeaves:window.location.protocol+"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/ExportLeaves/{1}/{2}/{3}/{4}",CurrentDepartmentId:0,AllDepartments:"All/Tất cả",DeptIds:[]};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.LeaveByDepartment.prototype={Initialize:function(){var n=this;$(document).ready(function(){SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.RegisterEvents()})})},InitControls:function(){var n=this,t;$(n.Settings.FromDateControlSelector).datepicker({viewMode:"days",minViewMode:"days",format:"dd/mm/yyyy",autoclose:!0});$(n.Settings.ToDateControlSelector).datepicker({viewMode:"days",minViewMode:"days",format:"dd/mm/yyyy",autoclose:!0});n.Settings.DepartmentsToView&&n.Settings.DepartmentsToView.length>0&&(n.Settings.DeptIds=n.Settings.DepartmentsToView.split("#"));n.PopulateDepartment();var i=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminFromDate"),r=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminToDate"),t=n.Settings.CurrentDepartmentId>0?n.Settings.CurrentDepartmentId:RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId");n.Settings.DeptIds&&n.Settings.DeptIds.length>1&&(t=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId"));!!i==!1||!!r==!1||!!t==!1?n.RebindUrl(i,r,t):(n.Settings.DepartmentId=t,n.Settings.FromDate=i,n.Settings.ToDate=r,$(n.Settings.DepartmentControlSelector).val(t),$(n.Settings.FromDateControlSelector).val(i),$(n.Settings.ToDateControlSelector).val(r),n.Settings.CurrentDepartmentId>0&&$(n.Settings.DepartmentControlSelector).prop("disabled",!0),n.Settings.CurrentDepartmentId>0&&n.Settings.DeptIds&&n.Settings.DeptIds.length>1&&$(n.Settings.DepartmentControlSelector).prop("disabled",!1))},RegisterEvents:function(){var n=this;$(n.Settings.FromDateControlSelector).on("changeDate",function(){n.RebindUrl($(this).val(),n.Settings.ToDate,n.Settings.DepartmentId,!0)});$(n.Settings.ToDateControlSelector).on("changeDate",function(){n.RebindUrl(n.Settings.FromDate,$(this).val(),n.Settings.DepartmentId,!0)});$(n.Settings.DepartmentControlSelector).on("change",function(){n.Settings.DepartmentId=$(this).val();n.RebindUrl(n.Settings.FromDate,n.Settings.ToDate,n.Settings.DepartmentId,!0)});if($(n.Settings.ExportControlSelector).length>0)$(n.Settings.ExportControlSelector).on("click",function(){var t=$(n.Settings.FromDateControlSelector).val().split("/"),i=$(n.Settings.ToDateControlSelector).val().split("/"),r=t[2]+"-"+t[1]+"-"+t[0],u=i[2]+"-"+i[1]+"-"+i[0],f=n.Settings.DepartmentId,e=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ExportLeaves,location.host,r,u,f,_rbvhContext.EmployeeInfo.FactoryLocation.LookupId);window.location=e})},PopulateDepartment:function(){var n=this,t=_spPageContextInfo.currentLanguage,i=_rbvhContext.EmployeeInfo!=null?_rbvhContext.EmployeeInfo.FactoryLocation.LookupId:2,r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.DepartmentList,location.host,t,i);$(n.Settings.DepartmentControlSelector).attr("disabled",!1);$(n.Settings.DepartmentControlSelector).empty();$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){n.Settings.DeptIds&&n.Settings.DeptIds.length>1?$(t).each(function(){n.Settings.DeptIds.indexOf(this.Id.toString())>-1&&$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))}):($(n.Settings.DepartmentControlSelector).append($("<option>").attr("value","0").text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage))),$(t).each(function(){$(n.Settings.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))}),n.Settings.DepartmentId=$(n.Settings.DepartmentControlSelector).val())}})},toISOStringTZ:function(n){var t=(new Date).getTimezoneOffset()*6e4;return new Date(n.getTime()-t).toISOString().slice(0,-1)},RebindUrl:function(n,t,i,r){var l=this,c=window.location.hash,u=window.location.href.split("#")[0],e=new Date,s=n,o,f,h;s=typeof s!="undefined"?s:l.toISOStringTZ(new Date(e.getFullYear(),e.getMonth(),e.getDay()));o=t;o=typeof o!="undefined"?o:l.toISOStringTZ(new Date(e.getFullYear(),e.getMonth(),e.getDay()));f=i;f=typeof f!="undefined"?f:"0";h="";h=u.indexOf("?")>=0?"&":"?";u=u.indexOf("AdminFromDate=")>0?u.replace(/(AdminFromDate=)[^\&]+/,"$1"+s):u+h+"AdminFromDate="+s;u=u.indexOf("AdminToDate=")>0?u.replace(/(AdminToDate=)[^\&]+/,"$1"+o):u+"&AdminToDate="+o;u=u.indexOf("AdminDeptId=")>0?u.replace(/(AdminDeptId=)[^\&]+/,"$1"+f):u+"&AdminDeptId="+f;u=u.indexOf("AdminDeptId=")>0?u.replace(/(AdminDeptId=)[^\&]+/,"$1"+f):u+h+"AdminDeptId="+f;!r||(u=ViewUtilities.Paging.RemovePagingURL(u));c&&c.length>0&&(u+=c);window.location.href=u}};