function GetNonWorkingDays(){var n=RBVH.Stada.WebPages.Utilities.GetValueByParam("MyMonth"),t=RBVH.Stada.WebPages.Utilities.GetValueByParam("MyYear"),u=n-1,f=t,l;n==1&&(u=12,f=t-1);MyShiftConfig.DaysInMonth=new Date(t,n-1,0).getDate();var e=RBVH.Stada.WebPages.Utilities.String.format(MyShiftConfig.ISODateFormat,u,"21",f),a=t,v=n,o=RBVH.Stada.WebPages.Utilities.String.format(MyShiftConfig.ISODateFormat,v,"20",a),r=RBVH.Stada.WebPages.Utilities.String.format(MyShiftConfig.CalendarList,location.host,e,o),i=2,s="NM2",h="",c="";_rbvhContext&&_rbvhContext.EmployeeInfo&&(i=_rbvhContext.EmployeeInfo.FactoryLocation.LookupId,s=_rbvhContext.EmployeeInfo.FactoryLocation.LookupValue,h=_rbvhContext.EmployeeInfo.ID,c=_rbvhContext.EmployeeInfo.Department.LookupId,i=_rbvhContext.EmployeeInfo.FactoryLocation.LookupId);r=r+"/"+i;l=RBVH.Stada.WebPages.Utilities.String.format(MyShiftConfig.LeavesByEmployee,location.host,h,c,i,e,o);$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(n){MyShiftConfig.NonWorkingDays=[];MyShiftConfig.NonWorkingDays=n.filter(function(n){return n.Location==s}).map(function(n){return n.Day})}});$.ajax({type:"GET",url:l,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(n){n&&(MyShiftConfig.LeaveArray=n)}})}function GenerateTD(n,t){var u=" jsgrid-cell jsgrid-align-center ",i="",r=null,f="",h="",e,o,s;return r=$.grep(MyShiftConfig.LeaveArray,function(n){return n.Day==t&&$.inArray(t,MyShiftConfig.NonWorkingDays)<0}),r.length==1&&(f=" jsgrid-cell-half-day ",r[0].AllDay==!0&&(f=" jsgrid-cell-all-day shift-time-valid ",i="P"),h=r[0].ItemUrl),n.CurrentItem["ShiftTime"+t]==""||(e=n.CurrentItem["ShiftTime"+t][0].lookupId-1,o="",MyShiftConfig.ShiftTimeList[e]!=null&&(o=MyShiftConfig.ShiftTimeList[e].Code),i=i!=""?i:o,s=n.CurrentItem["ShiftTime"+t+"Approval"],(s=="Yes"||s=="Có")&&(u=u+" shift-time-valid ")),"<td class='"+u+f+"' data-leave-url='"+h+"'>"+i+"<\/td>"}function myShiftCustomItem(n){var t="<tr>",r="";for(i=21;i<=MyShiftConfig.DaysInMonth;i++)r=GenerateTD(n,i),t=t+r;for(i=1;i<=20;i++)r=GenerateTD(n,i),t=t+r;return t+"<\/tr>"}function renderHeader(){var n="";for(i=21;i<=MyShiftConfig.DaysInMonth;i++)n=n+'<th class="jsgrid-header-cell jsgrid-align-center">'+i+"<\/th>";for(i=1;i<=20;i++)n=n+'<th class="jsgrid-header-cell jsgrid-align-center">'+i+"<\/th>";return"<div class='col-md-12' style='padding-left: 0px;'><table class='table table-bordered' id='myshift'><thead><tr>"+n+"<\/tr><\/thead><tbody>"}function pagingControl(n){return ViewUtilities.Paging.InstanceHtml(n)}function ShiftTimeList(){var t=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getbytitle('"+String(MyShiftConfig.TimeShift_ListTitle)+"')/items",n=$.Deferred();return $.ajax({url:t,method:"GET",async:!1,headers:{Accept:"application/json; odata=verbose"},success:function(t){MyShiftConfig.ShiftTimeList=t.d.results;n.resolve(t.d.results)},error:function(){status="failed"}}),n.promise()}function shiftTimeFormOnPostRender(n){hideShiftTimeDatePicker(n)}function hideDatePicker(n){return Functions.hideDatePickerDisplayForm(n)}function hideShiftTimeDatePicker(){Functions.hideDatePartInDatetimePicker(["ShiftTimeWorkingHourFrom","ShiftTimeWorkingHourTo","ShiftTimeWorkingHourMid","ShiftTimeBreakingHourFrom","ShiftTimeBreakingHourTo"])}(function(){function t(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){n.Locale=Strings.STS.L_CurrentUICulture_Name;SP.SOD.registerSod(n.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+n.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(n.ListResourceFileName,"Res",i)},"strings.js");var t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Department/DepartmentService.svc/GetDepartments/"+_spPageContextInfo.currentUICultureName+"/"+_rbvhContext.EmployeeInfo.FactoryLocation.LookupId;$.ajax({url:t,method:"GET",async:!0,headers:{Accept:"application/json; odata=verbose"},success:function(t){t&&t.length>0&&$("#"+n.Container+" .department-locale").each(function(){var n=$(this).attr("data-id"),i=$(this);$(t).each(function(t,r){r.Id.toString()===n&&i.text(r.DepartmentName)})})},error:function(){status="failed"}})}function i(){$("#"+n.Container+" #titleTHApproval").text(Res.shiftManagement_Title);$("#"+n.Container+" #requesterTHApproval").text(Res.shiftManagement_Requester);$("#"+n.Container+" #departmentTHApproval").text(Res.shiftManagement_Department);$("#"+n.Container+" #locationTHApproval").text(Res.shiftManagement_Location);$("#"+n.Container+" #month").text(Res.shiftManagement_Month);$("#"+n.Container+" #year").text(Res.shiftManagement_Year);$("#"+n.Container+" .viewDetail").text(Res.shiftManagement_ViewDetail);$("#"+n.Container+" .label-success").text(Res.approvalStatus_InProgress);$("#"+n.Container+" .label-default").text(Res.approvalStatus_Approved)}function r(n){var r="<td>"+n.CurrentItem.Requester[0].lookupValue+"<\/td>",t=window.location.href.split("#")[0];t=Functions.removeParam("lang",t);t+="#tab2";t=encodeURIComponent(t);var u='<td><a  href="/SitePages/ShiftApproval.aspx?subSection=ShiftManagement&itemId='+n.CurrentItem.ID+"&Source="+t+'"   class="viewDetail" >View Detail<\/a><\/td>',f="<td> "+n.CurrentItem.CommonMonth+"<\/td>",i=n.CurrentItem.CommonYear.replace(".","");i=i.replace(",","");var e="<td> "+i+"<\/td>",o='<td class="department-locale" data-id="'+n.CurrentItem.CommonDepartment[0].lookupId+'">'+n.CurrentItem.CommonDepartment[0].lookupValue+"<\/td>",s="<td> "+n.CurrentItem.CommonLocation[0].lookupValue+"<\/td>";return"<tr>"+u+r+o+s+f+e+"<\/tr>"}function u(n){return ViewUtilities.Paging.InstanceHtml(n)}var n={ShiftManagement_Department:"Department",ShiftManagement_Location:"Location",ShiftManagement_Title:"Title",ShiftManagement_Requester:"Requester",ShiftManagement_ViewDetail:"View Detail",ShiftManagement_Time:"Time",ShiftManagement_Month:"Month",ShiftManagement_Year:"Year",Locale:"",ListResourceFileName:"RBVHStadaLists",Container:"shift-approval-list-container"};(function(){var i={};i.Templates={};i.ListTemplateType=10010;i.BaseViewID=2;i.Templates.Item=r;i.OnPreRender=function(){$(".ms-menutoolbar").hide()};i.OnPostRender=t;i.Templates.Header="<div class='col-md-12'><table class='table'><thead><tr><th id='titleTHApproval'>Title<\/th><th id='requesterTHApproval'>"+n.ShiftManagement_Requester+"<\/th><th id='departmentTHApproval'>"+n.ShiftManagement_Department+"<\/th><th id='locationTHApproval'>"+n.ShiftManagement_Location+"<\/th><th id='month'>"+n.ShiftManagement_Month+"<\/th><th id='year'>"+n.ShiftManagement_Year+"<\/th><tr><\/thead><tbody>";i.Templates.Footer=u;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(i)})()})(),function(){function t(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){n.Locale=Strings.STS.L_CurrentUICulture_Name;SP.SOD.registerSod(n.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+n.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(n.ListResourceFileName,"Res",i)},"strings.js");var t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Department/DepartmentService.svc/GetDepartments/"+_spPageContextInfo.currentUICultureName+"/"+_rbvhContext.EmployeeInfo.FactoryLocation.LookupId;$.ajax({url:t,method:"GET",async:!0,headers:{Accept:"application/json; odata=verbose"},success:function(t){t&&t.length>0&&$("#"+n.Container+" .department-locale").each(function(){var n=$(this).attr("data-id"),i=$(this);$(t).each(function(t,r){r.Id.toString()===n&&i.text(r.DepartmentName)})})},error:function(){status="failed"}})}function i(){$("#"+n.Container+" #departmentTH").text(Res.shiftManagement_Department);$("#"+n.Container+" #locationTH").text(Res.shiftManagement_Location);$("#"+n.Container+" #requesterTH").text(Res.shiftManagement_Requester);$("#"+n.Container+" #month").text(Res.shiftManagement_Month);$("#"+n.Container+" #year").text(Res.shiftManagement_Year);$("#"+n.Container+" #approver").text(Res.shiftManagement_Approver);$("#"+n.Container+" #modifiedBy").text(Res.shiftManagement_ModifiedBy);$("#"+n.Container+" #action").text(Res.shiftManagement_EditTitle+" | "+Res.shiftManagement_ViewTitle);$("#"+n.Container+" #approvalStatus").text(Res.approvalStatusFieldDisplayName);$("#"+n.Container+" .label-success").text(Res.approvalStatus_Approved);$("#"+n.Container+" .label-default").text(Res.approvalStatus_InProgress)}function r(n){var r="<td>"+n.CurrentItem.Requester[0].lookupValue+"<\/td>",u="<td>"+(n.CurrentItem.Editor.length>0?n.CurrentItem.Editor[0].title:"")+"<\/td>",t=window.location.href.split("#")[0];t=Functions.removeParam("lang",t);t+="#tab2";t=encodeURIComponent(t);var f='<span><a  href="/SitePages/ShiftRequest.aspx?itemid='+n.CurrentItem.ID+"&Source="+t+'"   class="table-action" style="margin-left: 10px;"><i class="fa fa-pencil-square-o" aria-hidden="true"><\/i><\/a><\/span>',e='<span><a  href="/SitePages/ShiftRequest.aspx?itemid='+n.CurrentItem.ID+"&Source="+t+'&mode=view"   class="table-action"><i class="fa fa-eye" aria-hidden="true"><\/i><\/a><\/span>',o="<td>"+f+e+"<\/td>",s="<td> "+n.CurrentItem.CommonMonth+"<\/td>",i=n.CurrentItem.CommonYear.replace(".","");i=i.replace(",","");var h="<td> "+i+"<\/td>",c='<td class="department-locale" data-id="'+n.CurrentItem.CommonDepartment[0].lookupId+'">'+n.CurrentItem.CommonDepartment[0].lookupValue+"<\/td>",l="<td> "+n.CurrentItem.CommonLocation[0].lookupValue+"<\/td>",a=!n.CurrentItem.CommonApprover1?"":n.CurrentItem.CommonApprover1[0].title,v="<td> "+a+"<\/td>";return"<tr>"+r+c+l+s+h+v+u+o+"<\/tr>"}function u(n){return ViewUtilities.Paging.InstanceHtml(n)}var n={ShiftManagement_Department:"Department",ShiftManagement_Location:"Location",ShiftManagement_Requester:"Requester",ShiftManagement_Month:"Month",ShiftManagement_Year:"Year",ShiftManagement_Approver:"Approver",ShiftManagement_ModifiedBy:"Modified By",Locale:"",ShiftManagement_EditTitle:"Edit",ShiftManagement_ViewTitle:"View",ListResourceFileName:"RBVHStadaLists",Container:"shift-request-list-container"};(function(){var i={};i.Templates={};i.ListTemplateType=10010;i.BaseViewID=4;i.Templates.Item=r;i.OnPreRender=function(){$(".ms-menutoolbar").hide()};i.OnPostRender=t;i.Templates.Header="<div class='col-md-12'><table class='table'><thead><tr><th id='requesterTH'>"+n.ShiftManagement_Requester+"<\/th><th id='departmentTH'>"+n.ShiftManagement_Department+"<\/th><th id='locationTH'>"+n.ShiftManagement_Location+"<\/th><th id='month'>"+n.ShiftManagement_Month+"<\/th><th id='year'>"+n.ShiftManagement_Year+"<\/th><th id='approver'>"+n.ShiftManagement_Approver+"<\/th><th id='modifiedBy'>"+n.ShiftManagement_ModifiedBy+"<\/th><th id='action'>"+n.ShiftManagement_EditTitle+" | "+n.ShiftManagement_ViewTitle+"<\/th><\/tr><\/thead><tbody>";i.Templates.Footer=u;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(i)})()}(),function(){function t(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){n.Locale=Strings.STS.L_CurrentUICulture_Name;SP.SOD.registerSod(n.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+n.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(n.ListResourceFileName,"Res",i)},"strings.js");var t=_spPageContextInfo.webAbsoluteUrl+"/_vti_bin/Services/Department/DepartmentService.svc/GetDepartments/"+_spPageContextInfo.currentUICultureName+"/"+_rbvhContext.EmployeeInfo.FactoryLocation.LookupId;$.ajax({url:t,method:"GET",async:!0,headers:{Accept:"application/json; odata=verbose"},success:function(t){t&&t.length>0&&$("#"+n.Container+" .department-locale").each(function(){var n=$(this).attr("data-id"),i=$(this);$(t).each(function(t,r){r.Id.toString()===n&&i.text(r.DepartmentName)})})},error:function(){status="failed"}})}function i(){$("#"+n.Container+" #requesterTHDept").text(Res.shiftManagement_Requester);$("#"+n.Container+" #departmentTHDept").text(Res.shiftManagement_Department);$("#"+n.Container+" #locationTHDept").text(Res.shiftManagement_Location);$("#"+n.Container+" #monthDept").text(Res.shiftManagement_Month);$("#"+n.Container+" #yearDept").text(Res.shiftManagement_Year);$("#"+n.Container+" #approverDept").text(Res.shiftManagement_Approver);$("#"+n.Container+" #actionDept").text(Res.shiftManagement_ViewTitle);$("#"+n.Container+" .label-success").text(Res.approvalStatus_Approved);$("#"+n.Container+" .label-default").text(Res.approvalStatus_InProgress)}function r(n){var r="<td>"+n.CurrentItem.Requester[0].lookupValue+"<\/td>",t=window.location.href.split("#")[0];t=Functions.removeParam("lang",t);t+="#tab3";t=encodeURIComponent(t);var a='<span><a  href="/SitePages/ShiftRequest.aspx?subSection=ShiftManagement&itemid='+n.CurrentItem.ID+"&Source="+t+'"   class="table-action" style="margin-left: 10px;"><i class="fa fa-pencil-square-o" aria-hidden="true"><\/i><\/a><\/span>',u='<span><a  href="/SitePages/ShiftRequest.aspx?subSection=ShiftManagement&itemid='+n.CurrentItem.ID+"&Source="+t+'&mode=view"   class="table-action"><i class="fa fa-eye" aria-hidden="true"><\/i><\/a><\/span>',f="<td>"+u+"<\/td>",e="<td> "+n.CurrentItem.CommonMonth+"<\/td>",i=n.CurrentItem.CommonYear.replace(".","");i=i.replace(",","");var o="<td> "+i+"<\/td>",s='<td class="department-locale" data-id="'+n.CurrentItem.CommonDepartment[0].lookupId+'">'+n.CurrentItem.CommonDepartment[0].lookupValue+"<\/td>",h="<td> "+n.CurrentItem.CommonLocation[0].lookupValue+"<\/td>",c=!n.CurrentItem.CommonApprover1?"":n.CurrentItem.CommonApprover1[0].title,l="<td> "+c+"<\/td>";return"<tr>"+r+s+h+e+o+l+f+"<\/tr>"}function u(n){return ViewUtilities.Paging.InstanceHtml(n)}var n={ShiftManagement_Department:"Department",ShiftManagement_Location:"Location",ShiftManagement_Requester:"Requester",ShiftManagement_Month:"Month",ShiftManagement_Year:"Year",ShiftManagement_Approver:"Approver",Locale:"",ShiftManagement_ViewTitle:"View",ListResourceFileName:"RBVHStadaLists",Container:"shift-by-department-list-container"};(function(){var i={};i.Templates={};i.ListTemplateType=10010;i.BaseViewID=3;i.Templates.Item=r;i.OnPreRender=function(){$(".ms-menutoolbar").hide()};i.OnPostRender=t;i.Templates.Header="<div class='col-md-12'><table class='table'><thead><tr><th id='requesterTHDept'>"+n.ShiftManagement_Requester+"<\/th><th id='departmentTHDept'>"+n.ShiftManagement_Department+"<\/th><th id='locationTHDept'>"+n.ShiftManagement_Location+"<\/th><th id='monthDept'>"+n.ShiftManagement_Month+"<\/th><th id='yearDept'>"+n.ShiftManagement_Year+"<\/th><th id='approverDept'>"+n.ShiftManagement_Approver+"<\/th><th id='actionDept'>"+n.ShiftManagement_ViewTitle+"<\/th><\/tr><\/thead><tbody>";i.Templates.Footer=u;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(i)})()}();var MyShiftConfig={TimeShift_ListTitle:"Shift Time",ListResourceFileName:"RBVHStadaLists",ShiftTimeList:[],PageResourceFileName:"RBVHStadaWebpages",LeavesByEmployee:window.location.protocol+"//{0}/_vti_bin/Services/leavemanagement/leavemanagementservice.svc/GetLeavesInRange/{1}/{2}/{3}/{4}/{5}",CalendarList:window.location.protocol+"//{0}/_vti_bin/Services/Calendar/CalendarService.svc/GetHolidayInRange/{1}/{2}",LeaveArray:[],NonWorkingDays:[],DaysInMonth:31,ISODateFormat:"{0}-{1}-{2}"};(function(){var n={};n.Templates={};n.Templates.Item=myShiftCustomItem;n.OnPreRender=function(){GetNonWorkingDays();ShiftTimeList();$(".ms-menutoolbar").hide();var t=1e3,n;$(document).on("mouseover","td.jsgrid-cell-all-day, td.jsgrid-cell-half-day",function(){var i=$(this);n=setTimeout(function(){var n=i.attr("data-leave-url");$("#leave-link").attr("href",n);$("#leave-dialog").dialog();$("#leave-link").off("click").on("click",function(){var n=$(this).attr("href");return window.open(n,"_blank"),setTimeout(function(){$("#leave-dialog").dialog("close")},1e3),!1});return!1},t)}).on("mouseout","td.jsgrid-cell-all-day, td.jsgrid-cell-half-day",function(){clearTimeout(n)})};n.ListTemplateType=100;n.Templates.Header=renderHeader;n.Templates.Footer=pagingControl;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(n)})(),function(){var n={};n.Templates={};n.OnPostRender=shiftTimeFormOnPostRender;n.Templates.Fields={ShiftTimeWorkingHourFrom:{DisplayForm:hideDatePicker},ShiftTimeWorkingHourTo:{DisplayForm:hideDatePicker},ShiftTimeWorkingHourMid:{DisplayForm:hideDatePicker},ShiftTimeBreakingHourFrom:{DisplayForm:hideDatePicker},ShiftTimeBreakingHourTo:{DisplayForm:hideDatePicker}};SPClientTemplates.TemplateManager.RegisterTemplateOverrides(n)}();