var CAMControl;(function(n){var t=function(){function n(n,t,i,r,u,f,e){this.SharePointContext=n;this.PeoplePickerControl=t;this.PeoplePickerEdit=i;this.PeoplePickerDisplay=r;this.PeoplePickerData=u;this.ServerDataMethod=f;this.SpGroupName=e;this.SpHostUrl=decodeURIComponent(RBVH.Stada.WebPages.Utilities.GetValueByParamURL("SPHostUrl"));this.InstanceName="";this.MaxEntriesShown=4;this.ShowLoginName=!0;this.ShowTitle=!0;this.MinimalCharactersBeforeSearching=2;this.PrincipalType=1;this.FilterData=[];this.AllowDuplicates=!1;this.Language="en-us";this.textBoxId="";this._queryID=1;this._lastQueryID=1;this._ResolvedUsers=[]}return n.prototype.GetFilterData=function(){return this.FilterData},n.prototype.GetPrincipalType=function(){return this.PrincipalType},n.prototype.SetPrincipalType=function(n){this.PrincipalType=n},n.prototype.SetFilterData=function(n){this.FilterData=n},n.prototype.GetMinimalCharactersBeforeSearching=function(){return this.MinimalCharactersBeforeSearching},n.prototype.SetMinimalCharactersBeforeSearching=function(n){this.MinimalCharactersBeforeSearching=n},n.prototype.GetServerDataMethod=function(){return this.ServerDataMethod},n.prototype.GetSpGroupName=function(){return this.SpGroupName},n.prototype.GetSpHostUrl=function(){return this.SpHostUrl},n.prototype.HtmlEncode=function(n){return document.createElement("a").appendChild(document.createTextNode(n)).parentNode.innerHTML.ReplaceAll("'","&apos;")},n.prototype.HtmlDecode=function(n){var t=document.createElement("a");return t.innerHTML=n,t.textContent},String.prototype.ReplaceAll=function(n,t,i){var f,r=this+"",u=-1;if(typeof n=="string")if(i)for(f=n.toLowerCase();(u=r.toLowerCase().indexOf(n,u>=0?u+t.length:0))!==-1;)r=r.substring(0,u)+t+r.substring(u+n.length);else return this.split(n).join(t);return r},n.prototype.LoadScript=function(n,t){var u=document.getElementsByTagName("head")[0],i=document.createElement("script"),r;i.src=n;r=!1;i.onload=i.onreadystatechange=function(){r||this.readyState&&this.readyState!=="loaded"&&this.readyState!=="complete"||(r=!0,t(),i.onload=i.onreadystatechange=null,u.removeChild(i))};u.appendChild(i)},n.prototype.Format=function(n){for(var t=1;t<arguments.length;t++)n=n.ReplaceAll("{"+(t-1)+"}",arguments[t]);return n},n.prototype.HideSelectionBox=function(){this.PeoplePickerDisplay.css("display","none")},n.prototype.ShowSelectionBox=function(){this.PeoplePickerDisplay.css("display","block");this.PeoplePickerDisplay.css("max-height","200px");this.PeoplePickerDisplay.css("overflow-y","scroll")},n.prototype.ConstructResolvedUserSpan=function(n,t,i){var r="Remove person or group {0}",u,f;return typeof deleteUser!="undefined"&&(r=deleteUser),u=n?n.replace("\\","\\\\"):i,r=this.Format(r,t),f='<p style="margin: 0 0"><span class="cam-peoplepicker-userSpan"><span class="cam-entity-resolved">{0}<\/span><a title="{3}" class="cam-peoplepicker-delImage" onclick="{1}.DeleteProcessedUser({2}); return false;" href="#">x<\/a><\/span><\/p>',this.Format(f,t,this.InstanceName,"'"+u+"'",r)},n.prototype.resizeBox=function(){this._ResolvedUsers.length<1?$("#"+this.textBoxId).css("height","30px"):$("#"+this.textBoxId).css("height",30+this._ResolvedUsers.length*20+"px")},n.prototype.ResolvedUsersToHtml=function(){for(var t="",n=0;n<this._ResolvedUsers.length;n++)t+=this.ConstructResolvedUserSpan(this._ResolvedUsers[n].Login,this._ResolvedUsers[n].Name,this._ResolvedUsers[n].LookupId);return t},n.prototype.ResolvedUser=function(n,t,i){var r={};return r.Login=n,r.Name=t,r.Email=i,r},n.prototype.PushResolvedUser=function(n){var i,t;if(this.AllowDuplicates)this._ResolvedUsers.push(n);else{for(i=!1,t=0;t<this._ResolvedUsers.length;t++)this._ResolvedUsers[t].Login===n.Login&&(i=!0);i||this._ResolvedUsers.push(n)}this.PeoplePickerData.val(JSON.stringify(this._ResolvedUsers));this.PeoplePickerData.trigger("change");this.resizeBox()},n.prototype.PopResolvedUser=function(){this._ResolvedUsers.pop();this.PeoplePickerData.val(JSON.stringify(this._ResolvedUsers));this.PeoplePickerData.trigger("change")},n.prototype.RemoveResolvedUser=function(n){for(var i,r=[],u=!1,t=0;t<this._ResolvedUsers.length;t++)i=this._ResolvedUsers[t].Login?this._ResolvedUsers[t].Login:this._ResolvedUsers[t].LookupId,(i!==n||u===!0)&&r.push(this._ResolvedUsers[t]),i===n&&(u=!0);this._ResolvedUsers=r;this.PeoplePickerData.val(JSON.stringify(this._ResolvedUsers));this.PeoplePickerData.trigger("change")},n.prototype.RecipientSelected=function(n,t,i){this.HideSelectionBox();this.PushResolvedUser(this.ResolvedUser(n,t,i));this.PeoplePickerControl.html(this.ResolvedUsersToHtml());this.PeoplePickerEdit.val("");this.PeoplePickerEdit.focus()},n.prototype.DeleteProcessedUser=function(n){this.RemoveResolvedUser(n);this.PeoplePickerControl.html(this.ResolvedUsersToHtml());this.PeoplePickerEdit.focus();this.resizeBox()},n.prototype.QueryFailure=function(){},n.prototype.QuerySuccess=function(n,t){var a="[]",f,o,l,r,w;a=typeof t=="string"?t:t;var i=a,u="",h="<div class='ms-bgHoverable' style='width: 400px; padding: 4px;' onclick='javascript:{0}.RecipientSelected(\"{1}\", \"{2}\", \"{3}\")'>{4}",v="";if(v=this.ShowLoginName&&this.ShowTitle?h+" ({5})<br/>{6}<\/div>":this.ShowLoginName||this.ShowTitle?h+" ({6})<\/div>":h+"<\/div>",i&&i.length)if(i.length>0){if(n<this._lastQueryID)return;for(f=i.length,f>this.MaxEntriesShown&&(f=this.MaxEntriesShown),o=0;o<f;o++){var c=i[o],s=c.Login,y=c.Name,p=c.Email,e=p;s&&s.indexOf("|")>-1&&(l=s.split("|"),e=e+" "+l[l.length-1],e=e.trim());u+=this.Format(v,this.InstanceName,s.replace("\\","\\\\"),this.HtmlEncode(y),p,y,e)}r="";u+="<div class='ms-emphasisBorder' style='width: 400px; padding: 4px; border-left: none; border-bottom: none; border-right: none; cursor: default;'>";i.length===1?(r="Showing {0} result",typeof resultsSingle!="undefined"&&(r=resultsSingle),u+=this.Format(r,i.length)+"<\/div>"):f!==i.length?(r="Showing {0} of {1} results. <B>Please refine further<B/>",typeof resultsTooMany!="undefined"&&(r=resultsTooMany),u+=this.Format(r,f,i.length)+"<\/div>"):(r="Showing {0} results",typeof resultsMany!="undefined"&&(r=resultsMany),u+=this.Format(r,i.length)+"<\/div>");this.PeoplePickerDisplay.html(u);this.ShowSelectionBox()}else w="<div class='ms-emphasisBorder' style='width: 400px; padding: 4px; border-left: none; border-bottom: none; border-right: none; cursor: default;'>No results found<\/div>",this.PeoplePickerDisplay.html(w),this.ShowSelectionBox();else this.HideSelectionBox()},n.prototype.Initialize=function(){var n=this,t="",i="",r;$("script").each(function(n,r){r.src.toLowerCase().indexOf("peoplepickercontrol.js")>-1&&(t=r.src,i=t.substring(t.indexOf(".js")+3),t=t.substring(0,t.indexOf(".js")))});r=t+"_resources."+this.Language.substring(0,2).toLowerCase()+".js";i.length>0&&(r+=i);this.LoadScript(r,function(){});this.PeoplePickerData.val()!=null&&this.PeoplePickerData.val().length>0&&(this._ResolvedUsers=JSON.parse(this.PeoplePickerData.val()),this.PeoplePickerControl.html(this.ResolvedUsersToHtml()));this.PeoplePickerControl.parent().click(function(){n.PeoplePickerEdit.focus()});this.PeoplePickerEdit.keydown(function(t){var i=t.which,s,e,f,h,u,c,r,a,o,l;if(i===8){if(n.HideSelectionBox(),s=n.PeoplePickerEdit.val(),!(s.length>0)&&n._ResolvedUsers.length>0)return n.PopResolvedUser(),n.PeoplePickerControl.html(n.ResolvedUsersToHtml()),n.PeoplePickerEdit.focus(),!1}else i>=48&&i<=90||i===32?(e=n.PeoplePickerEdit.val(),t.shiftKey===!1&&i>=65&&i<=90&&(i+=32),e+=String.fromCharCode(i),e.length>0&&(f=e,n.GetMinimalCharactersBeforeSearching()<1&&n.SetMinimalCharactersBeforeSearching(1),f.length>=n.GetMinimalCharactersBeforeSearching()&&(resultDisplay="Searching...",typeof resultsSearching!="undefined"&&(resultDisplay=resultsSearching),h=n.Format("<div class='ms-emphasisBorder' style='width: 400px; padding: 4px; border-left: none; border-bottom: none; border-right: none; cursor: default;'>{0}<\/div>",resultDisplay),n.PeoplePickerDisplay.html(h),n.ShowSelectionBox(),u=new SP.UI.ApplicationPages.ClientPeoplePickerQueryParameters,u.set_allowMultipleEntities(!1),u.set_maximumEntitySuggestions(2e3),u.set_principalType(n.GetPrincipalType()),u.set_principalSource(15),u.set_queryString(f),c=SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.clientPeoplePickerSearchUser(n.SharePointContext,u),n._queryID=n._queryID+1,r=n._queryID,n._lastQueryID=r,typeof n.ServerDataMethod=="undefined"?n.SharePointContext.executeQueryAsync(Function.createDelegate(this,function(){n.QuerySuccess(r,c)}),Function.createDelegate(this,function(){n.QueryFailure(r)})):(a=n.GetSpGroupName(),o=n.GetPrincipalType(),o==1?(l={Name:f,EmployeePositions:n.GetFilterData()},$.ajax({type:"POST",url:n.GetServerDataMethod(),contentType:"application/json; charset=utf-8",data:JSON.stringify(l),dataType:"json",success:function(t){n.QuerySuccess(r,t)},error:function(){n.QueryFailure(r)}})):o==2&&$.ajax({type:"GET",url:n.GetServerDataMethod()+"/"+encodeURIComponent(f),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){n.QuerySuccess(r,t)},error:function(){n.QueryFailure(r)}}))))):(i===9||i===27)&&n.HideSelectionBox()})},n}();n.PeoplePicker=t})(CAMControl||(CAMControl={}));