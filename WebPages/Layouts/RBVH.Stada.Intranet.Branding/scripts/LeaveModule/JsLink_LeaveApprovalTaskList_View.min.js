function PostRender(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){SP.SOD.registerSod(ApprovalTaskListConfig.ListResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+ApprovalTaskListConfig.ListResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(ApprovalTaskListConfig.ListResourceFileName,"Res",OnListResourcesReady);SP.SOD.registerSod(ApprovalTaskListConfig.PageResourceFileName,"/_layouts/15/ScriptResx.ashx?name="+ApprovalTaskListConfig.PageResourceFileName+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name));SP.SOD.executeFunc(ApprovalTaskListConfig.PageResourceFileName,"Res",OnPageResourcesReady)},"strings.js");$(".approve-request").click(function(){$(this).prop("disabled",!0);approval_Task($(this).attr("data-id"),$(this).attr("data-approvalstatus"),$(this).attr("data-emp-id"))});$(".reject-request").click(function(){$(this).prop("disabled",!0);reject_Task($(this).attr("data-id"),$(this))})}function OnListResourcesReady(){$("#requesterTH").text(Res.leaveList_Requester);$("#approvalStatus").text(Res.ApprovalStatus);$("#from").text(Res.leaveList_From);$("#to").text(Res.leaveList_To);$("#reason").text(Res.leaveList_Reason);$("#transferWorkTo").text(Res.leaveList_TransferWorkTo);$("#leaveHours").text(Res.leaveList_LeaveHours);$("#comment").text(Res.leaveList_Comment)}function OnPageResourcesReady(){$("#cancelRequestMessage").html(Res.cannotCancelApprovedRequest);$(".approve-request").text(Res.approveButton);$(".reject-request").text(Res.rejectButton)}function pad(n){return n<10?"0"+n:n}function CustomItem(n){var t="<td>"+n.CurrentItem.Requester[0].lookupValue+"<\/td>",i="<td >"+n.CurrentItem.CommonFrom+"<\/td>",r="<td >"+n.CurrentItem.To+"<\/td>",u="<td>"+n.CurrentItem.TransferworkTo[0].lookupValue+"<\/td>",f="<td >"+n.CurrentItem.LeaveHours+"<\/td>",e="<td >"+n.CurrentItem.Reason+"<\/td>",o='<td ><input type="text" class="form-control comment'+n.CurrentItem.ID+'" /><\/td>',s="<button type='button' class='btn btn-success btn-sm approve-request' data-approvalStatus='"+n.CurrentItem.ApprovalStatus+"'  data-id='"+n.CurrentItem.ID+"' data-emp-id='"+n.CurrentItem.Requester[0].lookupId+"'>Approve<\/button>",h="<button type='button' class='btn btn-default btn-sm reject-request'  data-id='"+n.CurrentItem.ID+"'>Reject<\/button>",c="<td>"+s+"   "+h+"<td>";return"<tr>"+t+i+r+f+u+e+o+c+"<\/tr>"}function pagingControl(n){return ViewUtilities.Paging.InstanceHtml(n)}function updateListItem(n,t){var i,u=_spPageContextInfo.webServerRelativeUrl,f=window.location.protocol+"//"+window.location.host+u,r=new SP.ClientContext(f),e=r.get_web().get_lists().getByTitle(String(ApprovalTaskListConfig.ListTitle));i=e.getItemById(n);r.load(i);r.executeQueryAsync(Function.createDelegate(this,function(){var r=i.get_item("ApprovalStatus");r=="Approved"||r=="Rejected"?(alert($("#cancelRequestMessage").text()),location.reload()):(updateCancelStatus(n),$(t).attr("disabled","true"),$(t).closest("tr").find(".label").removeClass("label-default").addClass("label-warning"),$(t).closest("tr").find(".label").removeClass("label-default").text(ApprovalTaskListConfig.ApprovalStatus_Cancelled))}),Function.createDelegate(this,function(){}))}function updateCancelStatus(n){var r=_spPageContextInfo.webServerRelativeUrl,u=window.location.protocol+"//"+window.location.host+r,t=new SP.ClientContext(u),i=t.get_web().get_lists().getByTitle(String(ApprovalTaskListConfig.ListTitle));t.load(i);this.oListItem=i.getItemById(n);oListItem.set_item("ApprovalStatus","Cancelled");oListItem.update();t.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceeded),Function.createDelegate(this,this.onQueryFailed))}function onQuerySucceeded(){}function onQueryFailed(){}function approval_Task(n,t,i){var r;if(checkIsCancelled(n),ApprovalTaskListConfig.ApprovalStatus!="Cancelled"){ApprovalTaskListConfig.ItemID=n;var e=_spPageContextInfo.webServerRelativeUrl,o=window.location.protocol+"//"+window.location.host+e,u=new SP.ClientContext(o),f=u.get_web().get_lists().getByTitle(String(ApprovalTaskListConfig.ListTitle));u.load(f);this.oListItem=f.getItemById(n);t==""?(this.checkIsManager(i),r=$(".comment"+n).val(),oListItem.set_item("CommonComment",r),oListItem.set_item("ApprovalStatus","Approved"),ApprovalTaskListConfig.ApprovalStatus="Approved"):t=="1"&&(r=$(".comment"+n).val(),oListItem.set_item("CommonComment",r),oListItem.set_item("ApprovalStatus","Approved"),ApprovalTaskListConfig.ApprovalStatus="Approved");oListItem.update();u.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceeded),Function.createDelegate(this,this.onQueryFailed))}}function reject_Task(n){var r;if(checkIsCancelled(n),ApprovalTaskListConfig.ItemID=n,ApprovalTaskListConfig.ApprovalStatus!="Cancelled"){var u=_spPageContextInfo.webServerRelativeUrl,f=window.location.protocol+"//"+window.location.host+u,t=new SP.ClientContext(f),i=t.get_web().get_lists().getByTitle(String(ApprovalTaskListConfig.ListTitle));t.load(i);this.oListItem=i.getItemById(n);r=$(".comment"+n).val();oListItem.set_item("CommonComment",r);oListItem.set_item("ApprovalStatus","Rejected");oListItem.update();t.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceeded),Function.createDelegate(this,this.onQueryFailed))}}function onQuerySucceeded(){location.reload()}function onQueryRejectSucceeded(){location.reload()}function onQueryFailed(){}function checkIsCancelled(n){var i=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getbytitle('"+String(ApprovalTaskListConfig.ListTitle)+"')/items("+n+")",t=$.Deferred();return $.ajax({url:i,method:"GET",async:!1,headers:{Accept:"application/json; odata=verbose"},success:function(n){ApprovalTaskListConfig.ApprovalStatus=n.d.ApprovalStatus;t.resolve(n.d)},error:function(){status="failed"}}),t.promise()}function checkIsManager(n){var i=_spPageContextInfo.webAbsoluteUrl+String(ApprovalTaskListConfig.IsManagerServiceUrl)+n,t=$.Deferred();return $.ajax({url:i,type:"get",async:!1,success:function(n){ApprovalTaskListConfig.IsManager=n;t.resolve(n)},error:function(){return!1}}),t.promise()}var ApprovalTaskListConfig={Requester:"Requester",From:"From",To:"To",LeaveHours:"Leave Hours",TransferWorkTo:"Transfer work To",Reason:"Reason",Comment:"Comment",ApprovalStatus:"Approval Status",LeftAt:"Left At",Left:"Left",ApprovalStatus_Approved:"Approved",ApprovalStatus_InProgress:"In-Progress",ApprovalStatus_Cancelled:"Cancelled",ApprovalStatus_Rejected:"Rejected",CancelRequest:"Cancel Request",ListTitle:"Leave Management",ListResourceFileName:"RBVHStadaLists",PageResourceFileName:"RBVHStadaWebpages",ItemID:""};(function(){var n={};n.Templates={};n.Templates.Item=CustomItem;n.OnPreRender=function(){$(".ms-menutoolbar").hide()};n.ListTemplateType=10004;n.OnPostRender=PostRender;n.Templates.Header="<div class='col-md-12'><div hidden='true' id='cancelRequestMessage'>Can not cancel the request that was approved<\/div><table class='table'><thead><tr><th id='requesterTH'>"+ApprovalTaskListConfig.Requester+"<\/th><th id='from'>"+ApprovalTaskListConfig.From+"<\/th><th id='to'>"+ApprovalTaskListConfig.To+"<\/th><th id='leaveHours'>"+ApprovalTaskListConfig.LeaveHours+"<\/th><th id='transferWorkTo'>"+ApprovalTaskListConfig.TransferWorkTo+"<\/th><th id='reason'>"+ApprovalTaskListConfig.Reason+"<\/th><th id='comment'>"+ApprovalTaskListConfig.Comment+"<\/th><th><\/th><\/tr><\/thead><tbody>";n.Templates.Footer=pagingControl;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(n)})();