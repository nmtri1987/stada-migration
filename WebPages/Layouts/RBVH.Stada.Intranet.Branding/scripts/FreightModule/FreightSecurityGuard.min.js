RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.FreightSecurityGuard=function(n){this.Settings={ServiceUrls:{DepartmentList:window.location.protocol+"//{0}/_vti_bin/Services/Department/DepartmentService.svc/GetDepartmentsByLcid/{1}/{2}"},AllDepartments:"All/Tất cả",CurrentDepartmentId:0,SelectedFromDate:"",SelectedToDate:"",DepartmentId:"0",SearchType:"0",RequestNumber:"0"};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.FreightSecurityGuard.prototype={Initialize:function(){var n=this;$(document).ready(function(){SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.InitControls();n.RegisterEvents()})})},InitControls:function(){var n=this,i=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminSelectedDate"),r=RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminSelectedToDate"),t=n.Settings.CurrentDepartmentId>0?n.Settings.CurrentDepartmentId:RBVH.Stada.WebPages.Utilities.GetValueByParam("AdminDeptId"),u=RBVH.Stada.WebPages.Utilities.GetValueByParam("searchtype"),f=RBVH.Stada.WebPages.Utilities.GetValueByParam("reqnum"),o,s,h,c;if(!!i==!1||!!r==!1||!!t==!1||!!u==!1||!!f==!1)o=new Date,i=typeof i!="undefined"?i:n.toISOStringTZ(o),r=typeof r!="undefined"?r:n.toISOStringTZ(new Date(o.getFullYear(),o.getMonth()+1,0,23,59,59)),t=typeof t!="undefined"?t:"0",u=typeof u!="undefined"?u:"0",f=typeof f!="undefined"?f:"0",n.RebindUrl(i,r,t,u,f,!1);else{if(n.Settings.DepartmentId=t,n.Settings.SelectedFromDate=i,n.Settings.SelectedToDate=r,n.Settings.DepartmentId=t,n.Settings.SearchType=u,n.Settings.RequestNumber=f,n=this,s={format:"dd/mm/yyyy",autoclose:!0},$(n.Settings.Controls.FromDateControlSelector).datepicker(s),$(n.Settings.Controls.ToDateControlSelector).datepicker(s),n.PopulateComboboxes(),$(n.Settings.Controls.DepartmentControlSelector).val(n.Settings.DepartmentId),h=Date.parse(n.Settings.SelectedFromDate),h!==NaN){var e=new Date(h),l=e.getDate(),a=e.getMonth()+1,v=e.getFullYear();$(n.Settings.Controls.FromDateControlSelector).val(l+"/"+a+"/"+v)}if(c=Date.parse(n.Settings.SelectedToDate),c!==NaN){var e=new Date(c),l=e.getDate(),a=e.getMonth()+1,v=e.getFullYear();$(n.Settings.Controls.ToDateControlSelector).val(l+"/"+a+"/"+v)}n.ShowHideSearchControl(n.Settings.SearchType);n.Settings.RequestNumber!=="0"?$(n.Settings.Controls.TxtRequestNumberID).val(n.Settings.RequestNumber):$(n.Settings.Controls.TxtRequestNumberID).val("")}},RegisterEvents:function(){var n=this;$("input[type='radio'][name='searchType']").click(function(){$(n.Settings.Controls.TxtRequestNumberID).val("");var t=$(this).val();n.ShowHideSearchControl(t)});$(n.Settings.Controls.SearchButtonID).on("click",function(t){t.preventDefault();$(n.Settings.Controls.TxtRequestNumberID).removeClass("require-error");n.Settings.RequestNumber=$(n.Settings.Controls.TxtRequestNumberID).val();n.Settings.RequestNumber===undefined||n.Settings.RequestNumber===null||n.Settings.RequestNumber.length===0?(n.Settings.RequestNumber="0",$(n.Settings.Controls.TxtRequestNumberID).addClass("require-error")):(n.Settings.SearchType="1",n.RebindUrl(n.Settings.SelectedFromDate,n.Settings.SelectedToDate,n.Settings.DepartmentId,n.Settings.SearchType,n.Settings.RequestNumber,!0))});$(n.Settings.Controls.FromDateControlSelector).on("changeDate",function(t){var i=t.date.getDate(),r=t.date.getMonth(),u=t.date.getYear()+1900,f=new Date(u,r,i);$(".datepicker").hide();n.Settings.SearchType="0";n.Settings.RequestNumber="0";n.RebindUrl(n.toISOStringTZ(f),n.Settings.SelectedToDate,n.Settings.DepartmentId,n.Settings.SearchType,n.Settings.RequestNumber,!0)});$(n.Settings.Controls.ToDateControlSelector).on("changeDate",function(t){var i=t.date.getDate(),r=t.date.getMonth(),u=t.date.getYear()+1900,f=new Date(u,r,i);$(".datepicker").hide();n.Settings.SearchType="0";n.Settings.RequestNumber="0";n.RebindUrl(n.Settings.SelectedFromDate,n.toISOStringTZ(f),n.Settings.DepartmentId,n.Settings.SearchType,n.Settings.RequestNumber,!0)});$(n.Settings.Controls.DepartmentControlSelector).on("change",function(){n.Settings.DepartmentId=$(this).val();n.Settings.SearchType="0";n.Settings.RequestNumber="0";n.RebindUrl(n.Settings.SelectedFromDate,n.Settings.SelectedToDate,n.Settings.DepartmentId,n.Settings.SearchType,n.Settings.RequestNumber,!0)})},ShowHideSearchControl:function(n){var t=this;n==="0"?($("input[type='radio'][name='searchType']:first").prop("checked","checked"),$(t.Settings.Controls.BasicSearchClass).show(),$(t.Settings.Controls.SearchByReqNumClass).hide()):($("input[type='radio'][name='searchType']:last").prop("checked","checked"),$(t.Settings.Controls.BasicSearchClass).hide(),$(t.Settings.Controls.SearchByReqNumClass).show())},PopulateComboboxes:function(){var n=this,t=_spPageContextInfo.currentLanguage,i=_rbvhContext.EmployeeInfo!=null?_rbvhContext.EmployeeInfo.FactoryLocation.LookupId:2,r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.DepartmentList,location.host,t,i);$(n.Settings.Controls.DepartmentControlSelector).attr("disabled",!1);$(n.Settings.Controls.DepartmentControlSelector).empty();$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(t){$(n.Settings.Controls.DepartmentControlSelector).append($("<option>").attr("value","0").text(Functions.getDisplayTextOfItemAll(_spPageContextInfo.currentLanguage)));$(t).each(function(){$(n.Settings.Controls.DepartmentControlSelector).append($("<option>").attr("value",this.Id).text(this.DepartmentName))});n.Settings.DepartmentId=$(n.Settings.Controls.DepartmentControlSelector).val()}})},RebindUrl:function(n,t,i,r,u,f){var s=this,o=window.location.hash,e=window.location.href.split("#")[0],h="";h=e.indexOf("?")>=0?"&":"?";e=e.indexOf("AdminSelectedDate=")>0?e.replace(/(AdminSelectedDate=)[^\&]+/,"$1"+n):e+h+"AdminSelectedDate="+n;e=e.indexOf("AdminSelectedToDate=")>0?e.replace(/(AdminSelectedToDate=)[^\&]+/,"$1"+t):e+"&AdminSelectedToDate="+t;e=e.indexOf("AdminDeptId=")>0?e.replace(/(AdminDeptId=)[^\&]+/,"$1"+i):e+"&AdminDeptId="+i;e=e.indexOf("searchtype=")>0?s.UpdateQueryStringParameter(e,"searchtype",r):e+"&searchtype="+r;e=e.indexOf("reqnum=")>0?s.UpdateQueryStringParameter(e,"reqnum",u):e+"&reqnum="+u;!f||(e=ViewUtilities.Paging.RemovePagingURL(e));o&&o.length>0&&(e+=o);window.location.href===e?window.location.reload():window.location.href=e},UpdateQueryStringParameter:function(n,t,i){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),u=n.indexOf("?")!==-1?"&":"?";return n.match(r)?n.replace(r,"$1"+t+"="+i+"$2"):n+u+t+"="+i},toISOStringTZ:function(n){var t=(new Date).getTimezoneOffset()*6e4;return new Date(n.getTime()-t).toISOString().slice(0,-1)}};