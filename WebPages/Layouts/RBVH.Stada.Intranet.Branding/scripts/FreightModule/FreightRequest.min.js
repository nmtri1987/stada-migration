RBVH.Stada.javascript.common.NamespaceManager.register("RBVH.Stada.WebPages.pages");RBVH.Stada.WebPages.pages.FreightRequest=function(n){this.Protocol=window.location.protocol;this.Settings={ServiceUrls:{GetBringerList:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetBringerList/{1}/{2}",GetApprovers:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetApprovers/{1}/{2}",GetApprovalPermission:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/HasApprovalPermission/{1}",GetDelegatedTaskInfo:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetDelegatedTaskInfo/{1}",ValidateSumitTime:this.Protocol+"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/ValidateSumitTime",LoadFreightRequest:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetFreightManagementById/{1}/{2}",InsertFreightRequest:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/InsertFreight",ApproveFreightRequest:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/ApproveFreight",RejectFreightRequest:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/RejectFreight",SecurityUpdateFreightRequest:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/SecurityUpdateFreight",ExportFreight:this.Protocol+"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/ExportFreight",GetFreightDepartmentList:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetAllReceiverDepartment",IsSecurity:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/IsSecurity",GetTaskHistoryInfo:"//{0}/_vti_bin/Services/FreightManagement/FreightManagementService.svc/GetTaskHistory/{1}/{2}",GetConfigurations:"//{0}/_vti_bin/Services/Configurations/ConfigurationsService.svc/GetConfigurations"},Grid:{CustomFields:{HiddenIDField:null,HiddenShippingInField:null,HiddenShippingOutField:null,OrderNumberField:null,GoodsDescriptionField:null,UnitField:null,QuantityField:null,RemarksField:null,IsShippingInField:null,IsShippingOutField:null}},Data:{},DelegatedTaskInfo:{},Configurations:{},ConfigKey_ValidTransportDate:"FreightForm_ValidTransportDate",GridJsonArray:[],SelectedBringerType:"0",CurrentEmployeeID:"",CurrentEmployeeLookupId:"",CurrentEmployeeDepartmentID:"",CurrentEmployeeLocationID:"",CurrentEmployeeLevel:0,CurrentEmployeeFullName:"",CurrentLcid:1033,ApproverDH:{},ApproverBOD:{},ApproverHeadofAdminDept:{},IsViewMode:!1,FreightManagementId:0,SelectedReasonType:"0",FreightManagement_ListTitle:"Freight Management",DepartmentArray:[],IsSecurityGuard:!1,ShippingInIdsArray:[],ShippingOutIdsArray:[]};$.extend(!0,this.Settings,n);this.Initialize()};RBVH.Stada.WebPages.pages.FreightRequest.prototype={Initialize:function(){var n=this;SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){n.Settings.CurrentLcid=_spPageContextInfo.currentLanguage;n.InitControls();n.EventsRegister();n.TryLoadInformation();n.PopulateData()})},GetConfigurations:function(){var n=this,t=[n.Settings.ConfigKey_ValidTransportDate],i=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetConfigurations,location.host);$.ajax({type:"POST",url:i,data:JSON.stringify(t),cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t&&t.length>0&&(n.Settings.Configurations=t)})},InitControls:function(){var n=this;n.SetCurrentEmployeeInfo();n.ResetForm();n.LoadBringerRelatedControl();n.LoadReasonRelatedControl();$(n.Settings.Controls.DateSelector).keydown(function(n){return n.preventDefault(),!1})},CheckSecurityGuard:function(){var n=this,t=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.IsSecurity,location.host);$.ajax({type:"GET",url:t,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t&&t===!0&&(n.Settings.IsSecurityGuard=!0,n.ShowObjectForSecurity())})},SetCurrentEmployeeInfo:function(){var n=this;_rbvhContext&&_rbvhContext.EmployeeInfo&&(this.Settings.CurrentEmployeeID=_rbvhContext.EmployeeInfo.EmployeeID,this.Settings.CurrentEmployeeFullName=_rbvhContext.EmployeeInfo.FullName,this.Settings.CurrentEmployeeLocationID=_rbvhContext.EmployeeInfo.FactoryLocation.LookupId,this.Settings.CurrentEmployeeDepartmentID=_rbvhContext&&_rbvhContext.EmployeeInfo&&_rbvhContext.EmployeeInfo.Department?_rbvhContext.EmployeeInfo.Department.LookupId:0,this.Settings.CurrentEmployeeLookupId=_rbvhContext.EmployeeInfo.ID,this.Settings.CurrentEmployeeLevel=parseFloat(_rbvhContext.EmployeeInfo.EmployeeLevel.LookupValue))},LoadBringerRelatedControl:function(){var n=this;n.Settings.SelectedBringerType==="0"?($("#interEmpl").show(),$("#extEmpl").hide()):n.Settings.SelectedBringerType==="1"?($("#interEmpl").hide(),$("#extEmpl").hide()):($("#interEmpl").hide(),$("#extEmpl").show());$(n.Settings.Controls.SelectBringerSelector).select2({width:"100%"})},LoadReasonRelatedControl:function(){var n=this;n.Settings.SelectedReasonType==="0"?($(".sendGoodsTr").show(),$(".othersTr").hide()):n.Settings.SelectedReasonType==="1"&&($(".sendGoodsTr").hide(),$(".othersTr").show())},LoadEmployeeList:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetBringerList,location.host,n,_rbvhContext.EmployeeInfo.FactoryLocation.LookupId);$.ajax({type:"GET",url:i,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){if(n){$(t.Settings.Controls.SelectBringerSelector).empty();for(var i=0;i<n.length;i++)$(t.Settings.Controls.SelectBringerSelector).append($("<option>").attr("value",n[i].ID).attr("EmployeeId",n[i].EmployeeId).attr("DepartmentName",n[i].DepartmentName).attr("DepartmentId",n[i].DepartmentId).attr("LocationId",n[i].LocationId).text(n[i].FullName));t.Settings.Data&&t.Settings.Data.Bringer&&!!t.Settings.Data.Bringer.LookupId?$(t.Settings.Controls.SelectBringerSelector).val(t.Settings.Data.Bringer.LookupId.toString()).change():t.ReloadEmployeeData()}})},LoadApprovers:function(n,t){var i=this,r=RBVH.Stada.WebPages.Utilities.String.format(i.Settings.ServiceUrls.GetApprovers,location.host,n,t);$.ajax({type:"GET",url:r,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&(i.Settings.ApproverDH=n.Approver1,i.Settings.ApproverBOD=n.Approver2,i.Settings.ApproverHeadofAdminDept=n.Approver3)})},LoadFreightDepartment:function(){var n=this,t=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetFreightDepartmentList,location.host);$.ajax({type:"GET",url:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){n.Settings.DepartmentArray=t;var i=_spPageContextInfo.currentLanguage=="1066"?"ReceiverDepartmentVN":"ReceiverDepartment",r=$.map(n.Settings.DepartmentArray,function(n){return n[i]});$(n.Settings.Controls.TxtReceiverDepartment).autocomplete({source:r})}})},ResetForm:function(){var n=this;$("input[type='radio'][name='bringerType']:first").prop("checked","checked");$("input[type='radio'][name='radioReason']:first").prop("checked","checked");$("input[type='radio'][name='freightType']:first").prop("checked","checked");$("input[type='radio'][name='returnGoods']:last").prop("checked","checked");$(n.Settings.Controls.CkbHighPriority).prop("checked",!1);$(n.Settings.Controls.TxtBringerSelector).val("");$(n.Settings.Controls.TxtCompanyNameSelector).val("");$(n.Settings.Controls.TxtReason).val("");$(n.Settings.Controls.TxtReceivedBy).val("");$(n.Settings.Controls.TxtReceiverDepartment).val("");$(n.Settings.Controls.TxtPhoneContact).val("");$(n.Settings.Controls.TxtOthersReason).val("");$(n.Settings.Controls.DateSelector).val("");$(n.Settings.Controls.HoursSelector).val("00:");$(n.Settings.Controls.MinutesSelector).val("00")},EventsRegister:function(){var n=this;$("input[type='radio'][name='bringerType']").click(function(){var t=$(this).val();n.Settings.SelectedBringerType=t;n.LoadBringerRelatedControl()});$("input[type='radio'][name='radioReason']").click(function(){var t=$(this).val();n.Settings.SelectedReasonType=t;n.LoadReasonRelatedControl()});$(n.Settings.Controls.SelectBringerSelector).change(function(){n.ReloadEmployeeData()});$(n.Settings.Controls.ButtonSaveSelector).on("click",function(t){t.preventDefault();n.DoSubmitData(t)});$(n.Settings.Controls.ButtonCancelSelector).on("click",function(n){n.preventDefault();Functions.redirectToSource()});$(n.Settings.Controls.ButtonPrint).on("click",function(t){return t.preventDefault(),n.ExportFreight(),!1});$(n.Settings.Controls.ButtonApprove).on("click",function(t){t.preventDefault();n.DoApproveFreight(t)});$(n.Settings.Controls.ButtonReject).on("click",function(t){t.preventDefault();n.DoRejectFreight(t)});$(n.Settings.Controls.ButtonUpdate).on("click",function(t){t.preventDefault();n.Update()});$(n.Settings.Controls.ButtonSecReject).on("click",function(t){t.preventDefault();n.SecurityReject()});$(n.Settings.Controls.ApprovalHistoryButtonSelector).on("click",function(t){t.preventDefault();var i=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid"),r=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.GetTaskHistoryInfo,location.host,i,0);$.ajax({type:"GET",url:r,cache:!1,async:!0,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var i=[n.Settings.ResourceText.ApprovalStatusTitle,n.Settings.ResourceText.PostedByTitle,n.Settings.ResourceText.DateTitle,n.Settings.ResourceText.CommentTitle],r=[n.Settings.ResourceText.ApprovalStatus_Approved,n.Settings.ResourceText.ApprovalStatus_Rejected],u=Functions.generateApprovalHistoryTable(t,i,r,n.Settings.ResourceText.NoDataAvaibleMsg);$(n.Settings.Controls.ApprovalHistoryContainerSelector).html(u)})})},ExportFreight:function(){var t=this,n=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid");n&&n>0&&(url=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.ExportFreight,location.host)+"/"+n,window.location=url)},Update:function(){var t=this,i,n;t.ShowOrHideErrorMessage($(t.Settings.Controls.SecurityNotes_Error),"");$(t.Settings.Controls.ButtonUpdate).prop("disabled",!0);i=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid");i&&i>0?(n={},n.Id=i,n.ActionNo=1,n.CheckInFreightIds=t.Settings.ShippingInIdsArray,n.CheckOutFreightIds=t.Settings.ShippingOutIdsArray,n.UpdateById=_rbvhContext.EmployeeInfo.ID,n.UpdateByName=_rbvhContext.EmployeeInfo.FullName,n.SecurityNotes=$(t.Settings.Controls.TxtSecurityNotes).val(),t.UpdateTime(n)):$(t.Settings.Controls.ButtonUpdate).prop("disabled",!1)},SecurityReject:function(){var n=this,i,t;n.ShowOrHideErrorMessage($(n.Settings.Controls.SecurityNotes_Error),"");$(n.Settings.Controls.ButtonSecReject).prop("disabled",!0);i=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid");i&&i>0?$(n.Settings.Controls.TxtSecurityNotes).val().length>0?(t={},t.Id=i,t.ActionNo=3,t.UpdateById=_rbvhContext.EmployeeInfo.ID,t.UpdateByName=_rbvhContext.EmployeeInfo.FullName,t.SecurityNotes=$(n.Settings.Controls.TxtSecurityNotes).val(),n.UpdateTime(t)):(n.ShowOrHideErrorMessage($(n.Settings.Controls.SecurityNotes_Error),n.Settings.ResourceText.CantLeaveTheBlank),$(n.Settings.Controls.ButtonSecReject).prop("disabled",!1)):$(n.Settings.Controls.ButtonSecReject).prop("disabled",!1)},UpdateTime:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.SecurityUpdateFreightRequest,location.host);$.ajax({type:"POST",url:i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n.Code===4&&(alert(n.Message),window.location.reload())})},ReloadEmployeeData:function(){var n=this,t=$(n.Settings.Controls.SelectBringerSelector+" option:selected"),r=t.attr("EmployeeId"),i;$(n.Settings.Controls.SpanEmployeeIDSelector).text(r);i=t.attr("DepartmentName");$(n.Settings.Controls.SpanDepartmentSelector).text(i)},TryLoadInformation:function(){var n=this,t=RBVH.Stada.WebPages.Utilities.GetValueByParam("itemid"),i;t?($(n.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").show(),n.Settings.FreightManagementId=parseInt(t),i=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.LoadFreightRequest,location.host,t,"true"),$.ajax({type:"GET",url:i,contentType:"application/json; charset=utf-8",async:!1,cache:!1,dataType:"json"}).done(function(t){var f,e,o,s,h,c,i,r,u;if(t.Code>0){console.log(t.Message);return}if(n.Settings.Data=t,n.DisableControls(!0),n.LoadEmployeeList(t.Department.LookupId),n.Settings.CurrentEmployeeLookupId===t.Requester.LookupId&&((t.ModifiedBy.ID===t.CreatedBy.ID&&t.ApprovalStatus&&t.ApprovalStatus.toLowerCase()!=="cancelled"||t.ModifiedBy.ID!==t.CreatedBy.ID&&t.ApprovalStatus&&t.ApprovalStatus.toLowerCase()==="rejected")&&n.DisableControls(!1),t.ModifiedBy.ID!==t.CreatedBy.ID&&t.ApprovalStatus&&t.ApprovalStatus.toLowerCase()==="rejected"&&($(n.Settings.Controls.TxtOldComment).closest("tr").show(),$(n.Settings.Controls.TxtOldSecurityNotes).closest("tr").show())),t.CreatedBy.ID===_rbvhContext.EmployeeInfo.ADAccount.ID&&t.ModifiedBy.ID!==t.CreatedBy.ID&&t.ApprovalStatus&&t.ApprovalStatus.toLowerCase()!=="cancelled"&&t.ApprovalStatus.toLowerCase()!=="rejected"&&$(n.Settings.Controls.ButtonPrint).show(),t&&t.Id>0&&n.GetApprovalPermission(t.Id).then(function(i){i&&i===!0?n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):n.ShowControlForApprover(!0):n.GetDelegatedTaskInfo(t.Id).then(function(t){t&&t.Requester.LookupId>0?n.Settings.Data&&n.Settings.Data.RequestExpired==!0?(errMsg=decodeURI(n.Settings.ResourceText.RequestExpiredMsgFormat),errMsg=RBVH.Stada.WebPages.Utilities.String.format(errMsg,n.Settings.Data.RequestDueDate),RBVH.Stada.WebPages.Utilities.GUI.showRequestExpired(n.Settings.Controls.ErrorMsgContainerSelector,n.Settings.Controls.ErrorMsgSelector,errMsg)):(n.Settings.DelegatedTaskInfo=t,n.ShowControlForApprover(!0)):n.ShowControlForApprover(!1)})}),!t.Bringer.LookupId||$(n.Settings.Controls.SelectBringerSelector).val(t.Bringer.LookupId.toString()).change(),t.Bringer.LookupId>0?($('input[name="bringerType"][value="0"]').prop("checked",!0),n.Settings.SelectedBringerType="0"):t.CompanyVehicle===!0?($('input[name="bringerType"][value="1"]').prop("checked",!0),n.Settings.SelectedBringerType="1"):($('input[name="bringerType"][value="2"]').prop("checked",!0),n.Settings.SelectedBringerType="2"),n.LoadBringerRelatedControl(),$(n.Settings.Controls.TxtReason).val(t.Reason),!!t.OtherReason&&t.OtherReason.length>0?($(n.Settings.Controls.RDOtherReason).prop("checked",!0),$(n.Settings.Controls.RDOtherReason).click()):($(n.Settings.Controls.RDSendGoods).prop("checked",!0),$(n.Settings.Controls.RDSendGoods).click()),t.BringerName&&$(n.Settings.Controls.TxtBringerSelector).val(t.BringerName),t.CompanyName&&$(n.Settings.Controls.TxtCompanyNameSelector).val(t.CompanyName),$(n.Settings.Controls.TxtReceivedBy).val(t.Receiver),f=t.ReceiverDepartmentText,_spPageContextInfo.currentLanguage=="1066"?t.ReceiverDepartmentVN!=null&&t.ReceiverDepartmentVN.LookupValue!=null&&(f=t.ReceiverDepartmentVN.LookupValue):t.ReceiverDepartmentLookup!=null&&t.ReceiverDepartmentLookup.LookupValue!=null&&(f=t.ReceiverDepartmentLookup.LookupValue),_spPageContextInfo.currentLanguage=="1066"?"VehicleVN":"Vehicle",$(n.Settings.Controls.TxtReceiverDepartment).val(f),$(n.Settings.Controls.TxtPhoneContact).val(t.ReceiverPhone),$(n.Settings.Controls.TxtOthersReason).val(t.OtherReason),$(n.Settings.Controls.TxtOldComment).html(Functions.parseComment(t.Comment)),$(n.Settings.Controls.TxtOldSecurityNotes).html(Functions.parseComment(t.SecurityNotes)),t.HighPriority&&t.HighPriority===!0?$(n.Settings.Controls.CkbHighPriority).prop("checked",!0):$(n.Settings.Controls.CkbHighPriority).prop("checked",!1),e=t.FreightType===!0?"Yes":"No",$('input[name="freightType"][value="'+e+'"]').prop("checked",!0),o=t.ReturnedGoods===!0?"Yes":"No",$('input[name="returnGoods"][value="'+o+'"]').prop("checked",!0),t.ApprovalStatus&&t.ApprovalStatus.length>0&&($(n.Settings.Controls.ApprovalStatusValSelector).html(RBVH.Stada.WebPages.Utilities.GUI.generateItemStatus(t.ApprovalStatus)),$(n.Settings.Controls.ApprovalStatusValSelector).closest("tr").show()),s=t.DateString,$(n.Settings.Controls.DateSelector).val(s),h=Functions.padDate(t.Hour)+":",c=Functions.padDate(t.Minute),$(n.Settings.Controls.HourSelector).val(h.toString()).change(),$(n.Settings.Controls.MinuteSelector).val(c.toString()).change(),i=t.FreightDetails,i&&i.length>0)for(r=0;r<i.length;r++)u={},u.Id=i[r].Id,u.GoodsDescription=i[r].GoodsName,u.Unit=i[r].Unit,u.Remarks=i[r].Remarks,u.Quantity=i[r].Quantity,u.IsShippingIn=i[r].IsShippingIn,u.IsShippingOut=i[r].IsShippingOut,u.ShippingInBy=i[r].ShippingInBy,u.ShippingOutBy=i[r].ShippingOutBy,u.ShippingInTime=i[r].ShippingInTime,u.ShippingOutTime=i[r].ShippingOutTime,n.Settings.GridJsonArray.push(u);n.CheckSecurityGuard()})):($(n.Settings.Controls.ApprovalHistoryButtonSelector).closest("div").hide(),n.LoadEmployeeList(n.Settings.CurrentEmployeeDepartmentID))},GetApprovalPermission:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetApprovalPermission,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},GetDelegatedTaskInfo:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.GetDelegatedTaskInfo,location.host,n);return $.ajax({type:"GET",url:i,cache:!1,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"})},ShowControlForApprover:function(n){var t=this;n===!0?($(t.Settings.Controls.ButtonApprove).show(),$(t.Settings.Controls.ButtonReject).show(),t.ShowHighPriority(),t.ShowComment()):($(t.Settings.Controls.ButtonApprove).hide(),$(t.Settings.Controls.ButtonReject).hide(),t.Settings.Data.Comment&&t.Settings.Data.Comment.length>0&&$(t.Settings.Controls.TxtOldComment).closest("tr").show(),t.Settings.Data.SecurityNotes&&t.Settings.Data.SecurityNotes.length>0&&$(t.Settings.Controls.TxtOldSecurityNotes).closest("tr").show())},ShowHighPriority:function(){var n=this;n.Settings.CurrentEmployeeLevel===5&&_rbvhContext.EmployeeInfo.ADAccount.ID===n.Settings.Data.DH.ID||n.Settings.DelegatedTaskInfo.FromEmployee&&n.Settings.DelegatedTaskInfo.FromEmployee.ID===n.Settings.Data.DH.ID?($(".highPriorityTr").show(),$(n.Settings.Controls.CkbHighPriority).prop("disabled",!1)):($(".highPriorityTr").hide(),$(n.Settings.Controls.CkbHighPriority).prop("disabled",!0))},ShowComment:function(){var n=this;n.Settings.Data.Comment&&n.Settings.Data.Comment.length>0&&$(n.Settings.Controls.TxtOldComment).closest("tr").show();$(n.Settings.Controls.TxtComment).closest("tr").show();$(n.Settings.Controls.TxtComment).prop("disabled",!1)},ShowObjectForSecurity:function(){var n=this;$(n.Settings.Controls.TxtComment).closest("tr").hide();$(n.Settings.Controls.TxtOldComment).closest("tr").hide();$(n.Settings.Controls.TxtOldSecurityNotes).val().length>0&&$(n.Settings.Controls.TxtOldSecurityNotes).closest("tr").show();$(n.Settings.Controls.TxtSecurityNotes).prop("disabled",!1);$(n.Settings.Controls.TxtSecurityNotes).closest("tr").show();n.Settings.Data.IsFinished==!0&&$(n.Settings.Controls.ButtonUpdate).prop("disabled",!0);$(n.Settings.Controls.ButtonSecReject).show();$(n.Settings.Controls.ButtonUpdate).show()},DisableControls:function(n){var t=this;t.Settings.IsViewMode=n;$('input[name="bringerType"]').prop("disabled",n);n===!0&&$(t.Settings.Controls.SelectBringerSelector).select2("destroy");$(t.Settings.Controls.SelectBringerSelector).prop("disabled",n);$(t.Settings.Controls.TxtBringerSelector).prop("disabled",n);$(t.Settings.Controls.TxtCompanyNameSelector).prop("disabled",n);$(t.Settings.Controls.TxtReason).prop("disabled",n);$('input[name="radioReason"]').prop("disabled",n);$(t.Settings.Controls.TxtReceivedBy).prop("disabled",n);$(t.Settings.Controls.TxtReceiverDepartment).prop("disabled",n);$(t.Settings.Controls.TxtPhoneContact).prop("disabled",n);$(t.Settings.Controls.TxtOthersReason).prop("disabled",n);n===!0?$("#ctl00_PlaceHolderMain_dtDate_dtDateDateDatePickerImage").hide():$("#ctl00_PlaceHolderMain_dtDate_dtDateDateDatePickerImage").show();$(t.Settings.Controls.DateSelector).prop("disabled",n);$(t.Settings.Controls.HourSelector).prop("disabled",n);$(t.Settings.Controls.MinuteSelector).prop("disabled",n);$('input[name="freightType"]').prop("disabled",n);$('input[name="returnGoods"]').prop("disabled",n);$(t.Settings.Controls.CkbHighPriority).prop("disabled",n);$(t.Settings.Controls.ButtonSaveSelector).prop("disabled",n)},PopulateData:function(){var n=this;n.GetConfigurations();n.LoadFreightDepartment();n.PopulateGrid();n.DisableShippingCheckboxes();n.EventsRegisterForCheckBoxs()},EventsRegisterForCheckBoxs:function(){var n=this;$("input[type='checkbox'][name='chbox-check-in']").on("change",function(){var t=$(this).parent().siblings(":first");t&&t.text()&&t.text().length>0&&($(this).is(":checked")===!0?n.Settings.ShippingInIdsArray.push(t.text()):n.Settings.ShippingInIdsArray=$.grep(n.Settings.ShippingInIdsArray,function(n){return n!=t.text()}))});$("input[type='checkbox'][name='chbox-check-out']").on("change",function(){var t=$(this).parent().siblings(":first");t&&t.text()&&t.text().length>0&&($(this).is(":checked")===!0?n.Settings.ShippingOutIdsArray.push(t.text()):n.Settings.ShippingOutIdsArray=$.grep(n.Settings.ShippingOutIdsArray,function(n){return n!=t.text()}))})},PopulateGrid:function(){var n=this;n.BindGridColumns();$(n.Settings.Controls.FreightRequestFormSelector).jsGrid({width:"100%",height:"300px",align:"center",inserting:!n.Settings.IsViewMode,editing:!n.Settings.IsViewMode,sorting:!0,autoload:!0,noDataContent:"",deleteConfirm:n.Settings.ResourceText.ConfirmDeleteMessage,data:n.Settings.Data,onDataLoaded:function(){},controller:{loadData:function(){for(var i=$.Deferred(),t=0;t<n.Settings.GridJsonArray.length;t++)n.Settings.GridJsonArray[t].OrderNumber=t+1;return i.resolve(n.Settings.GridJsonArray),i.promise()},insertItem:function(){},updateItem:function(){},deleteItem:function(){}},onItemInserting:function(n){var t=n.grid._insertRow;n.cancel=!this.ValidateFreightItem(n,t)||!this.ValidateQuantity(n.item.Quantity,t)},onItemInserted:function(){},onItemEditing:function(){},onItemUpdated:function(){},onItemUpdating:function(n){var t=n.grid._editingRow.prev();n.cancel=!this.ValidateFreightItem(n,t)||!this.ValidateQuantity(n.item.Quantity,t)},ValidateQuantity:function(t,i){var r=i.find("td:nth-child(5) input");return!$.isNumeric(t)||t<=0?(r.addClass("require-error"),r.attr("title",n.Settings.ResourceText.QuantityWrongMessage),!1):(r.attr("title",""),r.removeClass("require-error"),!0)},ValidateFreightItem:function(n,t){var i=!0;return $.trim(n.item.GoodsDescription)===""?(t.find("td:nth-child(3) input").addClass("require-error"),i=!1):t.find("td:nth-child(3) input").removeClass("require-error"),$.trim(n.item.Quantity)===""?(t.find("td:nth-child(5) input").addClass("require-error"),i=!1):t.find("td:nth-child(5) input").removeClass("require-error"),$.trim(n.item.Unit)===""?(t.find("td:nth-child(4) input").addClass("require-error"),i=!1):t.find("td:nth-child(4) input").removeClass("require-error"),i},ValidateCellGridNotEmptyValue:function(n){var t=n.item.GoodsDescription,i=n.item.Quantity,r=n.item.Unit;return t===""||i===""||r===""?!1:!0},onItemDeleted:function(){for(var t=0;t<n.Settings.GridJsonArray.length;t++)n.Settings.GridJsonArray[t].OrderNumber=t+1;n.Settings.GridJsonArray.length>1&&$(n.Settings.Controls.FreightRequestFormSelector).jsGrid("loadData")},onItemEditCancelling:function(){},fields:n.Settings.Grid.Fields})},DoSubmitData:function(){var n=this,t,i;$(n.Settings.Controls.ButtonSaveSelector).prop("disabled",!0);t=n.GetPostData();t&&n.ValidateForm(t)===!0?(t.IsValidRequest=!0,i=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.ValidateSumitTime,location.host),$.ajax({type:"GET",url:i,async:!1,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(i){i&&i.Code===5?(t.IsValidRequest=!1,n.ShowInvalidRuleMessage(n.ProcessData,i.Message,t)):n.ProcessData(t)})):$(n.Settings.Controls.ButtonSaveSelector).prop("disabled",!1)},ProcessData:function(n){var t=this,i=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.InsertFreightRequest,location.host);$.ajax({type:"POST",url:i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n&&n.Code===4&&(alert(n.Message),window.location.reload())})},DoApproveFreight:function(){var n=this,t,i;n.ShowOrHideErrorMessage($(n.Settings.Controls.Comment_Error),"");$(n.Settings.Controls.ButtonApprove).prop("disabled",!0);t=n.GetPostData();t&&n.ValidateForm(t)===!0?(i=RBVH.Stada.WebPages.Utilities.String.format(n.Settings.ServiceUrls.ApproveFreightRequest,location.host),$.ajax({type:"POST",url:i,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n.Code===2&&(alert(n.Message),window.location.reload())})):$(n.Settings.Controls.ButtonApprove).prop("disabled",!1)},DoRejectFreight:function(n){var t=this,i,r;t.ShowOrHideErrorMessage($(t.Settings.Controls.Comment_Error),"");$(t.Settings.Controls.ButtonReject).prop("disabled",!0);i=t.GetPostData();i&&t.ValidateForm(i)===!0?i.Comment&&i.Comment.length>0?(r=RBVH.Stada.WebPages.Utilities.String.format(t.Settings.ServiceUrls.RejectFreightRequest,location.host),$.ajax({type:"POST",url:r,data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){n&&n.Code===0?Functions.redirectToSource():n.Code===3&&(alert(n.Message),window.location.reload())})):(t.ShowOrHideErrorMessage($(t.Settings.Controls.Comment_Error),t.Settings.ResourceText.CantLeaveTheBlank),$(t.Settings.Controls.ButtonReject).prop("disabled",!1)):($(t.Settings.Controls.ButtonReject).prop("disabled",!1),n.preventDefault())},ValidateForm:function(n){var t=this;return t.ValidateRequiredField(n)},ValidateRequiredField:function(n){var t,i,o,r,s,u,f,e;if($("span[class='ms-formvalidation ms-csrformvalidation']").html(""),t=this,i=0,t.Settings.SelectedBringerType==="0"?i+=t.ValidateEmptyField($(t.Settings.Controls.SelectBringerSelector).val(),t.Settings.Controls.BringerSelector_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1:t.Settings.SelectedBringerType==="2"&&(i+=t.ValidateEmptyField($(t.Settings.Controls.TxtBringerSelector).val(),t.Settings.Controls.BringerSelector_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1,i+=t.ValidateEmptyField($(t.Settings.Controls.TxtCompanyNameSelector).val(),t.Settings.Controls.CompanySelector_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1),i+=t.ValidateEmptyField($(t.Settings.Controls.TxtReason).val(),t.Settings.Controls.ReasonSelector_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1,t.Settings.SelectedReasonType==="1"&&(i+=t.ValidateEmptyField($(t.Settings.Controls.TxtOthersReason).val(),t.Settings.Controls.Others_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1),i+=n.FreightDetails===null||n.FreightDetails===undefined||n.FreightDetails.length===0?t.ValidateEmptyField("",t.Settings.Controls.FreightDetails_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1:t.ValidateEmptyField(n.FreightDetails,t.Settings.Controls.FreightDetails_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1,i+=t.ValidateEmptyField($(t.Settings.Controls.DateSelector).val(),t.Settings.Controls.DateSelector_Error,t.Settings.ResourceText.CantLeaveTheBlank)===!0?0:1,t.GetConfigurations(),!(n.Id>0)||t.Settings.CurrentEmployeeLookupId===t.Settings.Data.Requester.LookupId&&t.Settings.Data.ModifiedBy.ID!==t.Settings.Data.CreatedBy.ID&&t.Settings.Data.ApprovalStatus&&t.Settings.Data.ApprovalStatus.toLowerCase()==="rejected"){o=Functions.parseVietNameseDate($(t.Settings.Controls.DateSelector).val());r=0;try{s=Functions.getConfigValue(t.Settings.Configurations,t.Settings.ConfigKey_ValidTransportDate);s&&(r=parseInt(Functions.getConfigValue(t.Settings.Configurations,t.Settings.ConfigKey_ValidTransportDate)))}catch(h){r=0}u=new Date;f=new Date(u.getFullYear(),u.getMonth(),u.getDate());f.setDate(f.getDate()+r);o.valueOf()<f.valueOf()&&(e=decodeURI(t.Settings.ResourceText.TransportTimeErrorMessage_1),e=RBVH.Stada.WebPages.Utilities.String.format(e,r),i+=t.ValidateEmptyField(null,t.Settings.Controls.DateSelector_Error,e)===!0?0:1)}return i===0},ValidateEmptyField:function(n,t,i){if(n&&n!=="")return $(t).hide(),!0;$(t).html(i);$(t).show()},ShowOrHideErrorMessage:function(n,t){t&&t.length>0?($(n).html(t),$(n).show()):($(n).hide(),$(n).html(""))},GetPostData:function(){var t=this,n={},r=$(t.Settings.Controls.SelectBringerSelector+" option:selected"),i,u,f;n.Id=t.Settings.FreightManagementId||0;t.Settings.SelectedBringerType==="0"?(n.Bringer={LookupId:parseInt(r.val())},n.BringerDepartment={LookupId:parseInt(r.attr("DepartmentId"))},n.BringerLocation={LookupId:parseInt(r.attr("LocationId"))},n.CompanyVehicle=!1,n.BringerName="",n.CompanyName=""):t.Settings.SelectedBringerType==="1"?(n.Bringer={LookupId:0},n.BringerDepartment={LookupId:0},n.BringerLocation={LookupId:0},n.CompanyVehicle=!0,n.BringerName="",n.CompanyName=""):(n.Bringer={LookupId:0},n.BringerDepartment={LookupId:0},n.BringerLocation={LookupId:0},n.CompanyVehicle=!1,n.BringerName=$(t.Settings.Controls.TxtBringerSelector).val(),n.CompanyName=$(t.Settings.Controls.TxtCompanyNameSelector).val());n.Requester={LookupId:t.Settings.CurrentEmployeeLookupId};n.Department={LookupId:t.Settings.CurrentEmployeeDepartmentID};n.Location={LookupId:t.Settings.CurrentEmployeeLocationID};t.Settings.SelectedReasonType==="0"?(n.Receiver=$(t.Settings.Controls.TxtReceivedBy).val(),i=0,$.each(t.Settings.DepartmentArray,function(t,r){if($.trim(r.ReceiverDepartment).toUpperCase()==$.trim(n.ReceiverDepartmentText).toUpperCase()||$.trim(r.ReceiverDepartmentVN).toUpperCase()==$.trim(n.ReceiverDepartmentText).toUpperCase()){i=r.Id;return}}),n.ReceiverDepartmentLookup={LookupId:i},n.ReceiverDepartmentText=i===0?$(t.Settings.Controls.TxtReceiverDepartment).val():"",n.ReceiverPhone=$(t.Settings.Controls.TxtPhoneContact).val(),n.OtherReason=""):(n.Receiver="",n.ReceiverDepartmentText="",n.ReceiverDepartmentLookup={LookupId:0},n.ReceiverPhone="",n.OtherReason=$(t.Settings.Controls.TxtOthersReason).val());u=$("input[type='radio'][name='returnGoods']:checked").val()==="Yes"?!0:!1;n.ReturnedGoods=u;f=$("input[type='radio'][name='freightType']:checked").val()==="Yes"?!0:!1;n.FreightType=f;n.HighPriority=$(t.Settings.Controls.CkbHighPriority).prop("checked")===!0?!0:!1;var h=$(t.Settings.Controls.DateSelector).val(),c=$(t.Settings.Controls.HourSelector).val().replace(":",""),l=$(t.Settings.Controls.MinuteSelector).val();n.Reason=$(t.Settings.Controls.TxtReason).val();n.Comment=$(t.Settings.Controls.TxtComment).val();n.SecurityNotes=$(t.Settings.Controls.TxtSecurityNotes).val();n.DateString=h;n.Hour=parseInt(c);n.Minute=parseInt(l);var e="",o="",s="";return t.Settings.ApproverDH&&t.Settings.ApproverDH.LoginName!==""&&(e=t.Settings.ApproverDH.LoginName),t.Settings.ApproverBOD&&t.Settings.ApproverBOD.LoginName!==""&&(o=t.Settings.ApproverBOD.LoginName),t.Settings.ApproverHeadofAdminDept&&t.Settings.ApproverHeadofAdminDept.LoginName!==""&&(s=t.Settings.ApproverHeadofAdminDept.LoginName),n.DH={UserName:e},n.BOD={UserName:o},n.AdminDept={UserName:s},n.FreightDetails=t.GetDetailGridData(),n},GetDetailGridData:function(){var u=this,r=[],t=u.Settings.GridJsonArray,i,n;if(t&&t.length>0)for(i=0;i<t.length;i++)n={},n.GoodsName=t[i].GoodsDescription,n.Unit=t[i].Unit,n.Remarks=t[i].Remarks,n.Quantity=t[i].Quantity,n.IsShippingIn=!1,n.IsShippingOut=!1,r.push(n);return r},BindOrderNumber:function(){var n=this;n.Settings.Grid.CustomFields.OrderNumberField=function(n){jsGrid.Field.call(this,n)};n.Settings.Grid.CustomFields.OrderNumberField.prototype=new jsGrid.Field({insertTemplate:function(){},editTemplate:function(){},insertValue:function(){var t=n.Settings.GridJsonArray.length;return t+1},editValue:function(){}})},CustomCheckBox:function(){var n=this;n.Settings.Grid.CustomFields.IsShippingInField=function(n){jsGrid.Field.call(this,n)};n.Settings.Grid.CustomFields.IsShippingInField.prototype=new jsGrid.Field({itemTemplate:function(t){if(n.Settings.IsSecurityGuard===!0)return n.GetShippingCheckBox("ShippingIn",t,n.Settings.Data.FreightType,n.Settings.Data.ReturnedGoods);var i="";return t===!0&&(i=' checked="checked" '),'<input name="chbox-check-in" type="checkbox" '+i+' disabled="disabled" />'},insertTemplate:function(){},editTemplate:function(){},insertValue:function(){},editValue:function(){}});n.Settings.Grid.CustomFields.IsShippingOutField=function(n){jsGrid.Field.call(this,n)};n.Settings.Grid.CustomFields.IsShippingOutField.prototype=new jsGrid.Field({itemTemplate:function(t){if(n.Settings.IsSecurityGuard===!0)return n.GetShippingCheckBox("ShippingOut",t,n.Settings.Data.FreightType,n.Settings.Data.ReturnedGoods);var i="";return t===!0&&(i=' checked="checked" '),'<input name="chbox-check-out" type="checkbox" '+i+' disabled="disabled" />'},insertTemplate:function(){},editTemplate:function(){},insertValue:function(){},editValue:function(){}})},GetShippingCheckBox:function(n,t,i,r){var o=this,e="",u="",f;t&&t==!0&&(e=' checked="checked" ',u=' disabled="disabled" ');switch(n){case"ShippingIn":if(f="chbox-check-in",i==!0&&r==!1)return u=' disabled="disabled" ','<input name="'+f+'" type="checkbox" '+e+u+"  />";if(i==!0&&r==!0)return'<input name="'+f+'" type="checkbox" '+e+u+"/>";if(i==!1&&r==!1||i==!1&&r==!0)return'<input name="'+f+'" type="checkbox" '+e+u+" />";break;case"ShippingOut":if((f="chbox-check-out",i==!0&&r==!1)||i==!0&&r==!0)return'<input name="'+f+'" type="checkbox" '+e+u+"/>";if(i==!1&&r==!1)return u=' disabled="disabled" ','<input name="'+f+'" type="checkbox" '+e+u+"/>";if(i==!1&&r==!0)return'<input name="'+f+'" type="checkbox" '+e+u+" />"}},DisableShippingCheckboxes:function(){var r=this,t=$("input[type='checkbox'][name='chbox-check-in']"),i=$("input[type='checkbox'][name='chbox-check-out']"),n,u,f,e;if(t&&i&&t.length>0&&i.length>0&&t.length==i.length)if(r.Settings.Data.FreightType==!0&&r.Settings.Data.ReturnedGoods==!0)for(n=0;n<t.length;n++)u=$(i[n]),$(u).is(":checked")==!1&&$(t[n]).is(":checked")==!1&&$(t[n]).attr("disabled","disabled");else if(r.Settings.Data.FreightType==!1&&r.Settings.Data.ReturnedGoods==!0)for(n=0;n<i.length;n++)u=$(t[n]),$(u).is(":checked")==!1&&$(i[n]).is(":checked")==!1&&$(i[n]).attr("disabled","disabled");f=$("input[type='checkbox'][name='chbox-check-in']:checked");e=$("input[type='checkbox'][name='chbox-check-out']:checked");(f&&f.length>0||e&&e.length>0)&&$(r.Settings.Controls.ButtonSecReject).prop("disabled",!0)},BindGridColumns:function(){var n=this;n.BindOrderNumber();n.CustomCheckBox();jsGrid.fields.custOrderField=n.Settings.Grid.CustomFields.OrderNumberField;jsGrid.fields.customIsShippingInField=n.Settings.Grid.CustomFields.IsShippingInField;jsGrid.fields.customIsShippingOutField=n.Settings.Grid.CustomFields.IsShippingOutField;n.Settings.Grid.Fields=[{name:"Id",title:"Id",align:"center",width:0,type:"text",css:"jsgrid-hide-column"},{name:"OrderNumber",title:n.Settings.Grid.ColumnTitles.GridColumn_Order,align:"center",width:30,type:"custOrderField"},{name:"GoodsDescription",title:n.Settings.Grid.ColumnTitles.GridColumn_GoodsDescription,width:250,align:"left",type:"text"},{name:"Unit",title:n.Settings.Grid.ColumnTitles.GridColumn_Unit,width:65,align:"center",type:"text"},{name:"Quantity",title:n.Settings.Grid.ColumnTitles.GridColumn_Quantity,width:90,align:"center",type:"text"},{name:"Remarks",title:n.Settings.Grid.ColumnTitles.GridColumn_Remarks,width:300,align:"left",type:"text"}];n.Settings.IsViewMode===!0?(n.Settings.Grid.Fields.push({name:"ShippingInTime",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingInTime,width:120,align:"center",type:"text"}),n.Settings.Grid.Fields.push({name:"ShippingInBy",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingInBy,width:120,align:"center",type:"text"}),n.Settings.Grid.Fields.push({name:"IsShippingIn",title:n.Settings.Grid.ColumnTitles.GridColumn_CheckIn,width:120,align:"center",type:"customIsShippingInField"}),n.Settings.Grid.Fields.push({name:"ShippingOutTime",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingOutTime,width:120,align:"center",type:"text"}),n.Settings.Grid.Fields.push({name:"ShippingOutBy",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingOutBy,width:120,align:"center",type:"text"}),n.Settings.Grid.Fields.push({name:"IsShippingOut",title:n.Settings.Grid.ColumnTitles.GridColumn_CheckOut,width:120,align:"center",type:"customIsShippingOutField"})):(n.Settings.Grid.Fields.push({name:"ShippingInTime",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingInTime,width:0,align:"center",type:"text",css:"jsgrid-hide-column"}),n.Settings.Grid.Fields.push({name:"ShippingInBy",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingInBy,width:0,align:"center",type:"text",css:"jsgrid-hide-column"}),n.Settings.Grid.Fields.push({name:"IsShippingIn",title:n.Settings.Grid.ColumnTitles.GridColumn_CheckIn,width:0,align:"center",type:"customIsShippingInField",css:"jsgrid-hide-column"}),n.Settings.Grid.Fields.push({name:"ShippingOutTime",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingOutTime,width:0,align:"center",type:"text",css:"jsgrid-hide-column"}),n.Settings.Grid.Fields.push({name:"ShippingOutBy",title:n.Settings.Grid.ColumnTitles.GridColumn_ShippingOutBy,width:0,align:"center",type:"text",css:"jsgrid-hide-column"}),n.Settings.Grid.Fields.push({name:"IsShippingOut",title:n.Settings.Grid.ColumnTitles.GridColumn_CheckOut,width:0,align:"center",type:"customIsShippingOutField",css:"jsgrid-hide-column"}));n.Settings.Grid.Fields.push({type:"control",editButton:!1,deleteButton:!n.Settings.IsViewMode,width:60,modeSwitchButton:!1})},ShowInvalidRuleMessage:function(n,t,i){var r=this;$.confirm({title:r.Settings.Modal.Title,content:t,buttons:{somethingElse:{text:r.Settings.Modal.SaveButton,btnClass:"btn-blue",action:function(){if(typeof n=="function"&&typeof n=="function"){var t=n.bind(r);t(i)}}},close:{text:r.Settings.Modal.CloseButton,action:function(){$(r.Settings.Controls.ButtonSaveSelector).prop("disabled",!1)}}}})}};